<ng-template #formContent>
  <div class="md:col-span-6 flex flex-col gap-6">
    <div tuiCardLarge class="p-6 border rounded-lg shadow-sm">
      <app-actions
        [isLoading]="state.isLoading()"
        [isCvValid]="state.cvForm.valid"
        [isCvLocked]="state.isCvLocked()"
        (lockCv)="state.onLockCv($event)"
        (save)="state.saveCv()"
        (download)="state.downloadPdf()"
        (clear)="state.clearCv()"
      />
      <ng-container *transloco="let t">
        <tui-tabs-with-more [itemsLimit]="6" [(activeItemIndex)]="state.activeTab" tuiFade>
          <button *tuiItem iconStart="@tui.user" tuiTab>
            {{ t('home.tab.personal') }}
          </button>
          <button *tuiItem iconStart="@tui.book-open" tuiTab>
            {{ t('home.tab.education') }}
          </button>
          <button *tuiItem iconStart="@tui.briefcase" tuiTab>
            {{ t('home.tab.experience') }}
          </button>
          <button *tuiItem iconStart="@tui.folder" tuiTab>
            {{ t('home.tab.projects') }}
          </button>
          <button *tuiItem iconStart="@tui.code" tuiTab>
            {{ t('home.tab.skills') }}
          </button>
          <button *tuiItem iconStart="@tui.sparkles" tuiTab>
            {{ t('home.tab.ia') }}
          </button>
          <button *tuiItem iconStart="@tui.filter" tuiTab>
            {{ t('home.tab.ats') }}
          </button>
          <button *tuiItem iconStart="@tui.notepad-text" tuiTab>
            {{ t('home.tab.coverLetter') }}
          </button>
        </tui-tabs-with-more>
      </ng-container>

      <form [formGroup]="state.cvForm" class="flex flex-col gap-6 pt-6">
        @switch (state.activeTab()) {
          @case (0) {
            <app-personal-info [personalInfo]="state.personalInfoGroup()" />
          }
          @case (1) {
            <app-education-section
              [educationForms]="state.educationForms()"
              (add)="state.addEducation()"
              (remove)="state.removeEducation($event)"
            />
          }
          @case (2) {
            <app-experience-section
              [experienceForms]="state.experienceForms()"
              (add)="state.addExperience()"
              (remove)="state.removeExperience($event)"
            />
          }
          @case (3) {
            <app-projects-section
              [projectForms]="state.projectForms()"
              (add)="state.addProject()"
              (remove)="state.removeProject($event)"
            />
          }
          @case (4) {
            <app-skills-section
              [skillsForms]="state.skillsForms()"
              (addSkillGroup)="state.addSkill()"
              (removeSkillGroup)="state.removeSkill($event)"
              (addCert)="state.addCertification($event)"
              (removeCert)="state.removeCertification($event)"
            />
          }
          @case (5) {
            <app-ia-section
              [iaForm]="state.iaForm"
              [isLoading]="state.isLoading()"
              (optimize)="state.optimizarCv()"
            />
          }
          @case (6) {
            <app-ats-section [iaForm]="state.iaForm" />
          }
          @case (7) {
            <app-cover-letter-section [iaForm]="state.iaForm" [cvForm]="state.cvForm" />
          }
        }
      </form>
    </div>
  </div>
</ng-template>

<ng-template #previewContent>
  <div class="md:col-span-6 md:sticky md:top-8 h-full">
    <app-dummy-view
      [cvPreview]="state.cvPreview()"
      [hasEducation]="state.hasEducation()"
      [hasExperience]="state.hasExperience()"
      [hasProjects]="state.hasProjects()"
      [hasSkills]="state.hasSkills()"
    />
  </div>
</ng-template>

<div class="md:hidden">
  <tui-tabs [(activeItemIndex)]="mobileView" class="sticky top-0 z-10 flex justify-center">
    <button tuiTab>Formulario</button>
    <button tuiTab>Previsualizar</button>
  </tui-tabs>

  <div class="overflow-hidden" (tuiSwipe)="onSwipe($event)">
    <div
      class="flex transition-transform duration-300 ease-in-out"
      [class.translate-x-0]="mobileView() === 0"
      [class.-translate-x-full]="mobileView() === 1"
    >
      <div class="w-full flex-shrink-0 p-4">
        <ng-container *ngTemplateOutlet="formContent"></ng-container>
      </div>

      <div class="w-full flex-shrink-0 p-4">
        <ng-container *ngTemplateOutlet="previewContent"></ng-container>
      </div>
    </div>
  </div>
</div>

<div class="hidden max-w-8xl md:px-8 mx-auto justify-center md:grid md:grid-cols-12 gap-6 p-4">
  <ng-container *ngTemplateOutlet="formContent"></ng-container>
  <ng-container *ngTemplateOutlet="previewContent"></ng-container>
</div>
