<div class="max-w-8xl md:px-8 mx-auto justify-center grid grid-cols-1 md:grid-cols-12 gap-6 p-4">
  <div class="md:col-span-6 flex flex-col gap-6">
    <!-- Para texto
    <p>{{this.iaForm.getRawValue() | json}}</p>
    <p>{{this.cvForm.getRawValue() | json}}</p>
    -->

    <div tuiCardLarge class="p-6 border rounded-lg shadow-sm">
      <app-actions
        [isLoading]="state.isLoading()"
        [isCvValid]="state.cvForm.valid"
        [isCvLocked]="state.isCvLocked()"
        (lockCv)="state.onLockCv($event)"
        (save)="state.saveCv()"
        (download)="state.downloadPdf()"
        (clear)="state.clearCv()"
      />

      <tui-tabs-with-more [itemsLimit]="6" [(activeItemIndex)]="state.activeTab" tuiFade>
        <button *tuiItem iconStart="@tui.user" tuiTab>Personal</button>
        <button *tuiItem iconStart="@tui.book-open" tuiTab>Educación</button>
        <button *tuiItem iconStart="@tui.briefcase" tuiTab>Experiencia</button>
        <button *tuiItem iconStart="@tui.folder" tuiTab>Proyectos</button>
        <button *tuiItem iconStart="@tui.code" tuiTab>Habilidades</button>
        <button *tuiItem iconStart="@tui.sparkles" tuiTab>IA</button>
        <button *tuiItem iconStart="@tui.filter" tuiTab>ATS</button>
        <button *tuiItem iconStart="@tui.notepad-text" tuiTab>Carta de Presentación</button>
      </tui-tabs-with-more>

      <form [formGroup]="state.cvForm" class="flex flex-col gap-6 pt-6">
        @switch (state.activeTab()) {
          @case (0) {
            <app-personal-info [personalInfo]="state.personalInfoGroup()" />
          }
          @case (1) {
            <app-education-section
              [educationForms]="state.educationForms()"
              (add)="state.addEducation()"
              (remove)="state.removeEducation($event)"
            />
          }
          @case (2) {
            <app-experience-section
              [experienceForms]="state.experienceForms()"
              (add)="state.addExperience()"
              (remove)="state.removeExperience($event)"
            />
          }
          @case (3) {
            <app-projects-section
              [projectForms]="state.projectForms()"
              (add)="state.addProject()"
              (remove)="state.removeProject($event)"
            />
          }
          @case (4) {
            <app-skills-section
              [skillsForms]="state.skillsForms()"
              (addSkillGroup)="state.addSkill()"
              (removeSkillGroup)="state.removeSkill($event)"
              (addCert)="state.addCertification($event)"
              (removeCert)="state.removeCertification($event)"
            />
          }
          @case (5) {
            <app-ia-section
              [iaForm]="state.iaForm"
              [isLoading]="state.isLoading()"
              (optimize)="state.optimizarCv()"
            />
          }
          @case (6) {
            <app-ats-section [iaForm]="state.iaForm" />
          }
          @case (7) {
            <app-cover-letter-section [iaForm]="state.iaForm" [cvForm]="state.cvForm" />
          }
        }
      </form>
    </div>
  </div>

  <div class="md:col-span-6 md:sticky md:top-8 h-full">
    <app-dummy-view
      [cvPreview]="state.cvPreview()"
      [hasEducation]="state.hasEducation()"
      [hasExperience]="state.hasExperience()"
      [hasProjects]="state.hasProjects()"
      [hasSkills]="state.hasSkills()"
    />
  </div>
</div>
