<ng-container *transloco="let t">
  <form [formGroup]="service.form" class="flex flex-col gap-6">
    <header class="flex flex-col gap-1 border-b border-[var(--tui-border-normal)] pb-4 -mt-4">
      <h2
        class="text-xl md:text-2xl font-bold text-[var(--tui-text-primary)] flex items-center gap-2"
      >
        <tui-icon icon="@tui.sparkles" class="text-[var(--tui-text-action)] size-6"></tui-icon>
        {{ t('cv.ia.title') }}
      </h2>
      <p class="text-[var(--tui-text-secondary)] text-base leading-snug">
        {{ t('cv.ia.subtitle') }}
      </p>
    </header>

    <div class="w-full">
      <tui-textfield tuiTextfieldSize="l" class="w-full" [tuiTextfieldCleaner]="true">
        <label tuiLabel [for]="'iaJobDescriptionInput'">
          {{ t('cv.ia.job.name') }}
        </label>
        <textarea
          tuiTextarea
          formControlName="jobDescription"
          [min]="8"
          [max]="10"
          [placeholder]="t('cv.ia.job.placeholder')"
          [id]="'iaJobDescriptionInput'"
          class="text-base leading-relaxed"
        ></textarea>
      </tui-textfield>
    </div>

    <div class="flex flex-col gap-2">
      <div class="flex items-baseline justify-between mb-2">
        <label
          tuiLabel
          [for]="'iaExaggeration'"
          class="font-bold text-lg text-[var(--tui-text-primary)]"
        >
          {{ t('cv.ia.exaggeration.title') }}
        </label>
        <tui-badge
          [appearance]="service.currentExaggeration() === 2 ? 'accent' : 'neutral'"
          class="animate-fade-in"
        >
          {{ (exaggerationLevel | keyvalue)[service.currentExaggeration()]?.value | transloco }}
        </tui-badge>
      </div>

      <div class="px-1 relative">
        <input
          tuiSlider
          [id]="'iaExaggeration'"
          type="range"
          class="w-full"
          [segments]="segments()"
          [step]="step"
          [min]="min"
          [max]="max"
          formControlName="exaggeration"
        />

        <div class="flex justify-between mt-2 px-1 pointer-events-none">
          @for (level of exaggerationLevel | keyvalue; track level.key) {
            <div class="flex flex-col items-center w-8">
              <div
                class="w-0.5 h-1.5 bg-[var(--tui-border-normal)] mb-1"
                [class.bg-[var(--tui-text-primary)]]="service.currentExaggeration() === +level.key"
              ></div>
              <span
                class="text-[10px] uppercase tracking-wider font-semibold text-[var(--tui-text-tertiary)] text-center leading-none"
                [class.text-[var(--tui-text-primary)]]="
                  service.currentExaggeration() === +level.key
                "
              >
                {{ level.value | transloco }}
              </span>
            </div>
          }
        </div>

        <p
          class="text-sm text-[var(--tui-text-secondary)] mt-4 leading-relaxed min-h-[2.5rem] animate-fade-in"
        >
          {{
            service.currentExaggeration() | exaggerationLevel: exaggerationDescriptions | transloco
          }}
        </p>
      </div>
    </div>

    <div class="pt-2 mt-auto">
      <button
        tuiButton
        type="button"
        size="xl"
        appearance="primary"
        (click)="service.optimizeCv()"
        [loading]="service.isLoading()"
        [disabled]="service.form.invalid"
        class="w-full shadow-lg transition-transform active:scale-[0.99]"
      >
        {{ t('cv.ia.exaggeration.button') }}
        <tui-icon icon="@tui.wand-2" class="ml-2"></tui-icon>
      </button>
    </div>
  </form>
</ng-container>
