import { Directive, effect, ElementRef, inject, Input, NgZone, signal, untracked, } from '@angular/core';
import { DefaultValueAccessor } from '@angular/forms';
import { Maskito, MASKITO_DEFAULT_ELEMENT_PREDICATE, maskitoTransform, } from '@maskito/core';
import * as i0 from "@angular/core";
class MaskitoDirective {
    constructor() {
        this.elementRef = inject(ElementRef).nativeElement;
        this.ngZone = inject(NgZone);
        this.maskedElement = null;
        // TODO(v4): delete excessive setters/getters
        this.optionsInternal = signal(null);
        this.elementPredicateInternal = signal(MASKITO_DEFAULT_ELEMENT_PREDICATE);
        this.initEffect = effect(async () => {
            const elementPredicate = this.elementPredicateInternal();
            const options = this.optionsInternal();
            const { maskedElement, elementRef, ngZone } = this;
            maskedElement?.destroy();
            if (!options) {
                return;
            }
            const predicateResult = await elementPredicate(elementRef);
            if (this.elementPredicate !== elementPredicate || this.options !== options) {
                // Ignore the result of the predicate if the
                // maskito element (or its options) has changed before the predicate was resolved.
                return;
            }
            ngZone.runOutsideAngular(() => {
                this.maskedElement = new Maskito(predicateResult, options);
            });
        });
        const accessor = inject(DefaultValueAccessor, { self: true, optional: true });
        if (accessor) {
            const original = accessor.writeValue.bind(accessor);
            accessor.writeValue = (value) => {
                const options = untracked(this.optionsInternal);
                original(options ? maskitoTransform(String(value ?? ''), options) : value);
            };
        }
    }
    set options(value) {
        this.optionsInternal.set(value);
    }
    set elementPredicate(value) {
        this.elementPredicateInternal.set(value);
    }
    get options() {
        return this.optionsInternal();
    }
    get elementPredicate() {
        return this.elementPredicateInternal();
    }
    // eslint-disable-next-line @angular-eslint/no-empty-lifecycle-method
    async ngOnChanges() {
        // TODO(v4): delete
    }
    ngOnDestroy() {
        this.maskedElement?.destroy();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: MaskitoDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.2.12", type: MaskitoDirective, isStandalone: true, selector: "[maskito]", inputs: { options: ["maskito", "options"], elementPredicate: ["maskitoElement", "elementPredicate"] }, usesOnChanges: true, ngImport: i0 }); }
}
export { MaskitoDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: MaskitoDirective, decorators: [{
            type: Directive,
            args: [{ standalone: true, selector: '[maskito]' }]
        }], ctorParameters: function () { return []; }, propDecorators: { options: [{
                type: Input,
                args: ['maskito']
            }], elementPredicate: [{
                type: Input,
                args: ['maskitoElement']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFza2l0by5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyL3NyYy9saWIvbWFza2l0by5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUNILFNBQVMsRUFDVCxNQUFNLEVBQ04sVUFBVSxFQUNWLE1BQU0sRUFDTixLQUFLLEVBQ0wsTUFBTSxFQUNOLE1BQU0sRUFDTixTQUFTLEdBQ1osTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFFcEQsT0FBTyxFQUNILE9BQU8sRUFDUCxpQ0FBaUMsRUFDakMsZ0JBQWdCLEdBQ25CLE1BQU0sZUFBZSxDQUFDOztBQUV2QixNQUNhLGdCQUFnQjtJQW1DekI7UUFsQ2lCLGVBQVUsR0FBZ0IsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLGFBQWEsQ0FBQztRQUMzRCxXQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pDLGtCQUFhLEdBQW1CLElBQUksQ0FBQztRQUU3Qyw2Q0FBNkM7UUFDNUIsb0JBQWUsR0FBRyxNQUFNLENBQXdCLElBQUksQ0FBQyxDQUFDO1FBQ3RELDZCQUF3QixHQUFHLE1BQU0sQ0FDOUMsaUNBQWlDLENBQ3BDLENBQUM7UUFFaUIsZUFBVSxHQUFHLE1BQU0sQ0FBQyxLQUFLLElBQUksRUFBRTtZQUM5QyxNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1lBQ3pELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN2QyxNQUFNLEVBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUMsR0FBRyxJQUFJLENBQUM7WUFFakQsYUFBYSxFQUFFLE9BQU8sRUFBRSxDQUFDO1lBRXpCLElBQUksQ0FBQyxPQUFPLEVBQUU7Z0JBQ1YsT0FBTzthQUNWO1lBRUQsTUFBTSxlQUFlLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUzRCxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsS0FBSyxnQkFBZ0IsSUFBSSxJQUFJLENBQUMsT0FBTyxLQUFLLE9BQU8sRUFBRTtnQkFDeEUsNENBQTRDO2dCQUM1QyxrRkFBa0Y7Z0JBQ2xGLE9BQU87YUFDVjtZQUVELE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUU7Z0JBQzFCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxPQUFPLENBQUMsZUFBZSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQy9ELENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7UUFHQyxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsb0JBQW9CLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBRTVFLElBQUksUUFBUSxFQUFFO1lBQ1YsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFcEQsUUFBUSxDQUFDLFVBQVUsR0FBRyxDQUFDLEtBQWMsRUFBRSxFQUFFO2dCQUNyQyxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUVoRCxRQUFRLENBQ0osT0FBTyxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQ25FLENBQUM7WUFDTixDQUFDLENBQUM7U0FDTDtJQUNMLENBQUM7SUFFRCxJQUNXLE9BQU8sQ0FBQyxLQUE0QjtRQUMzQyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsSUFDVyxnQkFBZ0IsQ0FBQyxLQUE4QjtRQUN0RCxJQUFJLENBQUMsd0JBQXdCLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFRCxJQUFXLE9BQU87UUFDZCxPQUFPLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBRUQsSUFBVyxnQkFBZ0I7UUFDdkIsT0FBTyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztJQUMzQyxDQUFDO0lBRUQscUVBQXFFO0lBQzlELEtBQUssQ0FBQyxXQUFXO1FBQ3BCLG1CQUFtQjtJQUN2QixDQUFDO0lBRU0sV0FBVztRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsT0FBTyxFQUFFLENBQUM7SUFDbEMsQ0FBQzsrR0E1RVEsZ0JBQWdCO21HQUFoQixnQkFBZ0I7O1NBQWhCLGdCQUFnQjs0RkFBaEIsZ0JBQWdCO2tCQUQ1QixTQUFTO21CQUFDLEVBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFDOzBFQXFEckMsT0FBTztzQkFEakIsS0FBSzt1QkFBQyxTQUFTO2dCQU1MLGdCQUFnQjtzQkFEMUIsS0FBSzt1QkFBQyxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7T25DaGFuZ2VzLCBPbkRlc3Ryb3l9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBEaXJlY3RpdmUsXG4gICAgZWZmZWN0LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgaW5qZWN0LFxuICAgIElucHV0LFxuICAgIE5nWm9uZSxcbiAgICBzaWduYWwsXG4gICAgdW50cmFja2VkLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7RGVmYXVsdFZhbHVlQWNjZXNzb3J9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB0eXBlIHtNYXNraXRvRWxlbWVudFByZWRpY2F0ZSwgTWFza2l0b09wdGlvbnN9IGZyb20gJ0BtYXNraXRvL2NvcmUnO1xuaW1wb3J0IHtcbiAgICBNYXNraXRvLFxuICAgIE1BU0tJVE9fREVGQVVMVF9FTEVNRU5UX1BSRURJQ0FURSxcbiAgICBtYXNraXRvVHJhbnNmb3JtLFxufSBmcm9tICdAbWFza2l0by9jb3JlJztcblxuQERpcmVjdGl2ZSh7c3RhbmRhbG9uZTogdHJ1ZSwgc2VsZWN0b3I6ICdbbWFza2l0b10nfSlcbmV4cG9ydCBjbGFzcyBNYXNraXRvRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgZWxlbWVudFJlZjogSFRNTEVsZW1lbnQgPSBpbmplY3QoRWxlbWVudFJlZikubmF0aXZlRWxlbWVudDtcbiAgICBwcml2YXRlIHJlYWRvbmx5IG5nWm9uZSA9IGluamVjdChOZ1pvbmUpO1xuICAgIHByaXZhdGUgbWFza2VkRWxlbWVudDogTWFza2l0byB8IG51bGwgPSBudWxsO1xuXG4gICAgLy8gVE9ETyh2NCk6IGRlbGV0ZSBleGNlc3NpdmUgc2V0dGVycy9nZXR0ZXJzXG4gICAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zSW50ZXJuYWwgPSBzaWduYWw8TWFza2l0b09wdGlvbnMgfCBudWxsPihudWxsKTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGVsZW1lbnRQcmVkaWNhdGVJbnRlcm5hbCA9IHNpZ25hbDxNYXNraXRvRWxlbWVudFByZWRpY2F0ZT4oXG4gICAgICAgIE1BU0tJVE9fREVGQVVMVF9FTEVNRU5UX1BSRURJQ0FURSxcbiAgICApO1xuXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGluaXRFZmZlY3QgPSBlZmZlY3QoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBlbGVtZW50UHJlZGljYXRlID0gdGhpcy5lbGVtZW50UHJlZGljYXRlSW50ZXJuYWwoKTtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9uc0ludGVybmFsKCk7XG4gICAgICAgIGNvbnN0IHttYXNrZWRFbGVtZW50LCBlbGVtZW50UmVmLCBuZ1pvbmV9ID0gdGhpcztcblxuICAgICAgICBtYXNrZWRFbGVtZW50Py5kZXN0cm95KCk7XG5cbiAgICAgICAgaWYgKCFvcHRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwcmVkaWNhdGVSZXN1bHQgPSBhd2FpdCBlbGVtZW50UHJlZGljYXRlKGVsZW1lbnRSZWYpO1xuXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnRQcmVkaWNhdGUgIT09IGVsZW1lbnRQcmVkaWNhdGUgfHwgdGhpcy5vcHRpb25zICE9PSBvcHRpb25zKSB7XG4gICAgICAgICAgICAvLyBJZ25vcmUgdGhlIHJlc3VsdCBvZiB0aGUgcHJlZGljYXRlIGlmIHRoZVxuICAgICAgICAgICAgLy8gbWFza2l0byBlbGVtZW50IChvciBpdHMgb3B0aW9ucykgaGFzIGNoYW5nZWQgYmVmb3JlIHRoZSBwcmVkaWNhdGUgd2FzIHJlc29sdmVkLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubWFza2VkRWxlbWVudCA9IG5ldyBNYXNraXRvKHByZWRpY2F0ZVJlc3VsdCwgb3B0aW9ucyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IGFjY2Vzc29yID0gaW5qZWN0KERlZmF1bHRWYWx1ZUFjY2Vzc29yLCB7c2VsZjogdHJ1ZSwgb3B0aW9uYWw6IHRydWV9KTtcblxuICAgICAgICBpZiAoYWNjZXNzb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsID0gYWNjZXNzb3Iud3JpdGVWYWx1ZS5iaW5kKGFjY2Vzc29yKTtcblxuICAgICAgICAgICAgYWNjZXNzb3Iud3JpdGVWYWx1ZSA9ICh2YWx1ZTogdW5rbm93bikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB1bnRyYWNrZWQodGhpcy5vcHRpb25zSW50ZXJuYWwpO1xuXG4gICAgICAgICAgICAgICAgb3JpZ2luYWwoXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPyBtYXNraXRvVHJhbnNmb3JtKFN0cmluZyh2YWx1ZSA/PyAnJyksIG9wdGlvbnMpIDogdmFsdWUsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoJ21hc2tpdG8nKVxuICAgIHB1YmxpYyBzZXQgb3B0aW9ucyh2YWx1ZTogTWFza2l0b09wdGlvbnMgfCBudWxsKSB7XG4gICAgICAgIHRoaXMub3B0aW9uc0ludGVybmFsLnNldCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgQElucHV0KCdtYXNraXRvRWxlbWVudCcpXG4gICAgcHVibGljIHNldCBlbGVtZW50UHJlZGljYXRlKHZhbHVlOiBNYXNraXRvRWxlbWVudFByZWRpY2F0ZSkge1xuICAgICAgICB0aGlzLmVsZW1lbnRQcmVkaWNhdGVJbnRlcm5hbC5zZXQodmFsdWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgb3B0aW9ucygpOiBNYXNraXRvT3B0aW9ucyB8IG51bGwge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zSW50ZXJuYWwoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGVsZW1lbnRQcmVkaWNhdGUoKTogTWFza2l0b0VsZW1lbnRQcmVkaWNhdGUge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50UHJlZGljYXRlSW50ZXJuYWwoKTtcbiAgICB9XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLWVtcHR5LWxpZmVjeWNsZS1tZXRob2RcbiAgICBwdWJsaWMgYXN5bmMgbmdPbkNoYW5nZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIC8vIFRPRE8odjQpOiBkZWxldGVcbiAgICB9XG5cbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMubWFza2VkRWxlbWVudD8uZGVzdHJveSgpO1xuICAgIH1cbn1cbiJdfQ==