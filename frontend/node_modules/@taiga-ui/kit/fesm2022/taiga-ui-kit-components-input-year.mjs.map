{"version":3,"file":"taiga-ui-kit-components-input-year.mjs","sources":["../../../projects/kit/components/input-year/input-year.options.ts","../../../projects/kit/components/input-year/input-year.directive.ts","../../../projects/kit/components/input-year/input-year.ts","../../../projects/kit/components/input-year/taiga-ui-kit-components-input-year.ts"],"sourcesContent":["import {type FactoryProvider, inject, InjectionToken} from '@angular/core';\nimport {\n    TUI_IDENTITY_VALUE_TRANSFORMER,\n    type TuiValueTransformer,\n} from '@taiga-ui/cdk/classes';\nimport {tuiProvideOptions} from '@taiga-ui/cdk/utils/miscellaneous';\nimport {\n    TUI_INPUT_DATE_DEFAULT_OPTIONS_NEW,\n    TUI_INPUT_DATE_OPTIONS_NEW,\n    type TuiInputDateOptionsNew,\n} from '@taiga-ui/kit/components/input-date';\n\nexport interface TuiInputYearOptions\n    extends Omit<TuiInputDateOptionsNew, 'valueTransformer'> {\n    readonly valueTransformer: TuiValueTransformer<number | null, any>;\n}\n\nexport const TUI_INPUT_YEAR_OPTIONS = new InjectionToken<TuiInputYearOptions>(\n    ngDevMode ? 'TUI_INPUT_YEAR_OPTIONS' : '',\n    {\n        factory: () => ({\n            ...inject(TUI_INPUT_DATE_OPTIONS_NEW),\n            valueTransformer: TUI_IDENTITY_VALUE_TRANSFORMER,\n        }),\n    },\n);\n\nexport const tuiInputInputYearOptionsProvider = (\n    options: Partial<TuiInputYearOptions>,\n): FactoryProvider =>\n    tuiProvideOptions(\n        TUI_INPUT_YEAR_OPTIONS,\n        options,\n        TUI_INPUT_DATE_DEFAULT_OPTIONS_NEW,\n    );\n","import {computed, Directive, effect, inject, Input, signal} from '@angular/core';\nimport {MaskitoDirective} from '@maskito/angular';\nimport {maskitoNumberOptionsGenerator} from '@maskito/kit';\nimport {tuiAsControl, TuiControl, tuiValueTransformerFrom} from '@taiga-ui/cdk/classes';\nimport {TUI_ALLOW_SIGNAL_WRITES} from '@taiga-ui/cdk/constants';\nimport {TuiCalendarYear} from '@taiga-ui/core/components/calendar';\nimport {\n    tuiInjectAuxiliary,\n    TuiTextfieldDirective,\n    tuiTextfieldIconBinding,\n    TuiWithTextfield,\n} from '@taiga-ui/core/components/textfield';\nimport {\n    TuiDropdownAuto,\n    tuiDropdownEnabled,\n    tuiDropdownOpen,\n} from '@taiga-ui/core/directives/dropdown';\nimport {tuiMaskito} from '@taiga-ui/kit/utils';\n\nimport {TUI_INPUT_YEAR_OPTIONS} from './input-year.options';\n\n@Directive({\n    standalone: true,\n    selector: 'input[tuiInputYear]',\n    providers: [\n        tuiAsControl(TuiInputYearDirective),\n        tuiValueTransformerFrom(TUI_INPUT_YEAR_OPTIONS),\n    ],\n    hostDirectives: [TuiWithTextfield, MaskitoDirective, TuiDropdownAuto],\n    host: {\n        maxlength: '4',\n        inputmode: 'numeric',\n        '[disabled]': 'disabled()',\n        '(click)': 'toggle()',\n        '(input)': 'onInput($event.target.value)',\n    },\n})\nexport class TuiInputYearDirective extends TuiControl<number | null> {\n    private readonly options = inject(TUI_INPUT_YEAR_OPTIONS);\n    private readonly textfield = inject(TuiTextfieldDirective);\n    private readonly open = tuiDropdownOpen();\n\n    private readonly initialItem = computed(\n        () => this.value() ?? this.calendar()?.initialItem() ?? null,\n    );\n\n    protected readonly calendar = tuiInjectAuxiliary<TuiCalendarYear>(\n        (x) => x instanceof TuiCalendarYear,\n    );\n\n    protected readonly dropdownEnabled = tuiDropdownEnabled(this.interactive);\n    protected readonly icon = tuiTextfieldIconBinding(TUI_INPUT_YEAR_OPTIONS);\n    protected readonly min = signal(this.options.min.year);\n    protected readonly max = signal(this.options.max.year);\n\n    /**\n     * TODO: move to [value]=\"value()\" after update to Angular 17+\n     * something wrong with change detection on host binding\n     */\n    protected readonly valueEffect = effect(\n        () => this.textfield.value.set(this.value()?.toString() ?? ''),\n        TUI_ALLOW_SIGNAL_WRITES,\n    );\n\n    protected readonly mask = tuiMaskito(\n        computed(() =>\n            maskitoNumberOptionsGenerator({\n                min: this.min(),\n                max: this.max(),\n                thousandSeparator: '',\n            }),\n        ),\n    );\n\n    protected readonly calendarInEffect = effect(() => {\n        const calendar = this.calendar();\n\n        if (calendar) {\n            calendar.initialItemSetter = this.initialItem();\n            calendar.value.set(this.value());\n            calendar.min.set(this.min());\n            calendar.max.set(this.max());\n        }\n    }, TUI_ALLOW_SIGNAL_WRITES);\n\n    protected readonly calendarOutEffect = effect((onCleanup) => {\n        const subscription = this.calendar()?.yearClick.subscribe((year) => {\n            this.onChange(year);\n            this.open.set(false);\n        });\n\n        onCleanup(() => subscription?.unsubscribe());\n    });\n\n    // TODO(v5): use signal inputs\n    @Input('min')\n    public set minSetter(x: number) {\n        this.min.set(x);\n    }\n\n    // TODO(v5): use signal inputs\n    @Input('max')\n    public set maxSetter(x: number) {\n        this.max.set(x);\n    }\n\n    protected toggle(): void {\n        if (this.interactive()) {\n            this.open.update((x) => !x);\n        }\n    }\n\n    protected onInput(raw: string): void {\n        const value = Number(raw);\n\n        this.onChange(!raw || Number.isNaN(value) ? null : value);\n    }\n}\n","import {TuiCalendarYear} from '@taiga-ui/core/components/calendar';\n\nimport {TuiInputYearDirective} from './input-year.directive';\n\nexport const TuiInputYear = [TuiInputYearDirective, TuiCalendarYear] as const;\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}