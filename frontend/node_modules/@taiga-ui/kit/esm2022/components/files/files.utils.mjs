import { coerceArray } from '@angular/cdk/coercion';
import { tuiRound } from '@taiga-ui/cdk/utils/math';
import { TUI_FORMAT_ERROR, TUI_SIZE_ERROR } from './files.validators';
const BYTES_PER_KIB = 1024;
const BYTES_PER_MIB = 1024 * BYTES_PER_KIB;
export function tuiFilesRejected(control) {
    const format = control?.getError(TUI_FORMAT_ERROR)?.$implicit || [];
    const size = control?.getError(TUI_SIZE_ERROR)?.$implicit || [];
    return Array.from(new Set([...format, ...size]));
}
export function tuiFilesAccepted(control) {
    const value = control?.value || [];
    const files = coerceArray(value);
    const size = control?.getError(TUI_SIZE_ERROR)?.$implicit || [];
    const format = control?.getError(TUI_FORMAT_ERROR)?.$implicit || [];
    return files.filter((file) => !size.includes(file) && !format.includes(file));
}
export function tuiFormatSize(units, size, locale) {
    if (size === undefined) {
        return null;
    }
    if (size < BYTES_PER_KIB) {
        return `${size} ${units[0]}`;
    }
    if (size < BYTES_PER_MIB) {
        return `${(size / BYTES_PER_KIB).toFixed(0)} ${units[1]}`;
    }
    return `${tuiRound(size / BYTES_PER_MIB, 2).toLocaleString(locale)} ${units[2]}`;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZXMudXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9raXQvY29tcG9uZW50cy9maWxlcy9maWxlcy51dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFFbEQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRWxELE9BQU8sRUFBQyxnQkFBZ0IsRUFBRSxjQUFjLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUVwRSxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUM7QUFDM0IsTUFBTSxhQUFhLEdBQUcsSUFBSSxHQUFHLGFBQWEsQ0FBQztBQUUzQyxNQUFNLFVBQVUsZ0JBQWdCLENBQUMsT0FBZ0M7SUFDN0QsTUFBTSxNQUFNLEdBQVcsT0FBTyxFQUFFLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLFNBQVMsSUFBSSxFQUFFLENBQUM7SUFDNUUsTUFBTSxJQUFJLEdBQVcsT0FBTyxFQUFFLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxTQUFTLElBQUksRUFBRSxDQUFDO0lBRXhFLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3JELENBQUM7QUFFRCxNQUFNLFVBQVUsZ0JBQWdCLENBQUMsT0FBZ0M7SUFDN0QsTUFBTSxLQUFLLEdBQUcsT0FBTyxFQUFFLEtBQUssSUFBSSxFQUFFLENBQUM7SUFDbkMsTUFBTSxLQUFLLEdBQVcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pDLE1BQU0sSUFBSSxHQUFXLE9BQU8sRUFBRSxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUUsU0FBUyxJQUFJLEVBQUUsQ0FBQztJQUN4RSxNQUFNLE1BQU0sR0FBVyxPQUFPLEVBQUUsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsU0FBUyxJQUFJLEVBQUUsQ0FBQztJQUU1RSxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNsRixDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWEsQ0FDekIsS0FBd0MsRUFDeEMsSUFBYSxFQUNiLE1BQWU7SUFFZixJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7UUFDcEIsT0FBTyxJQUFJLENBQUM7S0FDZjtJQUVELElBQUksSUFBSSxHQUFHLGFBQWEsRUFBRTtRQUN0QixPQUFPLEdBQUcsSUFBSSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0tBQ2hDO0lBRUQsSUFBSSxJQUFJLEdBQUcsYUFBYSxFQUFFO1FBQ3RCLE9BQU8sR0FBRyxDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7S0FDN0Q7SUFFRCxPQUFPLEdBQUcsUUFBUSxDQUFDLElBQUksR0FBRyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQ3JGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2NvZXJjZUFycmF5fSBmcm9tICdAYW5ndWxhci9jZGsvY29lcmNpb24nO1xuaW1wb3J0IHt0eXBlIEFic3RyYWN0Q29udHJvbH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHt0dWlSb3VuZH0gZnJvbSAnQHRhaWdhLXVpL2Nkay91dGlscy9tYXRoJztcblxuaW1wb3J0IHtUVUlfRk9STUFUX0VSUk9SLCBUVUlfU0laRV9FUlJPUn0gZnJvbSAnLi9maWxlcy52YWxpZGF0b3JzJztcblxuY29uc3QgQllURVNfUEVSX0tJQiA9IDEwMjQ7XG5jb25zdCBCWVRFU19QRVJfTUlCID0gMTAyNCAqIEJZVEVTX1BFUl9LSUI7XG5cbmV4cG9ydCBmdW5jdGlvbiB0dWlGaWxlc1JlamVjdGVkKGNvbnRyb2w/OiBBYnN0cmFjdENvbnRyb2wgfCBudWxsKTogRmlsZVtdIHtcbiAgICBjb25zdCBmb3JtYXQ6IEZpbGVbXSA9IGNvbnRyb2w/LmdldEVycm9yKFRVSV9GT1JNQVRfRVJST1IpPy4kaW1wbGljaXQgfHwgW107XG4gICAgY29uc3Qgc2l6ZTogRmlsZVtdID0gY29udHJvbD8uZ2V0RXJyb3IoVFVJX1NJWkVfRVJST1IpPy4kaW1wbGljaXQgfHwgW107XG5cbiAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KFsuLi5mb3JtYXQsIC4uLnNpemVdKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0dWlGaWxlc0FjY2VwdGVkKGNvbnRyb2w/OiBBYnN0cmFjdENvbnRyb2wgfCBudWxsKTogRmlsZVtdIHtcbiAgICBjb25zdCB2YWx1ZSA9IGNvbnRyb2w/LnZhbHVlIHx8IFtdO1xuICAgIGNvbnN0IGZpbGVzOiBGaWxlW10gPSBjb2VyY2VBcnJheSh2YWx1ZSk7XG4gICAgY29uc3Qgc2l6ZTogRmlsZVtdID0gY29udHJvbD8uZ2V0RXJyb3IoVFVJX1NJWkVfRVJST1IpPy4kaW1wbGljaXQgfHwgW107XG4gICAgY29uc3QgZm9ybWF0OiBGaWxlW10gPSBjb250cm9sPy5nZXRFcnJvcihUVUlfRk9STUFUX0VSUk9SKT8uJGltcGxpY2l0IHx8IFtdO1xuXG4gICAgcmV0dXJuIGZpbGVzLmZpbHRlcigoZmlsZSkgPT4gIXNpemUuaW5jbHVkZXMoZmlsZSkgJiYgIWZvcm1hdC5pbmNsdWRlcyhmaWxlKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0dWlGb3JtYXRTaXplKFxuICAgIHVuaXRzOiByZWFkb25seSBbc3RyaW5nLCBzdHJpbmcsIHN0cmluZ10sXG4gICAgc2l6ZT86IG51bWJlcixcbiAgICBsb2NhbGU/OiBzdHJpbmcsXG4pOiBzdHJpbmcgfCBudWxsIHtcbiAgICBpZiAoc2l6ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmIChzaXplIDwgQllURVNfUEVSX0tJQikge1xuICAgICAgICByZXR1cm4gYCR7c2l6ZX0gJHt1bml0c1swXX1gO1xuICAgIH1cblxuICAgIGlmIChzaXplIDwgQllURVNfUEVSX01JQikge1xuICAgICAgICByZXR1cm4gYCR7KHNpemUgLyBCWVRFU19QRVJfS0lCKS50b0ZpeGVkKDApfSAke3VuaXRzWzFdfWA7XG4gICAgfVxuXG4gICAgcmV0dXJuIGAke3R1aVJvdW5kKHNpemUgLyBCWVRFU19QRVJfTUlCLCAyKS50b0xvY2FsZVN0cmluZyhsb2NhbGUpfSAke3VuaXRzWzJdfWA7XG59XG4iXX0=