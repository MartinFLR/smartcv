import { NgIf } from '@angular/common';
import { ChangeDetectionStrategy, Component, computed, ElementRef, inject, Input, signal, ViewChild, } from '@angular/core';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { TUI_IS_MOBILE } from '@taiga-ui/cdk/tokens';
import { tuiDirectiveBinding, tuiIsString } from '@taiga-ui/cdk/utils/miscellaneous';
import { TuiButton } from '@taiga-ui/core/components/button';
import { TUI_TEXTFIELD_OPTIONS, TuiTextfieldComponent, } from '@taiga-ui/core/components/textfield';
import { TuiAppearance } from '@taiga-ui/core/directives/appearance';
import { TuiHintDirective, TuiHintOverflow } from '@taiga-ui/core/directives/hint';
import { TUI_ITEMS_HANDLERS, } from '@taiga-ui/core/directives/items-handlers';
import { TUI_COMMON_ICONS } from '@taiga-ui/core/tokens';
import { TuiChip } from '@taiga-ui/kit/components/chip';
import { TuiFade } from '@taiga-ui/kit/directives/fade';
import { tuiInjectValue } from '@taiga-ui/kit/utils';
import { injectContext } from '@taiga-ui/polymorpheus';
import * as i0 from "@angular/core";
import * as i1 from "@taiga-ui/kit/components/chip";
import * as i2 from "@angular/forms";
class TuiInputChipComponent {
    constructor() {
        this.options = inject(TUI_TEXTFIELD_OPTIONS);
        this.context = injectContext();
        this.value = tuiInjectValue();
        this.icons = inject(TUI_COMMON_ICONS);
        this.mobile = inject(TUI_IS_MOBILE);
        this.internal = signal(this.context.$implicit.item);
        this.editing = signal(false);
        this.hint = inject(TuiHintDirective, { self: true, optional: true });
        this.handlers = inject(TUI_ITEMS_HANDLERS);
        this.textfield = inject(TuiTextfieldComponent);
        this.disabled = tuiDirectiveBinding(TuiAppearance, 'tuiAppearanceState', computed(() => this.handlers.disabledItemHandler()(this.context.$implicit.item)
            ? 'disabled'
            : null));
        this.size = tuiDirectiveBinding(TuiChip, 'size', computed(() => (this.options.size() === 'l' ? 's' : 'xs')));
        this.editable = true;
    }
    get index() {
        return this.context.$implicit.index;
    }
    delete() {
        this.textfield.cva?.onChange(this.value().filter((_, i) => i !== this.index));
        if (!this.mobile) {
            this.textfield.input?.nativeElement.focus({ preventScroll: true });
        }
    }
    save() {
        if (!this.internal()) {
            this.delete();
        }
        else if (this.handlers.disabledItemHandler()(this.internal())) {
            return;
        }
        const value = this.value().map((item, index) => index === this.index ? this.internal() : item);
        this.textfield.cva?.onChange(value);
        this.editing.set(false);
        this.textfield.input?.nativeElement.focus({ preventScroll: true });
    }
    cancel() {
        this.editing.set(false);
        this.internal.set(this.context.$implicit.item);
    }
    edit() {
        if (!this.editable ||
            !this.textfield.cva?.interactive() ||
            !tuiIsString(this.internal())) {
            return;
        }
        this.editing.set(true);
        setTimeout(() => this.input?.nativeElement.focus());
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiInputChipComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: TuiInputChipComponent, isStandalone: true, selector: "tui-input-chip", inputs: { editable: "editable" }, host: { attributes: { "tuiChip": "" }, listeners: { "click": "editing() && $event.stopPropagation()", "keydown.backspace.prevent": "delete()", "keydown.enter.prevent": "edit()", "dblclick": "edit()" }, properties: { "class._edit": "editing()", "attr.tabIndex": "disabled() ? null : -1" }, classAttribute: "tui-interactive" }, viewQueries: [{ propertyName: "input", first: true, predicate: TuiChip, descendants: true, read: ElementRef }], hostDirectives: [{ directive: i1.TuiChip }], ngImport: i0, template: "<input\n    appearance=\"\"\n    enterkeyhint=\"enter\"\n    tuiChip\n    class=\"t-input\"\n    [disabled]=\"!editing()\"\n    [ngModel]=\"internal()\"\n    [ngModelOptions]=\"{standalone: true}\"\n    (blur)=\"cancel()\"\n    (keydown.enter)=\"save()\"\n    (keydown.esc)=\"cancel()\"\n    (keydown.stop)=\"(0)\"\n    (ngModelChange)=\"internal.set($event)\"\n/>\n<div\n    tuiFade\n    tuiFadeOffset=\"0.5rem\"\n    class=\"t-text\"\n    [tuiHintOverflow]=\"hint?.content() ? null : handlers.stringify()(internal())\"\n    (mousedown.prevent.zoneless)=\"(0)\"\n>\n    {{ handlers.stringify()(internal()) }}\n</div>\n<button\n    *ngIf=\"textfield.cva?.interactive() && !editing() && !disabled()\"\n    tabIndex=\"-1\"\n    tuiIconButton\n    type=\"button\"\n    [iconStart]=\"icons.close\"\n    (click.stop)=\"delete()\"\n    (pointerdown.prevent.stop.zoneless)=\"(0)\"\n>\n    Remove\n</button>\n", styles: [":host{cursor:pointer;margin:.125rem 0;margin-inline-end:.25rem}:host[data-state=disabled]{pointer-events:none}:host .t-input{padding:0;text-indent:.375rem;transition:none;color:var(--tui-text-primary);cursor:text;outline:none}:host .t-input:disabled{visibility:hidden}:host._edit{background:transparent}:host._edit .t-text{pointer-events:none;visibility:hidden}:host._edit:before{color:transparent;transition:none}:host-context(tui-textfield[data-size=\"s\"]){left:-.375rem;inset-inline-start:-.375rem;margin:.0625rem 0;margin-inline-end:.125rem}:host-context(tui-textfield[data-size=\"m\"]){left:-.125rem;inset-inline-start:-.125rem}:host-context(tui-textfield[data-size=\"l\"]){left:-.25rem;inset-inline-start:-.25rem}:host-context(tui-textfield[data-size=\"l\"]) .t-input{text-indent:.625rem}\n"], dependencies: [{ kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i2.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i2.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: TuiButton, selector: "a[tuiButton],button[tuiButton],a[tuiIconButton],button[tuiIconButton]", inputs: ["size"] }, { kind: "directive", type: TuiChip, selector: "tui-chip,[tuiChip]", inputs: ["size"] }, { kind: "directive", type: TuiFade, selector: "[tuiFade]", inputs: ["tuiFadeHeight", "tuiFadeSize", "tuiFadeOffset", "tuiFade"] }, { kind: "directive", type: TuiHintOverflow, selector: "[tuiHintOverflow]", inputs: ["tuiHintOverflow"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { TuiInputChipComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiInputChipComponent, decorators: [{
            type: Component,
            args: [{ standalone: true, selector: 'tui-input-chip', imports: [
                        FormsModule,
                        NgIf,
                        ReactiveFormsModule,
                        TuiButton,
                        TuiChip,
                        TuiFade,
                        TuiHintOverflow,
                    ], changeDetection: ChangeDetectionStrategy.OnPush, hostDirectives: [TuiChip], host: {
                        tuiChip: '',
                        class: 'tui-interactive',
                        '[class._edit]': 'editing()',
                        '[attr.tabIndex]': 'disabled() ? null : -1',
                        '(click)': 'editing() && $event.stopPropagation()',
                        '(keydown.backspace.prevent)': 'delete()',
                        '(keydown.enter.prevent)': 'edit()',
                        '(dblclick)': 'edit()',
                    }, template: "<input\n    appearance=\"\"\n    enterkeyhint=\"enter\"\n    tuiChip\n    class=\"t-input\"\n    [disabled]=\"!editing()\"\n    [ngModel]=\"internal()\"\n    [ngModelOptions]=\"{standalone: true}\"\n    (blur)=\"cancel()\"\n    (keydown.enter)=\"save()\"\n    (keydown.esc)=\"cancel()\"\n    (keydown.stop)=\"(0)\"\n    (ngModelChange)=\"internal.set($event)\"\n/>\n<div\n    tuiFade\n    tuiFadeOffset=\"0.5rem\"\n    class=\"t-text\"\n    [tuiHintOverflow]=\"hint?.content() ? null : handlers.stringify()(internal())\"\n    (mousedown.prevent.zoneless)=\"(0)\"\n>\n    {{ handlers.stringify()(internal()) }}\n</div>\n<button\n    *ngIf=\"textfield.cva?.interactive() && !editing() && !disabled()\"\n    tabIndex=\"-1\"\n    tuiIconButton\n    type=\"button\"\n    [iconStart]=\"icons.close\"\n    (click.stop)=\"delete()\"\n    (pointerdown.prevent.stop.zoneless)=\"(0)\"\n>\n    Remove\n</button>\n", styles: [":host{cursor:pointer;margin:.125rem 0;margin-inline-end:.25rem}:host[data-state=disabled]{pointer-events:none}:host .t-input{padding:0;text-indent:.375rem;transition:none;color:var(--tui-text-primary);cursor:text;outline:none}:host .t-input:disabled{visibility:hidden}:host._edit{background:transparent}:host._edit .t-text{pointer-events:none;visibility:hidden}:host._edit:before{color:transparent;transition:none}:host-context(tui-textfield[data-size=\"s\"]){left:-.375rem;inset-inline-start:-.375rem;margin:.0625rem 0;margin-inline-end:.125rem}:host-context(tui-textfield[data-size=\"m\"]){left:-.125rem;inset-inline-start:-.125rem}:host-context(tui-textfield[data-size=\"l\"]){left:-.25rem;inset-inline-start:-.25rem}:host-context(tui-textfield[data-size=\"l\"]) .t-input{text-indent:.625rem}\n"] }]
        }], propDecorators: { input: [{
                type: ViewChild,
                args: [TuiChip, { read: ElementRef }]
            }], editable: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtY2hpcC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9raXQvY29tcG9uZW50cy9pbnB1dC1jaGlwL2lucHV0LWNoaXAuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMva2l0L2NvbXBvbmVudHMvaW5wdXQtY2hpcC9pbnB1dC1jaGlwLnRlbXBsYXRlLmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3JDLE9BQU8sRUFDSCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFFBQVEsRUFDUixVQUFVLEVBQ1YsTUFBTSxFQUNOLEtBQUssRUFDTCxNQUFNLEVBQ04sU0FBUyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxXQUFXLEVBQUUsbUJBQW1CLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFFbkQsT0FBTyxFQUFDLG1CQUFtQixFQUFFLFdBQVcsRUFBQyxNQUFNLG1DQUFtQyxDQUFDO0FBQ25GLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUMzRCxPQUFPLEVBQ0gscUJBQXFCLEVBQ3JCLHFCQUFxQixHQUV4QixNQUFNLHFDQUFxQyxDQUFDO0FBQzdDLE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxzQ0FBc0MsQ0FBQztBQUNuRSxPQUFPLEVBQUMsZ0JBQWdCLEVBQUUsZUFBZSxFQUFDLE1BQU0sZ0NBQWdDLENBQUM7QUFDakYsT0FBTyxFQUNILGtCQUFrQixHQUVyQixNQUFNLDBDQUEwQyxDQUFDO0FBQ2xELE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLHVCQUF1QixDQUFDO0FBQ3ZELE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQztBQUN0RCxP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Q1gsSUFBSTt3QkFDSixtQkFBbUI7d0JBQ25CLFNBQVM7d0JBQ1QsT0FBTzt3QkFDUCxPQUFPO3dCQUNQLGVBQWU7cUJBQ2xCLG1CQUdnQix1QkFBdUIsQ0FBQyxNQUFNLGtCQUMvQixDQUFDLE9BQU8sQ0FBQyxRQUNuQjt3QkFDRixPQUFPLEVBQUUsRUFBRTt3QkFDWCxLQUFLLEVBQUUsaUJBQWlCO3dCQUN4QixlQUFlLEVBQUUsV0FBVzt3QkFDNUIsaUJBQWlCLEVBQUUsd0JBQXdCO3dCQUMzQyxTQUFTLEVBQUUsdUNBQXVDO3dCQUNsRCw2QkFBNkIsRUFBRSxVQUFVO3dCQUN6Qyx5QkFBeUIsRUFBRSxRQUFRO3dCQUNuQyxZQUFZLEVBQUUsUUFBUTtxQkFDekI7OEJBSWdCLEtBQUs7c0JBRHJCLFNBQVM7dUJBQUMsT0FBTyxFQUFFLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBQztnQkFnQy9CLFFBQVE7c0JBRGQsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7TmdJZn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICAgQ29tcG9uZW50LFxuICAgIGNvbXB1dGVkLFxuICAgIEVsZW1lbnRSZWYsXG4gICAgaW5qZWN0LFxuICAgIElucHV0LFxuICAgIHNpZ25hbCxcbiAgICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtGb3Jtc01vZHVsZSwgUmVhY3RpdmVGb3Jtc01vZHVsZX0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtUVUlfSVNfTU9CSUxFfSBmcm9tICdAdGFpZ2EtdWkvY2RrL3Rva2Vucyc7XG5pbXBvcnQge3R5cGUgVHVpQ29udGV4dH0gZnJvbSAnQHRhaWdhLXVpL2Nkay90eXBlcyc7XG5pbXBvcnQge3R1aURpcmVjdGl2ZUJpbmRpbmcsIHR1aUlzU3RyaW5nfSBmcm9tICdAdGFpZ2EtdWkvY2RrL3V0aWxzL21pc2NlbGxhbmVvdXMnO1xuaW1wb3J0IHtUdWlCdXR0b259IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbXBvbmVudHMvYnV0dG9uJztcbmltcG9ydCB7XG4gICAgVFVJX1RFWFRGSUVMRF9PUFRJT05TLFxuICAgIFR1aVRleHRmaWVsZENvbXBvbmVudCxcbiAgICB0eXBlIFR1aVRleHRmaWVsZEl0ZW0sXG59IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbXBvbmVudHMvdGV4dGZpZWxkJztcbmltcG9ydCB7VHVpQXBwZWFyYW5jZX0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvZGlyZWN0aXZlcy9hcHBlYXJhbmNlJztcbmltcG9ydCB7VHVpSGludERpcmVjdGl2ZSwgVHVpSGludE92ZXJmbG93fSBmcm9tICdAdGFpZ2EtdWkvY29yZS9kaXJlY3RpdmVzL2hpbnQnO1xuaW1wb3J0IHtcbiAgICBUVUlfSVRFTVNfSEFORExFUlMsXG4gICAgdHlwZSBUdWlJdGVtc0hhbmRsZXJzLFxufSBmcm9tICdAdGFpZ2EtdWkvY29yZS9kaXJlY3RpdmVzL2l0ZW1zLWhhbmRsZXJzJztcbmltcG9ydCB7VFVJX0NPTU1PTl9JQ09OU30gZnJvbSAnQHRhaWdhLXVpL2NvcmUvdG9rZW5zJztcbmltcG9ydCB7VHVpQ2hpcH0gZnJvbSAnQHRhaWdhLXVpL2tpdC9jb21wb25lbnRzL2NoaXAnO1xuaW1wb3J0IHtUdWlGYWRlfSBmcm9tICdAdGFpZ2EtdWkva2l0L2RpcmVjdGl2ZXMvZmFkZSc7XG5pbXBvcnQge3R1aUluamVjdFZhbHVlfSBmcm9tICdAdGFpZ2EtdWkva2l0L3V0aWxzJztcbmltcG9ydCB7aW5qZWN0Q29udGV4dH0gZnJvbSAnQHRhaWdhLXVpL3BvbHltb3JwaGV1cyc7XG5cbkBDb21wb25lbnQoe1xuICAgIHN0YW5kYWxvbmU6IHRydWUsXG4gICAgc2VsZWN0b3I6ICd0dWktaW5wdXQtY2hpcCcsXG4gICAgaW1wb3J0czogW1xuICAgICAgICBGb3Jtc01vZHVsZSxcbiAgICAgICAgTmdJZixcbiAgICAgICAgUmVhY3RpdmVGb3Jtc01vZHVsZSxcbiAgICAgICAgVHVpQnV0dG9uLFxuICAgICAgICBUdWlDaGlwLFxuICAgICAgICBUdWlGYWRlLFxuICAgICAgICBUdWlIaW50T3ZlcmZsb3csXG4gICAgXSxcbiAgICB0ZW1wbGF0ZVVybDogJy4vaW5wdXQtY2hpcC50ZW1wbGF0ZS5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9pbnB1dC1jaGlwLnN0eWxlcy5sZXNzJ10sXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgaG9zdERpcmVjdGl2ZXM6IFtUdWlDaGlwXSxcbiAgICBob3N0OiB7XG4gICAgICAgIHR1aUNoaXA6ICcnLFxuICAgICAgICBjbGFzczogJ3R1aS1pbnRlcmFjdGl2ZScsXG4gICAgICAgICdbY2xhc3MuX2VkaXRdJzogJ2VkaXRpbmcoKScsXG4gICAgICAgICdbYXR0ci50YWJJbmRleF0nOiAnZGlzYWJsZWQoKSA/IG51bGwgOiAtMScsXG4gICAgICAgICcoY2xpY2spJzogJ2VkaXRpbmcoKSAmJiAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCknLFxuICAgICAgICAnKGtleWRvd24uYmFja3NwYWNlLnByZXZlbnQpJzogJ2RlbGV0ZSgpJyxcbiAgICAgICAgJyhrZXlkb3duLmVudGVyLnByZXZlbnQpJzogJ2VkaXQoKScsXG4gICAgICAgICcoZGJsY2xpY2spJzogJ2VkaXQoKScsXG4gICAgfSxcbn0pXG5leHBvcnQgY2xhc3MgVHVpSW5wdXRDaGlwQ29tcG9uZW50PFQ+IHtcbiAgICBAVmlld0NoaWxkKFR1aUNoaXAsIHtyZWFkOiBFbGVtZW50UmVmfSlcbiAgICBwcml2YXRlIHJlYWRvbmx5IGlucHV0PzogRWxlbWVudFJlZjxIVE1MSW5wdXRFbGVtZW50PjtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgb3B0aW9ucyA9IGluamVjdChUVUlfVEVYVEZJRUxEX09QVElPTlMpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgY29udGV4dCA9IGluamVjdENvbnRleHQ8VHVpQ29udGV4dDxUdWlUZXh0ZmllbGRJdGVtPFQ+Pj4oKTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHZhbHVlID0gdHVpSW5qZWN0VmFsdWU8cmVhZG9ubHkgVFtdPigpO1xuXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGljb25zID0gaW5qZWN0KFRVSV9DT01NT05fSUNPTlMpO1xuICAgIHByb3RlY3RlZCByZWFkb25seSBtb2JpbGUgPSBpbmplY3QoVFVJX0lTX01PQklMRSk7XG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGludGVybmFsID0gc2lnbmFsKHRoaXMuY29udGV4dC4kaW1wbGljaXQuaXRlbSk7XG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGVkaXRpbmcgPSBzaWduYWwoZmFsc2UpO1xuICAgIHByb3RlY3RlZCByZWFkb25seSBoaW50ID0gaW5qZWN0KFR1aUhpbnREaXJlY3RpdmUsIHtzZWxmOiB0cnVlLCBvcHRpb25hbDogdHJ1ZX0pO1xuICAgIHByb3RlY3RlZCByZWFkb25seSBoYW5kbGVyczogVHVpSXRlbXNIYW5kbGVyczxUPiA9IGluamVjdChUVUlfSVRFTVNfSEFORExFUlMpO1xuICAgIHByb3RlY3RlZCByZWFkb25seSB0ZXh0ZmllbGQgPSBpbmplY3QoVHVpVGV4dGZpZWxkQ29tcG9uZW50KTtcblxuICAgIHByb3RlY3RlZCByZWFkb25seSBkaXNhYmxlZCA9IHR1aURpcmVjdGl2ZUJpbmRpbmcoXG4gICAgICAgIFR1aUFwcGVhcmFuY2UsXG4gICAgICAgICd0dWlBcHBlYXJhbmNlU3RhdGUnLFxuICAgICAgICBjb21wdXRlZCgoKSA9PlxuICAgICAgICAgICAgdGhpcy5oYW5kbGVycy5kaXNhYmxlZEl0ZW1IYW5kbGVyKCkodGhpcy5jb250ZXh0LiRpbXBsaWNpdC5pdGVtKVxuICAgICAgICAgICAgICAgID8gJ2Rpc2FibGVkJ1xuICAgICAgICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgKSxcbiAgICApO1xuXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IHNpemUgPSB0dWlEaXJlY3RpdmVCaW5kaW5nKFxuICAgICAgICBUdWlDaGlwLFxuICAgICAgICAnc2l6ZScsXG4gICAgICAgIGNvbXB1dGVkKCgpID0+ICh0aGlzLm9wdGlvbnMuc2l6ZSgpID09PSAnbCcgPyAncycgOiAneHMnKSksXG4gICAgKTtcblxuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGVkaXRhYmxlID0gdHJ1ZTtcblxuICAgIHByb3RlY3RlZCBnZXQgaW5kZXgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGV4dC4kaW1wbGljaXQuaW5kZXg7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGRlbGV0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50ZXh0ZmllbGQuY3ZhPy5vbkNoYW5nZSh0aGlzLnZhbHVlKCkuZmlsdGVyKChfLCBpKSA9PiBpICE9PSB0aGlzLmluZGV4KSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLm1vYmlsZSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0ZmllbGQuaW5wdXQ/Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoe3ByZXZlbnRTY3JvbGw6IHRydWV9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBzYXZlKCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuaW50ZXJuYWwoKSkge1xuICAgICAgICAgICAgdGhpcy5kZWxldGUoKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmhhbmRsZXJzLmRpc2FibGVkSXRlbUhhbmRsZXIoKSh0aGlzLmludGVybmFsKCkpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMudmFsdWUoKS5tYXAoKGl0ZW0sIGluZGV4KSA9PlxuICAgICAgICAgICAgaW5kZXggPT09IHRoaXMuaW5kZXggPyB0aGlzLmludGVybmFsKCkgOiBpdGVtLFxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMudGV4dGZpZWxkLmN2YT8ub25DaGFuZ2UodmFsdWUpO1xuICAgICAgICB0aGlzLmVkaXRpbmcuc2V0KGZhbHNlKTtcbiAgICAgICAgdGhpcy50ZXh0ZmllbGQuaW5wdXQ/Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoe3ByZXZlbnRTY3JvbGw6IHRydWV9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgY2FuY2VsKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVkaXRpbmcuc2V0KGZhbHNlKTtcbiAgICAgICAgdGhpcy5pbnRlcm5hbC5zZXQodGhpcy5jb250ZXh0LiRpbXBsaWNpdC5pdGVtKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZWRpdCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgIXRoaXMuZWRpdGFibGUgfHxcbiAgICAgICAgICAgICF0aGlzLnRleHRmaWVsZC5jdmE/LmludGVyYWN0aXZlKCkgfHxcbiAgICAgICAgICAgICF0dWlJc1N0cmluZyh0aGlzLmludGVybmFsKCkpXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lZGl0aW5nLnNldCh0cnVlKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmlucHV0Py5uYXRpdmVFbGVtZW50LmZvY3VzKCkpO1xuICAgIH1cbn1cbiIsIjxpbnB1dFxuICAgIGFwcGVhcmFuY2U9XCJcIlxuICAgIGVudGVya2V5aGludD1cImVudGVyXCJcbiAgICB0dWlDaGlwXG4gICAgY2xhc3M9XCJ0LWlucHV0XCJcbiAgICBbZGlzYWJsZWRdPVwiIWVkaXRpbmcoKVwiXG4gICAgW25nTW9kZWxdPVwiaW50ZXJuYWwoKVwiXG4gICAgW25nTW9kZWxPcHRpb25zXT1cIntzdGFuZGFsb25lOiB0cnVlfVwiXG4gICAgKGJsdXIpPVwiY2FuY2VsKClcIlxuICAgIChrZXlkb3duLmVudGVyKT1cInNhdmUoKVwiXG4gICAgKGtleWRvd24uZXNjKT1cImNhbmNlbCgpXCJcbiAgICAoa2V5ZG93bi5zdG9wKT1cIigwKVwiXG4gICAgKG5nTW9kZWxDaGFuZ2UpPVwiaW50ZXJuYWwuc2V0KCRldmVudClcIlxuLz5cbjxkaXZcbiAgICB0dWlGYWRlXG4gICAgdHVpRmFkZU9mZnNldD1cIjAuNXJlbVwiXG4gICAgY2xhc3M9XCJ0LXRleHRcIlxuICAgIFt0dWlIaW50T3ZlcmZsb3ddPVwiaGludD8uY29udGVudCgpID8gbnVsbCA6IGhhbmRsZXJzLnN0cmluZ2lmeSgpKGludGVybmFsKCkpXCJcbiAgICAobW91c2Vkb3duLnByZXZlbnQuem9uZWxlc3MpPVwiKDApXCJcbj5cbiAgICB7eyBoYW5kbGVycy5zdHJpbmdpZnkoKShpbnRlcm5hbCgpKSB9fVxuPC9kaXY+XG48YnV0dG9uXG4gICAgKm5nSWY9XCJ0ZXh0ZmllbGQuY3ZhPy5pbnRlcmFjdGl2ZSgpICYmICFlZGl0aW5nKCkgJiYgIWRpc2FibGVkKClcIlxuICAgIHRhYkluZGV4PVwiLTFcIlxuICAgIHR1aUljb25CdXR0b25cbiAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICBbaWNvblN0YXJ0XT1cImljb25zLmNsb3NlXCJcbiAgICAoY2xpY2suc3RvcCk9XCJkZWxldGUoKVwiXG4gICAgKHBvaW50ZXJkb3duLnByZXZlbnQuc3RvcC56b25lbGVzcyk9XCIoMClcIlxuPlxuICAgIFJlbW92ZVxuPC9idXR0b24+XG4iXX0=