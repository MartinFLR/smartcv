import { Directive, inject, Injectable } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { TuiPopoverDirective } from '@taiga-ui/cdk/directives/popover';
import { tuiAsPopover, TuiPopoverService } from '@taiga-ui/cdk/services';
import { TUI_IS_MOBILE } from '@taiga-ui/cdk/tokens';
import { tuiCreateToken, tuiCreateTokenFromFactory, } from '@taiga-ui/cdk/utils/miscellaneous';
import { TUI_ALERTS } from '@taiga-ui/core/components/alert';
import { BehaviorSubject, pairwise } from 'rxjs';
import { TuiToastComponent } from './toast.component';
import { TUI_TOAST_OPTIONS } from './toast.options';
import * as i0 from "@angular/core";
const TOASTS = tuiCreateToken(new BehaviorSubject([]));
export const TUI_TOASTS_CONCURRENCY = tuiCreateTokenFromFactory(() => inject(TUI_IS_MOBILE) ? 1 : 2);
class TuiToastService extends TuiPopoverService {
    constructor() {
        super(...arguments);
        this.concurrency = inject(TUI_TOASTS_CONCURRENCY);
        this.alerts = inject(TUI_ALERTS);
        this.sub = this.items$
            .pipe(pairwise(), takeUntilDestroyed())
            .subscribe(([prev, next]) => {
            const closed = prev.filter((item) => !next.includes(item));
            const alerts = this.alerts.value.filter((item) => !closed.includes(item));
            const toasts = new Set([...alerts, ...next.slice(0, this.concurrency)]);
            this.alerts.next(Array.from(toasts));
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiToastService, deps: null, target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiToastService, providedIn: 'root', useFactory: () => new TuiToastService(TOASTS, TuiToastComponent, inject(TUI_TOAST_OPTIONS)) }); }
}
export { TuiToastService };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiToastService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                    useFactory: () => new TuiToastService(TOASTS, TuiToastComponent, inject(TUI_TOAST_OPTIONS)),
                }]
        }] });
class TuiToastTemplate extends TuiPopoverDirective {
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiToastTemplate, deps: null, target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.2.12", type: TuiToastTemplate, isStandalone: true, selector: "ng-template[tuiToast]", inputs: { options: ["tuiToastOptions", "options"], open: ["tuiToast", "open"] }, outputs: { openChange: "tuiToastChange" }, providers: [tuiAsPopover(TuiToastService)], usesInheritance: true, ngImport: i0 }); }
}
export { TuiToastTemplate };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiToastTemplate, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    selector: 'ng-template[tuiToast]',
                    inputs: ['options: tuiToastOptions', 'open: tuiToast'],
                    outputs: ['openChange: tuiToastChange'],
                    providers: [tuiAsPopover(TuiToastService)],
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3Quc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2tpdC9jb21wb25lbnRzL3RvYXN0L3RvYXN0LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzVELE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQzlELE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQ3JFLE9BQU8sRUFBQyxZQUFZLEVBQW1CLGlCQUFpQixFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDeEYsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFDSCxjQUFjLEVBQ2QseUJBQXlCLEdBQzVCLE1BQU0sbUNBQW1DLENBQUM7QUFDM0MsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGlDQUFpQyxDQUFDO0FBQzNELE9BQU8sRUFBQyxlQUFlLEVBQUUsUUFBUSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRS9DLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBQyxpQkFBaUIsRUFBdUIsTUFBTSxpQkFBaUIsQ0FBQzs7QUFFeEUsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUN6QixJQUFJLGVBQWUsQ0FBMkQsRUFBRSxDQUFDLENBQ3BGLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxzQkFBc0IsR0FBRyx5QkFBeUIsQ0FBUyxHQUFHLEVBQUUsQ0FDekUsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDaEMsQ0FBQztBQUVGLE1BS2EsZUFBZ0IsU0FBUSxpQkFBdUM7SUFMNUU7O1FBTXFCLGdCQUFXLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDN0MsV0FBTSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUxQixRQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU07YUFDL0IsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLGtCQUFrQixFQUFFLENBQUM7YUFDdEMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN4QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUMzRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzFFLE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXhFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztLQUNWOytHQWJZLGVBQWU7bUhBQWYsZUFBZSxjQUpaLE1BQU0sY0FDTixHQUFHLEVBQUUsQ0FDYixJQUFJLGVBQWUsQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7O1NBRXBFLGVBQWU7NEZBQWYsZUFBZTtrQkFMM0IsVUFBVTttQkFBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtvQkFDbEIsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUNiLG9CQUFvQixNQUFNLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7aUJBQ2hGOztBQWdCRCxNQU9hLGdCQUFvQixTQUFRLG1CQUF1QzsrR0FBbkUsZ0JBQWdCO21HQUFoQixnQkFBZ0IsZ01BRmQsQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLENBQUM7O1NBRWpDLGdCQUFnQjs0RkFBaEIsZ0JBQWdCO2tCQVA1QixTQUFTO21CQUFDO29CQUNQLFVBQVUsRUFBRSxJQUFJO29CQUNoQixRQUFRLEVBQUUsdUJBQXVCO29CQUNqQyxNQUFNLEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxnQkFBZ0IsQ0FBQztvQkFDdEQsT0FBTyxFQUFFLENBQUMsNEJBQTRCLENBQUM7b0JBQ3ZDLFNBQVMsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQztpQkFDN0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RpcmVjdGl2ZSwgaW5qZWN0LCBJbmplY3RhYmxlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7dGFrZVVudGlsRGVzdHJveWVkfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5pbXBvcnQge1R1aVBvcG92ZXJEaXJlY3RpdmV9IGZyb20gJ0B0YWlnYS11aS9jZGsvZGlyZWN0aXZlcy9wb3BvdmVyJztcbmltcG9ydCB7dHVpQXNQb3BvdmVyLCB0eXBlIFR1aVBvcG92ZXIsIFR1aVBvcG92ZXJTZXJ2aWNlfSBmcm9tICdAdGFpZ2EtdWkvY2RrL3NlcnZpY2VzJztcbmltcG9ydCB7VFVJX0lTX01PQklMRX0gZnJvbSAnQHRhaWdhLXVpL2Nkay90b2tlbnMnO1xuaW1wb3J0IHtcbiAgICB0dWlDcmVhdGVUb2tlbixcbiAgICB0dWlDcmVhdGVUb2tlbkZyb21GYWN0b3J5LFxufSBmcm9tICdAdGFpZ2EtdWkvY2RrL3V0aWxzL21pc2NlbGxhbmVvdXMnO1xuaW1wb3J0IHtUVUlfQUxFUlRTfSBmcm9tICdAdGFpZ2EtdWkvY29yZS9jb21wb25lbnRzL2FsZXJ0JztcbmltcG9ydCB7QmVoYXZpb3JTdWJqZWN0LCBwYWlyd2lzZX0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7VHVpVG9hc3RDb21wb25lbnR9IGZyb20gJy4vdG9hc3QuY29tcG9uZW50JztcbmltcG9ydCB7VFVJX1RPQVNUX09QVElPTlMsIHR5cGUgVHVpVG9hc3RPcHRpb25zfSBmcm9tICcuL3RvYXN0Lm9wdGlvbnMnO1xuXG5jb25zdCBUT0FTVFMgPSB0dWlDcmVhdGVUb2tlbihcbiAgICBuZXcgQmVoYXZpb3JTdWJqZWN0PFJlYWRvbmx5QXJyYXk8VHVpUG9wb3ZlcjxUdWlUb2FzdE9wdGlvbnM8dW5rbm93bj4sIGFueT4+PihbXSksXG4pO1xuXG5leHBvcnQgY29uc3QgVFVJX1RPQVNUU19DT05DVVJSRU5DWSA9IHR1aUNyZWF0ZVRva2VuRnJvbUZhY3Rvcnk8bnVtYmVyPigoKSA9PlxuICAgIGluamVjdChUVUlfSVNfTU9CSUxFKSA/IDEgOiAyLFxuKTtcblxuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290JyxcbiAgICB1c2VGYWN0b3J5OiAoKSA9PlxuICAgICAgICBuZXcgVHVpVG9hc3RTZXJ2aWNlKFRPQVNUUywgVHVpVG9hc3RDb21wb25lbnQsIGluamVjdChUVUlfVE9BU1RfT1BUSU9OUykpLFxufSlcbmV4cG9ydCBjbGFzcyBUdWlUb2FzdFNlcnZpY2UgZXh0ZW5kcyBUdWlQb3BvdmVyU2VydmljZTxUdWlUb2FzdE9wdGlvbnM8YW55Pj4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgY29uY3VycmVuY3kgPSBpbmplY3QoVFVJX1RPQVNUU19DT05DVVJSRU5DWSk7XG4gICAgcHJpdmF0ZSByZWFkb25seSBhbGVydHMgPSBpbmplY3QoVFVJX0FMRVJUUyk7XG5cbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgc3ViID0gdGhpcy5pdGVtcyRcbiAgICAgICAgLnBpcGUocGFpcndpc2UoKSwgdGFrZVVudGlsRGVzdHJveWVkKCkpXG4gICAgICAgIC5zdWJzY3JpYmUoKFtwcmV2LCBuZXh0XSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xvc2VkID0gcHJldi5maWx0ZXIoKGl0ZW0pID0+ICFuZXh0LmluY2x1ZGVzKGl0ZW0pKTtcbiAgICAgICAgICAgIGNvbnN0IGFsZXJ0cyA9IHRoaXMuYWxlcnRzLnZhbHVlLmZpbHRlcigoaXRlbSkgPT4gIWNsb3NlZC5pbmNsdWRlcyhpdGVtKSk7XG4gICAgICAgICAgICBjb25zdCB0b2FzdHMgPSBuZXcgU2V0KFsuLi5hbGVydHMsIC4uLm5leHQuc2xpY2UoMCwgdGhpcy5jb25jdXJyZW5jeSldKTtcblxuICAgICAgICAgICAgdGhpcy5hbGVydHMubmV4dChBcnJheS5mcm9tKHRvYXN0cykpO1xuICAgICAgICB9KTtcbn1cblxuQERpcmVjdGl2ZSh7XG4gICAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgICBzZWxlY3RvcjogJ25nLXRlbXBsYXRlW3R1aVRvYXN0XScsXG4gICAgaW5wdXRzOiBbJ29wdGlvbnM6IHR1aVRvYXN0T3B0aW9ucycsICdvcGVuOiB0dWlUb2FzdCddLFxuICAgIG91dHB1dHM6IFsnb3BlbkNoYW5nZTogdHVpVG9hc3RDaGFuZ2UnXSxcbiAgICBwcm92aWRlcnM6IFt0dWlBc1BvcG92ZXIoVHVpVG9hc3RTZXJ2aWNlKV0sXG59KVxuZXhwb3J0IGNsYXNzIFR1aVRvYXN0VGVtcGxhdGU8VD4gZXh0ZW5kcyBUdWlQb3BvdmVyRGlyZWN0aXZlPFR1aVRvYXN0T3B0aW9uczxUPj4ge31cbiJdfQ==