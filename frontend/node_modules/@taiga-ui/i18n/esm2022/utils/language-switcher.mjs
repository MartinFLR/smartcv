import { inject, Injectable } from '@angular/core';
import { WA_LOCAL_STORAGE } from '@ng-web-apis/common';
import { TUI_DEFAULT_LANGUAGE, TUI_LANGUAGE, TUI_LANGUAGE_LOADER, TUI_LANGUAGE_STORAGE_KEY, } from '@taiga-ui/i18n/tokens';
import { BehaviorSubject, of, switchAll } from 'rxjs';
import { tuiAsyncLoadLanguage } from './load-language';
import * as i0 from "@angular/core";
export function tuiLanguageSwitcher(loader) {
    return [
        {
            provide: TUI_LANGUAGE_LOADER,
            useFactory: () => loader,
        },
        {
            provide: TUI_LANGUAGE,
            useFactory: () => inject(TuiLanguageSwitcherService).pipe(switchAll()),
        },
    ];
}
class TuiLanguageSwitcherService extends BehaviorSubject {
    constructor() {
        super(tuiAsyncLoadLanguage(inject(WA_LOCAL_STORAGE)?.getItem(inject(TUI_LANGUAGE_STORAGE_KEY)), inject(TUI_LANGUAGE_LOADER, { optional: true }), inject(TUI_DEFAULT_LANGUAGE)));
        this.fallback = inject(TUI_DEFAULT_LANGUAGE);
        this.key = inject(TUI_LANGUAGE_STORAGE_KEY);
        this.storage = inject(WA_LOCAL_STORAGE);
        this.loader = inject(TUI_LANGUAGE_LOADER, { optional: true });
    }
    get language() {
        return this.storage?.getItem(this.key) || this.fallback.name;
    }
    setLanguage(language) {
        this.storage?.setItem(this.key, language);
        this.next(tuiAsyncLoadLanguage(language, this.loader, this.fallback));
    }
    clear() {
        this.storage?.removeItem(this.key);
        this.next(of(this.fallback));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiLanguageSwitcherService, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiLanguageSwitcherService, providedIn: 'root' }); }
}
export { TuiLanguageSwitcherService };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiLanguageSwitcherService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return []; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFuZ3VhZ2Utc3dpdGNoZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9pMThuL3V0aWxzL2xhbmd1YWdlLXN3aXRjaGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxNQUFNLEVBQUUsVUFBVSxFQUFnQixNQUFNLGVBQWUsQ0FBQztBQUNoRSxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLEVBQ0gsb0JBQW9CLEVBQ3BCLFlBQVksRUFDWixtQkFBbUIsRUFDbkIsd0JBQXdCLEdBQzNCLE1BQU0sdUJBQXVCLENBQUM7QUFNL0IsT0FBTyxFQUFDLGVBQWUsRUFBbUIsRUFBRSxFQUFFLFNBQVMsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUVyRSxPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQzs7QUFFckQsTUFBTSxVQUFVLG1CQUFtQixDQUFDLE1BQXlCO0lBQ3pELE9BQU87UUFDSDtZQUNJLE9BQU8sRUFBRSxtQkFBbUI7WUFDNUIsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLE1BQU07U0FDM0I7UUFDRDtZQUNJLE9BQU8sRUFBRSxZQUFZO1lBQ3JCLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7U0FDekU7S0FDSixDQUFDO0FBQ04sQ0FBQztBQUVELE1BR2EsMEJBQTJCLFNBQVEsZUFBd0M7SUFNcEY7UUFDSSxLQUFLLENBQ0Qsb0JBQW9CLENBQ2hCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxFQUNuRSxNQUFNLENBQUMsbUJBQW1CLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUMsRUFDN0MsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQy9CLENBQ0osQ0FBQztRQVpXLGFBQVEsR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUN4QyxRQUFHLEdBQUcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDdkMsWUFBTyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ25DLFdBQU0sR0FBRyxNQUFNLENBQUMsbUJBQW1CLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQVV4RSxDQUFDO0lBRUQsSUFBVyxRQUFRO1FBQ2YsT0FBTyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7SUFDakUsQ0FBQztJQUVNLFdBQVcsQ0FBQyxRQUF5QjtRQUN4QyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzFDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDMUUsQ0FBQztJQUVTLEtBQUs7UUFDWCxJQUFJLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDakMsQ0FBQzsrR0E1QlEsMEJBQTBCO21IQUExQiwwQkFBMEIsY0FGdkIsTUFBTTs7U0FFVCwwQkFBMEI7NEZBQTFCLDBCQUEwQjtrQkFIdEMsVUFBVTttQkFBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2luamVjdCwgSW5qZWN0YWJsZSwgdHlwZSBQcm92aWRlcn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1dBX0xPQ0FMX1NUT1JBR0V9IGZyb20gJ0BuZy13ZWItYXBpcy9jb21tb24nO1xuaW1wb3J0IHtcbiAgICBUVUlfREVGQVVMVF9MQU5HVUFHRSxcbiAgICBUVUlfTEFOR1VBR0UsXG4gICAgVFVJX0xBTkdVQUdFX0xPQURFUixcbiAgICBUVUlfTEFOR1VBR0VfU1RPUkFHRV9LRVksXG59IGZyb20gJ0B0YWlnYS11aS9pMThuL3Rva2Vucyc7XG5pbXBvcnQge1xuICAgIHR5cGUgVHVpTGFuZ3VhZ2UsXG4gICAgdHlwZSBUdWlMYW5ndWFnZUxvYWRlcixcbiAgICB0eXBlIFR1aUxhbmd1YWdlTmFtZSxcbn0gZnJvbSAnQHRhaWdhLXVpL2kxOG4vdHlwZXMnO1xuaW1wb3J0IHtCZWhhdmlvclN1YmplY3QsIHR5cGUgT2JzZXJ2YWJsZSwgb2YsIHN3aXRjaEFsbH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7dHVpQXN5bmNMb2FkTGFuZ3VhZ2V9IGZyb20gJy4vbG9hZC1sYW5ndWFnZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiB0dWlMYW5ndWFnZVN3aXRjaGVyKGxvYWRlcjogVHVpTGFuZ3VhZ2VMb2FkZXIpOiBQcm92aWRlcltdIHtcbiAgICByZXR1cm4gW1xuICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlOiBUVUlfTEFOR1VBR0VfTE9BREVSLFxuICAgICAgICAgICAgdXNlRmFjdG9yeTogKCkgPT4gbG9hZGVyLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlOiBUVUlfTEFOR1VBR0UsXG4gICAgICAgICAgICB1c2VGYWN0b3J5OiAoKSA9PiBpbmplY3QoVHVpTGFuZ3VhZ2VTd2l0Y2hlclNlcnZpY2UpLnBpcGUoc3dpdGNoQWxsKCkpLFxuICAgICAgICB9LFxuICAgIF07XG59XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIFR1aUxhbmd1YWdlU3dpdGNoZXJTZXJ2aWNlIGV4dGVuZHMgQmVoYXZpb3JTdWJqZWN0PE9ic2VydmFibGU8VHVpTGFuZ3VhZ2U+PiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBmYWxsYmFjayA9IGluamVjdChUVUlfREVGQVVMVF9MQU5HVUFHRSk7XG4gICAgcHJpdmF0ZSByZWFkb25seSBrZXkgPSBpbmplY3QoVFVJX0xBTkdVQUdFX1NUT1JBR0VfS0VZKTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHN0b3JhZ2UgPSBpbmplY3QoV0FfTE9DQUxfU1RPUkFHRSk7XG4gICAgcHJpdmF0ZSByZWFkb25seSBsb2FkZXIgPSBpbmplY3QoVFVJX0xBTkdVQUdFX0xPQURFUiwge29wdGlvbmFsOiB0cnVlfSk7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoXG4gICAgICAgICAgICB0dWlBc3luY0xvYWRMYW5ndWFnZShcbiAgICAgICAgICAgICAgICBpbmplY3QoV0FfTE9DQUxfU1RPUkFHRSk/LmdldEl0ZW0oaW5qZWN0KFRVSV9MQU5HVUFHRV9TVE9SQUdFX0tFWSkpLFxuICAgICAgICAgICAgICAgIGluamVjdChUVUlfTEFOR1VBR0VfTE9BREVSLCB7b3B0aW9uYWw6IHRydWV9KSxcbiAgICAgICAgICAgICAgICBpbmplY3QoVFVJX0RFRkFVTFRfTEFOR1VBR0UpLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGxhbmd1YWdlKCk6IFR1aUxhbmd1YWdlTmFtZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2U/LmdldEl0ZW0odGhpcy5rZXkpIHx8IHRoaXMuZmFsbGJhY2submFtZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0TGFuZ3VhZ2UobGFuZ3VhZ2U6IFR1aUxhbmd1YWdlTmFtZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0b3JhZ2U/LnNldEl0ZW0odGhpcy5rZXksIGxhbmd1YWdlKTtcbiAgICAgICAgdGhpcy5uZXh0KHR1aUFzeW5jTG9hZExhbmd1YWdlKGxhbmd1YWdlLCB0aGlzLmxvYWRlciwgdGhpcy5mYWxsYmFjaykpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBjbGVhcigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdG9yYWdlPy5yZW1vdmVJdGVtKHRoaXMua2V5KTtcbiAgICAgICAgdGhpcy5uZXh0KG9mKHRoaXMuZmFsbGJhY2spKTtcbiAgICB9XG59XG4iXX0=