import { __decorate } from "tslib";
import { KeyValuePipe, NgForOf, NgIf, NgTemplateOutlet, } from '@angular/common';
import { ChangeDetectionStrategy, Component, ContentChild, inject, Input, TemplateRef, } from '@angular/core';
import { toSignal } from '@angular/core/rxjs-interop';
import { TuiLet } from '@taiga-ui/cdk/directives/let';
import { TuiFilterPipe } from '@taiga-ui/cdk/pipes/filter';
import { tuiInjectElement } from '@taiga-ui/cdk/utils/dom';
import { tuiMoveFocus } from '@taiga-ui/cdk/utils/focus';
import { tuiClamp } from '@taiga-ui/cdk/utils/math';
import { tuiPure } from '@taiga-ui/cdk/utils/miscellaneous';
import { TuiIconPipe } from '@taiga-ui/core/components/icon';
import { TuiLoader } from '@taiga-ui/core/components/loader';
import { TuiScrollbar } from '@taiga-ui/core/components/scrollbar';
import { TuiTextfieldComponent } from '@taiga-ui/core/components/textfield';
import { TuiTabs } from '@taiga-ui/kit/components/tabs';
import { TuiBlockStatus } from '@taiga-ui/layout/components/block-status';
import { TUI_INPUT_SEARCH } from '@taiga-ui/layout/tokens';
import { TUI_SEARCH_RESULTS_OPTIONS } from './search-results.options';
import * as i0 from "@angular/core";
import * as i1 from "@taiga-ui/layout/components/block-status";
import * as i2 from "@taiga-ui/kit/components/tabs";
class TuiSearchResultsComponent {
    constructor() {
        this.el = tuiInjectElement();
        this.options = inject(TUI_SEARCH_RESULTS_OPTIONS);
        this.i18n = toSignal(inject(TUI_INPUT_SEARCH));
        this.textfield = inject(TuiTextfieldComponent);
        this.active = 0;
        this.results = {};
    }
    ngOnChanges() {
        this.active = 0;
    }
    isEmpty(results) {
        return !Object.values(results).reduce((total, { length }) => length + total, 0);
    }
    onArrow(current, step) {
        const elements = Array.from(this.el.querySelectorAll('[tuiCell]'));
        if (elements[0] === current && step < 0) {
            this.textfield.input?.nativeElement.focus();
        }
        else {
            tuiMoveFocus(elements.indexOf(current), elements, step);
        }
    }
    tab(step) {
        const max = Object.values(this.results || {}).filter((v) => v.length).length;
        this.active = tuiClamp(this.active + step, 0, max);
        this.textfield.input?.nativeElement.focus();
    }
    notEmpty({ value }) {
        return !!value.length;
    }
    asIs() {
        return 0;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiSearchResultsComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: TuiSearchResultsComponent, isStandalone: true, selector: "tui-search-results", inputs: { results: "results" }, host: { listeners: { "keydown.arrowDown.prevent": "onArrow($event.target, 1)", "keydown.arrowUp.prevent": "onArrow($event.target, -1)" } }, queries: [{ propertyName: "template", first: true, predicate: TemplateRef, descendants: true }], usesOnChanges: true, ngImport: i0, template: "<ng-content *ngIf=\"!textfield.value(); else a\" />\n<ng-template #a>\n    <tui-loader\n        *ngIf=\"!results; else b\"\n        class=\"t-loader\"\n    />\n    <ng-template #b>\n        <tui-block-status\n            *ngIf=\"results && isEmpty(results); else c\"\n            size=\"m\"\n            class=\"t-status\"\n        >\n            <img\n                alt=\"\"\n                tuiSlot=\"top\"\n                class=\"t-empty\"\n                [src]=\"options.empty | tuiIcon\"\n            />\n            {{ i18n()?.empty }}\n        </tui-block-status>\n        <ng-template #c>\n            <ng-container *tuiLet=\"(results | keyvalue: asIs) || [] as items\">\n                <tui-scrollbar class=\"t-scrollbar\">\n                    <ng-container *ngFor=\"let group of items | tuiFilter: notEmpty; let index = index\">\n                        <ng-container *ngIf=\"!active || active === index + 1\">\n                            <label\n                                *ngIf=\"!active && items.length > 1\"\n                                class=\"t-sr-label\"\n                            >\n                                {{ group.key }}\n                            </label>\n                            <ng-container\n                                *ngFor=\"let item of group.value\"\n                                [ngTemplateOutlet]=\"template || null\"\n                                [ngTemplateOutletContext]=\"{$implicit: item}\"\n                            />\n                        </ng-container>\n                    </ng-container>\n                </tui-scrollbar>\n                <tui-tabs\n                    *ngIf=\"items.length > 1\"\n                    size=\"m\"\n                    class=\"t-tabs\"\n                    [(activeItemIndex)]=\"active\"\n                    (document:keydown.shift.tab.prevent)=\"tab(-1)\"\n                    (document:keydown.tab.prevent)=\"tab(1)\"\n                >\n                    <button tuiTab>{{ i18n()?.all }}</button>\n                    <ng-container *ngFor=\"let group of items\">\n                        <button\n                            *ngIf=\"group.value.length\"\n                            tuiTab\n                        >\n                            {{ group.key }}\n                        </button>\n                    </ng-container>\n                </tui-tabs>\n            </ng-container>\n        </ng-template>\n    </ng-template>\n</ng-template>\n", styles: [":host{display:flex;flex-direction:column;border-radius:var(--tui-radius-l);background:var(--tui-background-base);box-shadow:inset 0 0 0 1px var(--tui-border-normal)}:host ::ng-deep [tuiCell]{inline-size:-webkit-fill-available;inline-size:-moz-available;inline-size:stretch;padding:.375rem;margin:.25rem .625rem;border-radius:var(--tui-radius-l)}:host ::ng-deep [tuiCell]>tui-avatar{border-radius:var(--tui-radius-m)}:host ::ng-deep .t-sr-label{display:block;font:var(--tui-font-text-ui-s);color:var(--tui-text-secondary);margin:.75rem 1rem .5rem}.t-loader{margin:1rem 0}.t-status{margin-block-end:2rem}.t-empty{margin-block-start:1.5rem;filter:invert(1)}.t-tabs{order:-1;margin:0 1rem;box-shadow:none;border-image:linear-gradient(0deg,var(--tui-border-normal) 1px,transparent 0) fill 0/0/0 1rem}.t-tabs:before{background:var(--tui-background-accent-opposite-pressed)}.t-scrollbar{max-block-size:30rem;padding:.375rem 0}\n"], dependencies: [{ kind: "pipe", type: KeyValuePipe, name: "keyvalue" }, { kind: "directive", type: NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: i1.TuiBlockStatusComponent, selector: "tui-block-status", inputs: ["card", "size"] }, { kind: "directive", type: i1.TuiBlockStatusDirective, selector: "[tuiSlot]", inputs: ["tuiSlot"] }, { kind: "pipe", type: TuiFilterPipe, name: "tuiFilter" }, { kind: "pipe", type: TuiIconPipe, name: "tuiIcon" }, { kind: "directive", type: TuiLet, selector: "[tuiLet]", inputs: ["tuiLet"] }, { kind: "component", type: TuiLoader, selector: "tui-loader", inputs: ["size", "inheritColor", "overlay", "textContent", "showLoader"] }, { kind: "component", type: TuiScrollbar, selector: "tui-scrollbar", inputs: ["hidden"] }, { kind: "directive", type: i2.TuiTab, selector: "a[tuiTab]:not([routerLink]), a[tuiTab][routerLink][routerLinkActive], button[tuiTab]" }, { kind: "directive", type: i2.TuiTabsHorizontal, selector: "tui-tabs:not([vertical]), nav[tuiTabs]:not([vertical])", inputs: ["underline"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
__decorate([
    tuiPure
], TuiSearchResultsComponent.prototype, "isEmpty", null);
export { TuiSearchResultsComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiSearchResultsComponent, decorators: [{
            type: Component,
            args: [{ standalone: true, selector: 'tui-search-results', imports: [
                        KeyValuePipe,
                        NgForOf,
                        NgIf,
                        NgTemplateOutlet,
                        TuiBlockStatus,
                        TuiFilterPipe,
                        TuiIconPipe,
                        TuiLet,
                        TuiLoader,
                        TuiScrollbar,
                        TuiTabs,
                    ], changeDetection: ChangeDetectionStrategy.OnPush, host: {
                        '(keydown.arrowDown.prevent)': 'onArrow($event.target, 1)',
                        '(keydown.arrowUp.prevent)': 'onArrow($event.target, -1)',
                    }, template: "<ng-content *ngIf=\"!textfield.value(); else a\" />\n<ng-template #a>\n    <tui-loader\n        *ngIf=\"!results; else b\"\n        class=\"t-loader\"\n    />\n    <ng-template #b>\n        <tui-block-status\n            *ngIf=\"results && isEmpty(results); else c\"\n            size=\"m\"\n            class=\"t-status\"\n        >\n            <img\n                alt=\"\"\n                tuiSlot=\"top\"\n                class=\"t-empty\"\n                [src]=\"options.empty | tuiIcon\"\n            />\n            {{ i18n()?.empty }}\n        </tui-block-status>\n        <ng-template #c>\n            <ng-container *tuiLet=\"(results | keyvalue: asIs) || [] as items\">\n                <tui-scrollbar class=\"t-scrollbar\">\n                    <ng-container *ngFor=\"let group of items | tuiFilter: notEmpty; let index = index\">\n                        <ng-container *ngIf=\"!active || active === index + 1\">\n                            <label\n                                *ngIf=\"!active && items.length > 1\"\n                                class=\"t-sr-label\"\n                            >\n                                {{ group.key }}\n                            </label>\n                            <ng-container\n                                *ngFor=\"let item of group.value\"\n                                [ngTemplateOutlet]=\"template || null\"\n                                [ngTemplateOutletContext]=\"{$implicit: item}\"\n                            />\n                        </ng-container>\n                    </ng-container>\n                </tui-scrollbar>\n                <tui-tabs\n                    *ngIf=\"items.length > 1\"\n                    size=\"m\"\n                    class=\"t-tabs\"\n                    [(activeItemIndex)]=\"active\"\n                    (document:keydown.shift.tab.prevent)=\"tab(-1)\"\n                    (document:keydown.tab.prevent)=\"tab(1)\"\n                >\n                    <button tuiTab>{{ i18n()?.all }}</button>\n                    <ng-container *ngFor=\"let group of items\">\n                        <button\n                            *ngIf=\"group.value.length\"\n                            tuiTab\n                        >\n                            {{ group.key }}\n                        </button>\n                    </ng-container>\n                </tui-tabs>\n            </ng-container>\n        </ng-template>\n    </ng-template>\n</ng-template>\n", styles: [":host{display:flex;flex-direction:column;border-radius:var(--tui-radius-l);background:var(--tui-background-base);box-shadow:inset 0 0 0 1px var(--tui-border-normal)}:host ::ng-deep [tuiCell]{inline-size:-webkit-fill-available;inline-size:-moz-available;inline-size:stretch;padding:.375rem;margin:.25rem .625rem;border-radius:var(--tui-radius-l)}:host ::ng-deep [tuiCell]>tui-avatar{border-radius:var(--tui-radius-m)}:host ::ng-deep .t-sr-label{display:block;font:var(--tui-font-text-ui-s);color:var(--tui-text-secondary);margin:.75rem 1rem .5rem}.t-loader{margin:1rem 0}.t-status{margin-block-end:2rem}.t-empty{margin-block-start:1.5rem;filter:invert(1)}.t-tabs{order:-1;margin:0 1rem;box-shadow:none;border-image:linear-gradient(0deg,var(--tui-border-normal) 1px,transparent 0) fill 0/0/0 1rem}.t-tabs:before{background:var(--tui-background-accent-opposite-pressed)}.t-scrollbar{max-block-size:30rem;padding:.375rem 0}\n"] }]
        }], propDecorators: { template: [{
                type: ContentChild,
                args: [TemplateRef]
            }], results: [{
                type: Input
            }], isEmpty: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLXJlc3VsdHMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZXhwZXJpbWVudGFsL2NvbXBvbmVudHMvc2VhcmNoLXJlc3VsdHMvc2VhcmNoLXJlc3VsdHMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZXhwZXJpbWVudGFsL2NvbXBvbmVudHMvc2VhcmNoLXJlc3VsdHMvc2VhcmNoLXJlc3VsdHMuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFFSCxZQUFZLEVBQ1osT0FBTyxFQUNQLElBQUksRUFDSixnQkFBZ0IsR0FDbkIsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQ0gsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFFTCxXQUFXLEdBQ2QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQ3BELE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSw4QkFBOEIsQ0FBQztBQUNwRCxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sNEJBQTRCLENBQUM7QUFFekQsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDekQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBQ3ZELE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUNsRCxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sbUNBQW1DLENBQUM7QUFDMUQsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLGdDQUFnQyxDQUFDO0FBQzNELE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUMzRCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0scUNBQXFDLENBQUM7QUFDakUsT0FB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QUNKLGdCQUFnQjt3QkFDaEIsY0FBYzt3QkFDZCxhQUFhO3dCQUNiLFdBQVc7d0JBQ1gsTUFBTTt3QkFDTixTQUFTO3dCQUNULFlBQVk7d0JBQ1osT0FBTztxQkFDVixtQkFHZ0IsdUJBQXVCLENBQUMsTUFBTSxRQUN6Qzt3QkFDRiw2QkFBNkIsRUFBRSwyQkFBMkI7d0JBQzFELDJCQUEyQixFQUFFLDRCQUE0QjtxQkFDNUQ7OEJBV2UsUUFBUTtzQkFEdkIsWUFBWTt1QkFBQyxXQUFXO2dCQUlsQixPQUFPO3NCQURiLEtBQUs7Z0JBUUksT0FBTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgdHlwZSBLZXlWYWx1ZSxcbiAgICBLZXlWYWx1ZVBpcGUsXG4gICAgTmdGb3JPZixcbiAgICBOZ0lmLFxuICAgIE5nVGVtcGxhdGVPdXRsZXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENvbXBvbmVudCxcbiAgICBDb250ZW50Q2hpbGQsXG4gICAgaW5qZWN0LFxuICAgIElucHV0LFxuICAgIHR5cGUgT25DaGFuZ2VzLFxuICAgIFRlbXBsYXRlUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7dG9TaWduYWx9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvcnhqcy1pbnRlcm9wJztcbmltcG9ydCB7VHVpTGV0fSBmcm9tICdAdGFpZ2EtdWkvY2RrL2RpcmVjdGl2ZXMvbGV0JztcbmltcG9ydCB7VHVpRmlsdGVyUGlwZX0gZnJvbSAnQHRhaWdhLXVpL2Nkay9waXBlcy9maWx0ZXInO1xuaW1wb3J0IHt0eXBlIFR1aUNvbnRleHR9IGZyb20gJ0B0YWlnYS11aS9jZGsvdHlwZXMnO1xuaW1wb3J0IHt0dWlJbmplY3RFbGVtZW50fSBmcm9tICdAdGFpZ2EtdWkvY2RrL3V0aWxzL2RvbSc7XG5pbXBvcnQge3R1aU1vdmVGb2N1c30gZnJvbSAnQHRhaWdhLXVpL2Nkay91dGlscy9mb2N1cyc7XG5pbXBvcnQge3R1aUNsYW1wfSBmcm9tICdAdGFpZ2EtdWkvY2RrL3V0aWxzL21hdGgnO1xuaW1wb3J0IHt0dWlQdXJlfSBmcm9tICdAdGFpZ2EtdWkvY2RrL3V0aWxzL21pc2NlbGxhbmVvdXMnO1xuaW1wb3J0IHtUdWlJY29uUGlwZX0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvY29tcG9uZW50cy9pY29uJztcbmltcG9ydCB7VHVpTG9hZGVyfSBmcm9tICdAdGFpZ2EtdWkvY29yZS9jb21wb25lbnRzL2xvYWRlcic7XG5pbXBvcnQge1R1aVNjcm9sbGJhcn0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvY29tcG9uZW50cy9zY3JvbGxiYXInO1xuaW1wb3J0IHtUdWlUZXh0ZmllbGRDb21wb25lbnR9IGZyb20gJ0B0YWlnYS11aS9jb3JlL2NvbXBvbmVudHMvdGV4dGZpZWxkJztcbmltcG9ydCB7VHVpVGFic30gZnJvbSAnQHRhaWdhLXVpL2tpdC9jb21wb25lbnRzL3RhYnMnO1xuaW1wb3J0IHtUdWlCbG9ja1N0YXR1c30gZnJvbSAnQHRhaWdhLXVpL2xheW91dC9jb21wb25lbnRzL2Jsb2NrLXN0YXR1cyc7XG5pbXBvcnQge1RVSV9JTlBVVF9TRUFSQ0h9IGZyb20gJ0B0YWlnYS11aS9sYXlvdXQvdG9rZW5zJztcblxuaW1wb3J0IHtUVUlfU0VBUkNIX1JFU1VMVFNfT1BUSU9OU30gZnJvbSAnLi9zZWFyY2gtcmVzdWx0cy5vcHRpb25zJztcblxuQENvbXBvbmVudCh7XG4gICAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgICBzZWxlY3RvcjogJ3R1aS1zZWFyY2gtcmVzdWx0cycsXG4gICAgaW1wb3J0czogW1xuICAgICAgICBLZXlWYWx1ZVBpcGUsXG4gICAgICAgIE5nRm9yT2YsXG4gICAgICAgIE5nSWYsXG4gICAgICAgIE5nVGVtcGxhdGVPdXRsZXQsXG4gICAgICAgIFR1aUJsb2NrU3RhdHVzLFxuICAgICAgICBUdWlGaWx0ZXJQaXBlLFxuICAgICAgICBUdWlJY29uUGlwZSxcbiAgICAgICAgVHVpTGV0LFxuICAgICAgICBUdWlMb2FkZXIsXG4gICAgICAgIFR1aVNjcm9sbGJhcixcbiAgICAgICAgVHVpVGFicyxcbiAgICBdLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9zZWFyY2gtcmVzdWx0cy5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vc2VhcmNoLXJlc3VsdHMuY29tcG9uZW50Lmxlc3MnXSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgICBob3N0OiB7XG4gICAgICAgICcoa2V5ZG93bi5hcnJvd0Rvd24ucHJldmVudCknOiAnb25BcnJvdygkZXZlbnQudGFyZ2V0LCAxKScsXG4gICAgICAgICcoa2V5ZG93bi5hcnJvd1VwLnByZXZlbnQpJzogJ29uQXJyb3coJGV2ZW50LnRhcmdldCwgLTEpJyxcbiAgICB9LFxufSlcbmV4cG9ydCBjbGFzcyBUdWlTZWFyY2hSZXN1bHRzQ29tcG9uZW50PFQ+IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGVsID0gdHVpSW5qZWN0RWxlbWVudCgpO1xuXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IG9wdGlvbnMgPSBpbmplY3QoVFVJX1NFQVJDSF9SRVNVTFRTX09QVElPTlMpO1xuICAgIHByb3RlY3RlZCByZWFkb25seSBpMThuID0gdG9TaWduYWwoaW5qZWN0KFRVSV9JTlBVVF9TRUFSQ0gpKTtcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgdGV4dGZpZWxkID0gaW5qZWN0KFR1aVRleHRmaWVsZENvbXBvbmVudCk7XG4gICAgcHJvdGVjdGVkIGFjdGl2ZSA9IDA7XG5cbiAgICBAQ29udGVudENoaWxkKFRlbXBsYXRlUmVmKVxuICAgIHB1YmxpYyByZWFkb25seSB0ZW1wbGF0ZT86IFRlbXBsYXRlUmVmPFR1aUNvbnRleHQ8VD4+O1xuXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgcmVzdWx0czogUmVjb3JkPHN0cmluZywgcmVhZG9ubHkgVFtdPiB8IG51bGwgPSB7fTtcblxuICAgIHB1YmxpYyBuZ09uQ2hhbmdlcygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hY3RpdmUgPSAwO1xuICAgIH1cblxuICAgIEB0dWlQdXJlXG4gICAgcHJvdGVjdGVkIGlzRW1wdHkocmVzdWx0czogUmVjb3JkPHN0cmluZywgcmVhZG9ubHkgVFtdPik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIU9iamVjdC52YWx1ZXMocmVzdWx0cykucmVkdWNlKCh0b3RhbCwge2xlbmd0aH0pID0+IGxlbmd0aCArIHRvdGFsLCAwKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgb25BcnJvdyhjdXJyZW50OiBIVE1MRWxlbWVudCwgc3RlcDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzID0gQXJyYXkuZnJvbSh0aGlzLmVsLnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTEVsZW1lbnQ+KCdbdHVpQ2VsbF0nKSk7XG5cbiAgICAgICAgaWYgKGVsZW1lbnRzWzBdID09PSBjdXJyZW50ICYmIHN0ZXAgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLnRleHRmaWVsZC5pbnB1dD8ubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHVpTW92ZUZvY3VzKGVsZW1lbnRzLmluZGV4T2YoY3VycmVudCksIGVsZW1lbnRzLCBzdGVwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCB0YWIoc3RlcDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1heCA9IE9iamVjdC52YWx1ZXModGhpcy5yZXN1bHRzIHx8IHt9KS5maWx0ZXIoKHYpID0+IHYubGVuZ3RoKS5sZW5ndGg7XG5cbiAgICAgICAgdGhpcy5hY3RpdmUgPSB0dWlDbGFtcCh0aGlzLmFjdGl2ZSArIHN0ZXAsIDAsIG1heCk7XG4gICAgICAgIHRoaXMudGV4dGZpZWxkLmlucHV0Py5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG5vdEVtcHR5KHt2YWx1ZX06IEtleVZhbHVlPHN0cmluZywgcmVhZG9ubHkgVFtdPik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gISF2YWx1ZS5sZW5ndGg7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzSXMoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxufVxuIiwiPG5nLWNvbnRlbnQgKm5nSWY9XCIhdGV4dGZpZWxkLnZhbHVlKCk7IGVsc2UgYVwiIC8+XG48bmctdGVtcGxhdGUgI2E+XG4gICAgPHR1aS1sb2FkZXJcbiAgICAgICAgKm5nSWY9XCIhcmVzdWx0czsgZWxzZSBiXCJcbiAgICAgICAgY2xhc3M9XCJ0LWxvYWRlclwiXG4gICAgLz5cbiAgICA8bmctdGVtcGxhdGUgI2I+XG4gICAgICAgIDx0dWktYmxvY2stc3RhdHVzXG4gICAgICAgICAgICAqbmdJZj1cInJlc3VsdHMgJiYgaXNFbXB0eShyZXN1bHRzKTsgZWxzZSBjXCJcbiAgICAgICAgICAgIHNpemU9XCJtXCJcbiAgICAgICAgICAgIGNsYXNzPVwidC1zdGF0dXNcIlxuICAgICAgICA+XG4gICAgICAgICAgICA8aW1nXG4gICAgICAgICAgICAgICAgYWx0PVwiXCJcbiAgICAgICAgICAgICAgICB0dWlTbG90PVwidG9wXCJcbiAgICAgICAgICAgICAgICBjbGFzcz1cInQtZW1wdHlcIlxuICAgICAgICAgICAgICAgIFtzcmNdPVwib3B0aW9ucy5lbXB0eSB8IHR1aUljb25cIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIHt7IGkxOG4oKT8uZW1wdHkgfX1cbiAgICAgICAgPC90dWktYmxvY2stc3RhdHVzPlxuICAgICAgICA8bmctdGVtcGxhdGUgI2M+XG4gICAgICAgICAgICA8bmctY29udGFpbmVyICp0dWlMZXQ9XCIocmVzdWx0cyB8IGtleXZhbHVlOiBhc0lzKSB8fCBbXSBhcyBpdGVtc1wiPlxuICAgICAgICAgICAgICAgIDx0dWktc2Nyb2xsYmFyIGNsYXNzPVwidC1zY3JvbGxiYXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgZ3JvdXAgb2YgaXRlbXMgfCB0dWlGaWx0ZXI6IG5vdEVtcHR5OyBsZXQgaW5kZXggPSBpbmRleFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFhY3RpdmUgfHwgYWN0aXZlID09PSBpbmRleCArIDFcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKm5nSWY9XCIhYWN0aXZlICYmIGl0ZW1zLmxlbmd0aCA+IDFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cInQtc3ItbGFiZWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3sgZ3JvdXAua2V5IH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpuZ0Zvcj1cImxldCBpdGVtIG9mIGdyb3VwLnZhbHVlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwidGVtcGxhdGUgfHwgbnVsbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtuZ1RlbXBsYXRlT3V0bGV0Q29udGV4dF09XCJ7JGltcGxpY2l0OiBpdGVtfVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICA8L3R1aS1zY3JvbGxiYXI+XG4gICAgICAgICAgICAgICAgPHR1aS10YWJzXG4gICAgICAgICAgICAgICAgICAgICpuZ0lmPVwiaXRlbXMubGVuZ3RoID4gMVwiXG4gICAgICAgICAgICAgICAgICAgIHNpemU9XCJtXCJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJ0LXRhYnNcIlxuICAgICAgICAgICAgICAgICAgICBbKGFjdGl2ZUl0ZW1JbmRleCldPVwiYWN0aXZlXCJcbiAgICAgICAgICAgICAgICAgICAgKGRvY3VtZW50OmtleWRvd24uc2hpZnQudGFiLnByZXZlbnQpPVwidGFiKC0xKVwiXG4gICAgICAgICAgICAgICAgICAgIChkb2N1bWVudDprZXlkb3duLnRhYi5wcmV2ZW50KT1cInRhYigxKVwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR1aVRhYj57eyBpMThuKCk/LmFsbCB9fTwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBncm91cCBvZiBpdGVtc1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICpuZ0lmPVwiZ3JvdXAudmFsdWUubGVuZ3RoXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dWlUYWJcbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBncm91cC5rZXkgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgICA8L3R1aS10YWJzPlxuICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbjwvbmctdGVtcGxhdGU+XG4iXX0=