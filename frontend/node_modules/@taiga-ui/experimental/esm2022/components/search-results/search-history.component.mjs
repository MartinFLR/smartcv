import { NgForOf, NgIf } from '@angular/common';
import { ChangeDetectionStrategy, Component, inject, Input } from '@angular/core';
import { takeUntilDestroyed, toSignal } from '@angular/core/rxjs-interop';
import { NgControl } from '@angular/forms';
import { WA_LOCAL_STORAGE } from '@ng-web-apis/common';
import { TuiButton } from '@taiga-ui/core/components/button';
import { TuiTextfieldComponent } from '@taiga-ui/core/components/textfield';
import { TuiTitle } from '@taiga-ui/core/directives/title';
import { TUI_CLOSE_WORD } from '@taiga-ui/core/tokens';
import { TuiAvatar } from '@taiga-ui/kit/components/avatar';
import { TuiCell } from '@taiga-ui/layout/components/cell';
import { TUI_INPUT_SEARCH } from '@taiga-ui/layout/tokens';
import { filter, map } from 'rxjs';
import { TUI_SEARCH_RESULTS_OPTIONS } from './search-results.options';
import * as i0 from "@angular/core";
class TuiSearchHistory {
    constructor() {
        this.textfield = inject(TuiTextfieldComponent);
        this.storage = inject(WA_LOCAL_STORAGE);
        this.control = inject(NgControl);
        this.close = toSignal(inject(TUI_CLOSE_WORD));
        this.i18n = toSignal(inject(TUI_INPUT_SEARCH));
        this.options = inject(TUI_SEARCH_RESULTS_OPTIONS);
        this.$ = this.control.valueChanges
            ?.pipe(map(String), filter((item) => !!item && !this.popular.includes(item)), takeUntilDestroyed())
            .subscribe((value) => {
            this.store(value);
        });
        this.history = this.items;
        this.popular = [];
    }
    store(item) {
        this.storage?.setItem(this.options.key, JSON.stringify(Array.from(new Set([item.trim(), ...this.items]))
            .filter((v, _, a) => v && !a.find((s) => s.startsWith(v) && s !== v))
            .slice(0, 5)));
    }
    remove(item) {
        this.textfield.input?.nativeElement.focus();
        this.history = this.history.filter((v) => v !== item);
        this.storage?.setItem(this.options.key, JSON.stringify(this.items.filter((v) => v !== item)));
    }
    select(item) {
        this.control.control?.setValue(item);
        this.textfield.input?.nativeElement.focus();
    }
    get items() {
        return JSON.parse(this.storage?.getItem(this.options.key) || '[]');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiSearchHistory, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: TuiSearchHistory, isStandalone: true, selector: "tui-search-history", inputs: { popular: "popular" }, ngImport: i0, template: "<label\n    *ngIf=\"history.length\"\n    class=\"t-sr-label\"\n>\n    {{ i18n()?.history }}\n</label>\n<button\n    *ngFor=\"let item of history\"\n    tuiCell\n    type=\"button\"\n    (click)=\"select(item)\"\n    (keydown.backspace)=\"remove(item)\"\n    (keydown.delete)=\"remove(item)\"\n    (mousedown.prevent)=\"(0)\"\n>\n    <tui-avatar [src]=\"options.history\" />\n    <span tuiTitle>{{ item }}</span>\n    <button\n        appearance=\"icon\"\n        size=\"xs\"\n        tabindex=\"-1\"\n        tuiIconButton\n        type=\"button\"\n        [iconStart]=\"options.remove\"\n        (click.stop)=\"remove(item)\"\n    >\n        \uD83D\uDDD1\uFE0F\n    </button>\n</button>\n<label\n    *ngIf=\"popular.length\"\n    class=\"t-sr-label\"\n>\n    {{ i18n()?.popular }}\n</label>\n<button\n    *ngFor=\"let item of popular\"\n    tuiCell\n    type=\"button\"\n    (click)=\"select(item)\"\n    (mousedown.prevent)=\"(0)\"\n>\n    <tui-avatar [src]=\"options.popular\" />\n    <span tuiTitle>{{ item }}</span>\n</button>\n", styles: [":host:not(:empty){display:block;padding:.375rem 0}\n"], dependencies: [{ kind: "directive", type: NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: TuiAvatar, selector: "tui-avatar,button[tuiAvatar],a[tuiAvatar]", inputs: ["size", "round", "src"] }, { kind: "directive", type: TuiButton, selector: "a[tuiButton],button[tuiButton],a[tuiIconButton],button[tuiIconButton]", inputs: ["size"] }, { kind: "directive", type: TuiCell, selector: "[tuiCell]:not(ng-template)", inputs: ["tuiCell", "tuiCellHeight"] }, { kind: "directive", type: TuiTitle, selector: "[tuiTitle]", inputs: ["tuiTitle"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { TuiSearchHistory };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiSearchHistory, decorators: [{
            type: Component,
            args: [{ standalone: true, selector: 'tui-search-history', imports: [NgForOf, NgIf, TuiAvatar, TuiButton, TuiCell, TuiTitle], changeDetection: ChangeDetectionStrategy.OnPush, template: "<label\n    *ngIf=\"history.length\"\n    class=\"t-sr-label\"\n>\n    {{ i18n()?.history }}\n</label>\n<button\n    *ngFor=\"let item of history\"\n    tuiCell\n    type=\"button\"\n    (click)=\"select(item)\"\n    (keydown.backspace)=\"remove(item)\"\n    (keydown.delete)=\"remove(item)\"\n    (mousedown.prevent)=\"(0)\"\n>\n    <tui-avatar [src]=\"options.history\" />\n    <span tuiTitle>{{ item }}</span>\n    <button\n        appearance=\"icon\"\n        size=\"xs\"\n        tabindex=\"-1\"\n        tuiIconButton\n        type=\"button\"\n        [iconStart]=\"options.remove\"\n        (click.stop)=\"remove(item)\"\n    >\n        \uD83D\uDDD1\uFE0F\n    </button>\n</button>\n<label\n    *ngIf=\"popular.length\"\n    class=\"t-sr-label\"\n>\n    {{ i18n()?.popular }}\n</label>\n<button\n    *ngFor=\"let item of popular\"\n    tuiCell\n    type=\"button\"\n    (click)=\"select(item)\"\n    (mousedown.prevent)=\"(0)\"\n>\n    <tui-avatar [src]=\"options.popular\" />\n    <span tuiTitle>{{ item }}</span>\n</button>\n", styles: [":host:not(:empty){display:block;padding:.375rem 0}\n"] }]
        }], propDecorators: { popular: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWhpc3RvcnkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZXhwZXJpbWVudGFsL2NvbXBvbmVudHMvc2VhcmNoLXJlc3VsdHMvc2VhcmNoLWhpc3RvcnkuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZXhwZXJpbWVudGFsL2NvbXBvbmVudHMvc2VhcmNoLXJlc3VsdHMvc2VhcmNoLWhpc3RvcnkuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUM5QyxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDaEYsT0FBTyxFQUFDLGtCQUFrQixFQUFFLFFBQVEsRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQ3hFLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6QyxPQUFPLEVBQUMsZ0JBQWdCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUNyRCxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDM0QsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0scUNBQXFDLENBQUM7QUFDMUUsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlDQUFpQyxDQUFDO0FBQ3pELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFDMUQsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBQ3pELE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ3pELE9BQU8sRUFBQyxNQUFNLEVBQUUsR0FBRyxFQUFDLE1B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LENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztJQUN2RSxDQUFDOytHQWxEUSxnQkFBZ0I7bUdBQWhCLGdCQUFnQiw4R0MvQjdCLDRnQ0E2Q0EsOEdEMUJjLE9BQU8sbUhBQUUsSUFBSSw2RkFBRSxTQUFTLHdIQUFFLFNBQVMsb0lBQUUsT0FBTyw2R0FBRSxRQUFROztTQVl2RCxnQkFBZ0I7NEZBQWhCLGdCQUFnQjtrQkFmNUIsU0FBUztpQ0FDTSxJQUFJLFlBQ04sb0JBQW9CLFdBQ3JCLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUMsbUJBVWhELHVCQUF1QixDQUFDLE1BQU07OEJBdUJ4QyxPQUFPO3NCQURiLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge05nRm9yT2YsIE5nSWZ9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIGluamVjdCwgSW5wdXR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHt0YWtlVW50aWxEZXN0cm95ZWQsIHRvU2lnbmFsfSBmcm9tICdAYW5ndWxhci9jb3JlL3J4anMtaW50ZXJvcCc7XG5pbXBvcnQge05nQ29udHJvbH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtXQV9MT0NBTF9TVE9SQUdFfSBmcm9tICdAbmctd2ViLWFwaXMvY29tbW9uJztcbmltcG9ydCB7VHVpQnV0dG9ufSBmcm9tICdAdGFpZ2EtdWkvY29yZS9jb21wb25lbnRzL2J1dHRvbic7XG5pbXBvcnQge1R1aVRleHRmaWVsZENvbXBvbmVudH0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvY29tcG9uZW50cy90ZXh0ZmllbGQnO1xuaW1wb3J0IHtUdWlUaXRsZX0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvZGlyZWN0aXZlcy90aXRsZSc7XG5pbXBvcnQge1RVSV9DTE9TRV9XT1JEfSBmcm9tICdAdGFpZ2EtdWkvY29yZS90b2tlbnMnO1xuaW1wb3J0IHtUdWlBdmF0YXJ9IGZyb20gJ0B0YWlnYS11aS9raXQvY29tcG9uZW50cy9hdmF0YXInO1xuaW1wb3J0IHtUdWlDZWxsfSBmcm9tICdAdGFpZ2EtdWkvbGF5b3V0L2NvbXBvbmVudHMvY2VsbCc7XG5pbXBvcnQge1RVSV9JTlBVVF9TRUFSQ0h9IGZyb20gJ0B0YWlnYS11aS9sYXlvdXQvdG9rZW5zJztcbmltcG9ydCB7ZmlsdGVyLCBtYXB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQge1RVSV9TRUFSQ0hfUkVTVUxUU19PUFRJT05TfSBmcm9tICcuL3NlYXJjaC1yZXN1bHRzLm9wdGlvbnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzdGFuZGFsb25lOiB0cnVlLFxuICAgIHNlbGVjdG9yOiAndHVpLXNlYXJjaC1oaXN0b3J5JyxcbiAgICBpbXBvcnRzOiBbTmdGb3JPZiwgTmdJZiwgVHVpQXZhdGFyLCBUdWlCdXR0b24sIFR1aUNlbGwsIFR1aVRpdGxlXSxcbiAgICB0ZW1wbGF0ZVVybDogJy4vc2VhcmNoLWhpc3RvcnkuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlczogW1xuICAgICAgICBgXG4gICAgICAgICAgICA6aG9zdDpub3QoOmVtcHR5KSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICAgICAgcGFkZGluZzogMC4zNzVyZW0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgYCxcbiAgICBdLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBUdWlTZWFyY2hIaXN0b3J5IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHRleHRmaWVsZCA9IGluamVjdChUdWlUZXh0ZmllbGRDb21wb25lbnQpO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgc3RvcmFnZSA9IGluamVjdChXQV9MT0NBTF9TVE9SQUdFKTtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbnRyb2wgPSBpbmplY3QoTmdDb250cm9sKTtcblxuICAgIHByb3RlY3RlZCByZWFkb25seSBjbG9zZSA9IHRvU2lnbmFsKGluamVjdChUVUlfQ0xPU0VfV09SRCkpO1xuICAgIHByb3RlY3RlZCByZWFkb25seSBpMThuID0gdG9TaWduYWwoaW5qZWN0KFRVSV9JTlBVVF9TRUFSQ0gpKTtcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgb3B0aW9ucyA9IGluamVjdChUVUlfU0VBUkNIX1JFU1VMVFNfT1BUSU9OUyk7XG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5ICQgPSB0aGlzLmNvbnRyb2wudmFsdWVDaGFuZ2VzXG4gICAgICAgID8ucGlwZShcbiAgICAgICAgICAgIG1hcChTdHJpbmcpLFxuICAgICAgICAgICAgZmlsdGVyKChpdGVtKSA9PiAhIWl0ZW0gJiYgIXRoaXMucG9wdWxhci5pbmNsdWRlcyhpdGVtKSksXG4gICAgICAgICAgICB0YWtlVW50aWxEZXN0cm95ZWQoKSxcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdG9yZSh2YWx1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgcHJvdGVjdGVkIGhpc3RvcnkgPSB0aGlzLml0ZW1zO1xuXG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgcG9wdWxhcjogcmVhZG9ubHkgc3RyaW5nW10gPSBbXTtcblxuICAgIHByb3RlY3RlZCBzdG9yZShpdGVtOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdG9yYWdlPy5zZXRJdGVtKFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmtleSxcbiAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KFxuICAgICAgICAgICAgICAgIEFycmF5LmZyb20obmV3IFNldChbaXRlbS50cmltKCksIC4uLnRoaXMuaXRlbXNdKSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigodiwgXywgYSkgPT4gdiAmJiAhYS5maW5kKChzKSA9PiBzLnN0YXJ0c1dpdGgodikgJiYgcyAhPT0gdikpXG4gICAgICAgICAgICAgICAgICAgIC5zbGljZSgwLCA1KSxcbiAgICAgICAgICAgICksXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHJlbW92ZShpdGVtOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50ZXh0ZmllbGQuaW5wdXQ/Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgdGhpcy5oaXN0b3J5ID0gdGhpcy5oaXN0b3J5LmZpbHRlcigodikgPT4gdiAhPT0gaXRlbSk7XG4gICAgICAgIHRoaXMuc3RvcmFnZT8uc2V0SXRlbShcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5rZXksXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLml0ZW1zLmZpbHRlcigodikgPT4gdiAhPT0gaXRlbSkpLFxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzZWxlY3QoaXRlbTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29udHJvbC5jb250cm9sPy5zZXRWYWx1ZShpdGVtKTtcbiAgICAgICAgdGhpcy50ZXh0ZmllbGQuaW5wdXQ/Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldCBpdGVtcygpOiByZWFkb25seSBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXMuc3RvcmFnZT8uZ2V0SXRlbSh0aGlzLm9wdGlvbnMua2V5KSB8fCAnW10nKTtcbiAgICB9XG59XG4iLCI8bGFiZWxcbiAgICAqbmdJZj1cImhpc3RvcnkubGVuZ3RoXCJcbiAgICBjbGFzcz1cInQtc3ItbGFiZWxcIlxuPlxuICAgIHt7IGkxOG4oKT8uaGlzdG9yeSB9fVxuPC9sYWJlbD5cbjxidXR0b25cbiAgICAqbmdGb3I9XCJsZXQgaXRlbSBvZiBoaXN0b3J5XCJcbiAgICB0dWlDZWxsXG4gICAgdHlwZT1cImJ1dHRvblwiXG4gICAgKGNsaWNrKT1cInNlbGVjdChpdGVtKVwiXG4gICAgKGtleWRvd24uYmFja3NwYWNlKT1cInJlbW92ZShpdGVtKVwiXG4gICAgKGtleWRvd24uZGVsZXRlKT1cInJlbW92ZShpdGVtKVwiXG4gICAgKG1vdXNlZG93bi5wcmV2ZW50KT1cIigwKVwiXG4+XG4gICAgPHR1aS1hdmF0YXIgW3NyY109XCJvcHRpb25zLmhpc3RvcnlcIiAvPlxuICAgIDxzcGFuIHR1aVRpdGxlPnt7IGl0ZW0gfX08L3NwYW4+XG4gICAgPGJ1dHRvblxuICAgICAgICBhcHBlYXJhbmNlPVwiaWNvblwiXG4gICAgICAgIHNpemU9XCJ4c1wiXG4gICAgICAgIHRhYmluZGV4PVwiLTFcIlxuICAgICAgICB0dWlJY29uQnV0dG9uXG4gICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICBbaWNvblN0YXJ0XT1cIm9wdGlvbnMucmVtb3ZlXCJcbiAgICAgICAgKGNsaWNrLnN0b3ApPVwicmVtb3ZlKGl0ZW0pXCJcbiAgICA+XG4gICAgICAgIPCfl5HvuI9cbiAgICA8L2J1dHRvbj5cbjwvYnV0dG9uPlxuPGxhYmVsXG4gICAgKm5nSWY9XCJwb3B1bGFyLmxlbmd0aFwiXG4gICAgY2xhc3M9XCJ0LXNyLWxhYmVsXCJcbj5cbiAgICB7eyBpMThuKCk/LnBvcHVsYXIgfX1cbjwvbGFiZWw+XG48YnV0dG9uXG4gICAgKm5nRm9yPVwibGV0IGl0ZW0gb2YgcG9wdWxhclwiXG4gICAgdHVpQ2VsbFxuICAgIHR5cGU9XCJidXR0b25cIlxuICAgIChjbGljayk9XCJzZWxlY3QoaXRlbSlcIlxuICAgIChtb3VzZWRvd24ucHJldmVudCk9XCIoMClcIlxuPlxuICAgIDx0dWktYXZhdGFyIFtzcmNdPVwib3B0aW9ucy5wb3B1bGFyXCIgLz5cbiAgICA8c3BhbiB0dWlUaXRsZT57eyBpdGVtIH19PC9zcGFuPlxuPC9idXR0b24+XG4iXX0=