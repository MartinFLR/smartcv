import { NgIf } from '@angular/common';
import { ChangeDetectionStrategy, Component, inject, TemplateRef, ViewEncapsulation, } from '@angular/core';
import { takeUntilDestroyed, toSignal } from '@angular/core/rxjs-interop';
import { TUI_TRUE_HANDLER } from '@taiga-ui/cdk/constants';
import { TuiAnimated } from '@taiga-ui/cdk/directives/animated';
import { TuiAutoFocus } from '@taiga-ui/cdk/directives/auto-focus';
import { TuiButton } from '@taiga-ui/core/components/button';
import { TUI_DIALOGS_CLOSE, TuiDialogCloseService } from '@taiga-ui/core/components/dialog';
import { TuiTitle } from '@taiga-ui/core/directives/title';
import { TUI_CLOSE_WORD, TUI_COMMON_ICONS } from '@taiga-ui/core/tokens';
import { TUI_HEADER_OPTIONS, TuiHeader } from '@taiga-ui/layout/components/header';
import { injectContext, PolymorpheusComponent, PolymorpheusOutlet, PolymorpheusTemplate, } from '@taiga-ui/polymorpheus';
import { exhaustMap, filter, isObservable, map, merge, of, Subject, switchMap, take, } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@taiga-ui/cdk/directives/animated";
const REQUIRED_ERROR = new Error('Required dialog was dismissed');
function toObservable(valueOrStream) {
    return isObservable(valueOrStream) ? valueOrStream : of(valueOrStream);
}
class TuiDialogComponent {
    constructor() {
        this.close$ = new Subject();
        this.close = toSignal(inject(TUI_CLOSE_WORD));
        this.icons = inject(TUI_COMMON_ICONS);
        this.context = injectContext();
        this.primitive = !(this.context.content instanceof TemplateRef) &&
            !(this.context.content instanceof PolymorpheusTemplate) &&
            !(this.context.content instanceof PolymorpheusComponent);
        this.sub = merge(this.close$.pipe(switchMap(() => toObservable(this.context.closable))), inject(TuiDialogCloseService).pipe(exhaustMap(() => toObservable(this.context.dismissible).pipe(take(1)))), inject(TUI_DIALOGS_CLOSE).pipe(map(TUI_TRUE_HANDLER)))
            .pipe(filter(Boolean), takeUntilDestroyed())
            .subscribe(() => {
            if (this.context.required) {
                this.context.$implicit.error(REQUIRED_ERROR);
            }
            else {
                this.context.$implicit.complete();
            }
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiDialogComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: TuiDialogComponent, isStandalone: true, selector: "tui-dialog", host: { attributes: { "new": "" }, properties: { "attr.data-appearance": "context.appearance", "attr.data-size": "context.size", "class._closable": "context.closable" } }, providers: [
            TuiDialogCloseService,
            {
                provide: TUI_HEADER_OPTIONS,
                useFactory: () => ({ size: getSize(injectContext()) }),
            },
        ], hostDirectives: [{ directive: i1.TuiAnimated }], ngImport: i0, template: "<button\n    *ngIf=\"context.closable\"\n    size=\"s\"\n    tuiIconButton\n    type=\"button\"\n    class=\"t-close\"\n    [appearance]=\"context.appearance === 'fullscreen' ? 'action' : 'neutral'\"\n    [iconStart]=\"icons.close\"\n    [style.border-radius.%]=\"100\"\n    (click)=\"close$.next()\"\n    (mousedown.prevent.zoneless)=\"(0)\"\n>\n    {{ close() }}\n</button>\n\n<header\n    *ngIf=\"!primitive && context.label\"\n    tuiHeader\n>\n    <hgroup tuiTitle>\n        <h2\n            [id]=\"context.id\"\n            [innerHTML]=\"context.label\"\n        ></h2>\n    </hgroup>\n</header>\n\n<ng-container *polymorpheusOutlet=\"context.content as text; context: context\">\n    <header tuiHeader>\n        <hgroup tuiTitle>\n            <h2\n                [id]=\"context.id\"\n                [innerHTML]=\"context.label\"\n            ></h2>\n            <p [innerHTML]=\"text\"></p>\n        </hgroup>\n    </header>\n    <footer *ngIf=\"context.closable || context.dismissible\">\n        <button\n            size=\"m\"\n            tuiAutoFocus\n            tuiButton\n            type=\"button\"\n            (click)=\"context.$implicit.complete()\"\n        >\n            {{ context.data || 'OK' }}\n        </button>\n    </footer>\n</ng-container>\n", styles: ["tui-dialog[new]{position:relative;box-sizing:border-box;font:var(--tui-font-text-m);background:var(--tui-background-elevation-1);box-shadow:var(--tui-shadow-popup)}tui-dialog[new]:not([data-appearance~=fullscreen])._closable>header,tui-dialog[new]:not([data-appearance~=fullscreen])._closable>ng-component>header{padding-inline-end:2.5rem}tui-dialog[new]>.t-close{position:absolute;top:1rem;z-index:1;inset-inline-end:1rem}tui-dialog[new][data-appearance~=taiga]{max-inline-size:calc(100vw - 5rem);margin:2.5rem;padding:1.75rem;border-radius:1.5rem;--tui-from: translateY(2.5rem)}tui-dialog[new][data-appearance~=taiga].tui-enter,tui-dialog[new][data-appearance~=taiga].tui-leave{animation-name:tuiFade,tuiSlide}tui-dialog[new][data-appearance~=taiga][data-size=s]{inline-size:25rem;padding:1.5rem}tui-dialog[new][data-appearance~=taiga][data-size=s]>header:not(:last-child),tui-dialog[new][data-appearance~=taiga][data-size=s]>ng-component>header:not(:last-child){margin-block-end:1.25rem}tui-dialog[new][data-appearance~=taiga][data-size=s]>footer,tui-dialog[new][data-appearance~=taiga][data-size=s]>ng-component>footer,tui-dialog[new][data-appearance~=taiga][data-size=s]>tui-confirm>footer{margin-block-start:1.25rem}tui-dialog[new][data-appearance~=taiga][data-size=m]{inline-size:37.5rem}tui-dialog[new][data-appearance~=taiga][data-size=l]{inline-size:50rem}tui-dialog[new][data-appearance~=taiga]>header:not(:last-child),tui-dialog[new][data-appearance~=taiga]>ng-component>header:not(:last-child){margin-block-end:1.5rem}tui-dialog[new][data-appearance~=taiga]>footer,tui-dialog[new][data-appearance~=taiga]>ng-component>footer,tui-dialog[new][data-appearance~=taiga]>tui-confirm>footer{display:flex;justify-content:flex-end;flex-wrap:wrap-reverse;gap:.75rem;margin-block-start:2rem}tui-dialog[new][data-appearance~=fullscreen]{display:flex;flex-direction:column;block-size:100%;inline-size:100%;padding:env(safe-area-inset-top) max(calc(50vw - var(--tui-width) / 2),1rem) max(2rem,env(safe-area-inset-bottom));background:var(--tui-background-base);box-shadow:none;--tui-width: 45rem;--tui-from: translateY(2rem)}tui-dialog[new][data-appearance~=fullscreen].tui-enter,tui-dialog[new][data-appearance~=fullscreen].tui-leave{animation-name:tuiFade,tuiSlide}tui-dialog[new][data-appearance~=fullscreen]>.t-close{position:sticky;top:env(safe-area-inset-top);block-size:4rem;inline-size:auto;align-self:flex-end;margin-block-end:2rem;border-radius:0!important;font:var(--tui-font-text-m)!important;border-image:conic-gradient(var(--tui-background-base) 0 0) fill 0 / 0 / env(safe-area-inset-top) 100vw 0}tui-dialog[new][data-appearance~=fullscreen]>.t-close:before{display:none}tui-dialog[new][data-appearance~=fullscreen].tui-app-bar .t-close{display:none}tui-dialog[new][data-appearance~=fullscreen]:not(._closable):not(.tui-app-bar):before{content:\"\";block-size:1.5rem}tui-dialog[new][data-appearance~=fullscreen]>tui-app-bar,tui-dialog[new][data-appearance~=fullscreen]>ng-component>tui-app-bar{position:sticky;top:0;z-index:1;order:-1;border-inline-end:calc(50vw - var(--tui-width) / 2) solid transparent;border-inline-start:calc(50vw - var(--tui-width) / 2) solid transparent;margin:0 calc(var(--tui-width) / 2 - 50vw) 2rem}tui-dialog[new][data-appearance~=fullscreen]>header,tui-dialog[new][data-appearance~=fullscreen]>[tuiSlides]>*>header,tui-dialog[new][data-appearance~=fullscreen]>ng-component>header,tui-dialog[new][data-appearance~=fullscreen]>ng-component>[tuiSlides]>*>header{margin-block-end:2rem}tui-dialog[new][data-appearance~=fullscreen]>footer,tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer{display:flex;gap:.5rem .75rem;padding:2rem calc(50vw - var(--tui-width) / 2);margin:0 calc(var(--tui-width) / 2 - 50vw) calc(-2rem - env(safe-area-inset-top))}tui-dialog[new][data-appearance~=fullscreen]>footer:before,tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer:before{left:0;right:0}tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer{flex-direction:row;background:color-mix(in hsl,var(--tui-background-base) 80%,transparent);-webkit-backdrop-filter:blur(2rem);backdrop-filter:blur(2rem)}tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer:before,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer:before{display:none}tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer>button,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer>button,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer>a,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer>a{inline-size:auto}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]{padding-block-end:max(1rem,env(safe-area-inset-bottom));--tui-from: translateY(4rem)}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen] .t-close{align-self:flex-start;block-size:3.5rem;margin-block-end:1rem}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>tui-app-bar,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>tui-app-bar{margin:calc(-1*env(safe-area-inset-top)) -1rem 1rem;padding-block-start:env(safe-area-inset-top);box-sizing:content-box}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>header,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>[tuiSlides]>*>header,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>header,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>[tuiSlides]>*>header{margin:-.25rem 0 1.5rem}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>footer,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer{padding:0 1rem max(1rem,env(safe-area-inset-bottom));margin:1.5rem -1rem calc(-1*max(1rem,env(safe-area-inset-bottom)))}\n"], dependencies: [{ kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: PolymorpheusOutlet, selector: "[polymorpheusOutlet]", inputs: ["polymorpheusOutlet", "polymorpheusOutletContext"] }, { kind: "directive", type: TuiAutoFocus, selector: "[tuiAutoFocus]", inputs: ["tuiAutoFocus"] }, { kind: "directive", type: TuiButton, selector: "a[tuiButton],button[tuiButton],a[tuiIconButton],button[tuiIconButton]", inputs: ["size"] }, { kind: "directive", type: TuiHeader, selector: "[tuiHeader]", inputs: ["tuiHeader"] }, { kind: "directive", type: TuiTitle, selector: "[tuiTitle]", inputs: ["tuiTitle"] }], changeDetection: i0.ChangeDetectionStrategy.Default, encapsulation: i0.ViewEncapsulation.None }); }
}
export { TuiDialogComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiDialogComponent, decorators: [{
            type: Component,
            args: [{ standalone: true, selector: 'tui-dialog', imports: [NgIf, PolymorpheusOutlet, TuiAutoFocus, TuiButton, TuiHeader, TuiTitle], encapsulation: ViewEncapsulation.None, changeDetection: ChangeDetectionStrategy.Default, providers: [
                        TuiDialogCloseService,
                        {
                            provide: TUI_HEADER_OPTIONS,
                            useFactory: () => ({ size: getSize(injectContext()) }),
                        },
                    ], hostDirectives: [TuiAnimated], host: {
                        new: '',
                        '[attr.data-appearance]': 'context.appearance',
                        '[attr.data-size]': 'context.size',
                        '[class._closable]': 'context.closable',
                    }, template: "<button\n    *ngIf=\"context.closable\"\n    size=\"s\"\n    tuiIconButton\n    type=\"button\"\n    class=\"t-close\"\n    [appearance]=\"context.appearance === 'fullscreen' ? 'action' : 'neutral'\"\n    [iconStart]=\"icons.close\"\n    [style.border-radius.%]=\"100\"\n    (click)=\"close$.next()\"\n    (mousedown.prevent.zoneless)=\"(0)\"\n>\n    {{ close() }}\n</button>\n\n<header\n    *ngIf=\"!primitive && context.label\"\n    tuiHeader\n>\n    <hgroup tuiTitle>\n        <h2\n            [id]=\"context.id\"\n            [innerHTML]=\"context.label\"\n        ></h2>\n    </hgroup>\n</header>\n\n<ng-container *polymorpheusOutlet=\"context.content as text; context: context\">\n    <header tuiHeader>\n        <hgroup tuiTitle>\n            <h2\n                [id]=\"context.id\"\n                [innerHTML]=\"context.label\"\n            ></h2>\n            <p [innerHTML]=\"text\"></p>\n        </hgroup>\n    </header>\n    <footer *ngIf=\"context.closable || context.dismissible\">\n        <button\n            size=\"m\"\n            tuiAutoFocus\n            tuiButton\n            type=\"button\"\n            (click)=\"context.$implicit.complete()\"\n        >\n            {{ context.data || 'OK' }}\n        </button>\n    </footer>\n</ng-container>\n", styles: ["tui-dialog[new]{position:relative;box-sizing:border-box;font:var(--tui-font-text-m);background:var(--tui-background-elevation-1);box-shadow:var(--tui-shadow-popup)}tui-dialog[new]:not([data-appearance~=fullscreen])._closable>header,tui-dialog[new]:not([data-appearance~=fullscreen])._closable>ng-component>header{padding-inline-end:2.5rem}tui-dialog[new]>.t-close{position:absolute;top:1rem;z-index:1;inset-inline-end:1rem}tui-dialog[new][data-appearance~=taiga]{max-inline-size:calc(100vw - 5rem);margin:2.5rem;padding:1.75rem;border-radius:1.5rem;--tui-from: translateY(2.5rem)}tui-dialog[new][data-appearance~=taiga].tui-enter,tui-dialog[new][data-appearance~=taiga].tui-leave{animation-name:tuiFade,tuiSlide}tui-dialog[new][data-appearance~=taiga][data-size=s]{inline-size:25rem;padding:1.5rem}tui-dialog[new][data-appearance~=taiga][data-size=s]>header:not(:last-child),tui-dialog[new][data-appearance~=taiga][data-size=s]>ng-component>header:not(:last-child){margin-block-end:1.25rem}tui-dialog[new][data-appearance~=taiga][data-size=s]>footer,tui-dialog[new][data-appearance~=taiga][data-size=s]>ng-component>footer,tui-dialog[new][data-appearance~=taiga][data-size=s]>tui-confirm>footer{margin-block-start:1.25rem}tui-dialog[new][data-appearance~=taiga][data-size=m]{inline-size:37.5rem}tui-dialog[new][data-appearance~=taiga][data-size=l]{inline-size:50rem}tui-dialog[new][data-appearance~=taiga]>header:not(:last-child),tui-dialog[new][data-appearance~=taiga]>ng-component>header:not(:last-child){margin-block-end:1.5rem}tui-dialog[new][data-appearance~=taiga]>footer,tui-dialog[new][data-appearance~=taiga]>ng-component>footer,tui-dialog[new][data-appearance~=taiga]>tui-confirm>footer{display:flex;justify-content:flex-end;flex-wrap:wrap-reverse;gap:.75rem;margin-block-start:2rem}tui-dialog[new][data-appearance~=fullscreen]{display:flex;flex-direction:column;block-size:100%;inline-size:100%;padding:env(safe-area-inset-top) max(calc(50vw - var(--tui-width) / 2),1rem) max(2rem,env(safe-area-inset-bottom));background:var(--tui-background-base);box-shadow:none;--tui-width: 45rem;--tui-from: translateY(2rem)}tui-dialog[new][data-appearance~=fullscreen].tui-enter,tui-dialog[new][data-appearance~=fullscreen].tui-leave{animation-name:tuiFade,tuiSlide}tui-dialog[new][data-appearance~=fullscreen]>.t-close{position:sticky;top:env(safe-area-inset-top);block-size:4rem;inline-size:auto;align-self:flex-end;margin-block-end:2rem;border-radius:0!important;font:var(--tui-font-text-m)!important;border-image:conic-gradient(var(--tui-background-base) 0 0) fill 0 / 0 / env(safe-area-inset-top) 100vw 0}tui-dialog[new][data-appearance~=fullscreen]>.t-close:before{display:none}tui-dialog[new][data-appearance~=fullscreen].tui-app-bar .t-close{display:none}tui-dialog[new][data-appearance~=fullscreen]:not(._closable):not(.tui-app-bar):before{content:\"\";block-size:1.5rem}tui-dialog[new][data-appearance~=fullscreen]>tui-app-bar,tui-dialog[new][data-appearance~=fullscreen]>ng-component>tui-app-bar{position:sticky;top:0;z-index:1;order:-1;border-inline-end:calc(50vw - var(--tui-width) / 2) solid transparent;border-inline-start:calc(50vw - var(--tui-width) / 2) solid transparent;margin:0 calc(var(--tui-width) / 2 - 50vw) 2rem}tui-dialog[new][data-appearance~=fullscreen]>header,tui-dialog[new][data-appearance~=fullscreen]>[tuiSlides]>*>header,tui-dialog[new][data-appearance~=fullscreen]>ng-component>header,tui-dialog[new][data-appearance~=fullscreen]>ng-component>[tuiSlides]>*>header{margin-block-end:2rem}tui-dialog[new][data-appearance~=fullscreen]>footer,tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer{display:flex;gap:.5rem .75rem;padding:2rem calc(50vw - var(--tui-width) / 2);margin:0 calc(var(--tui-width) / 2 - 50vw) calc(-2rem - env(safe-area-inset-top))}tui-dialog[new][data-appearance~=fullscreen]>footer:before,tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer:before{left:0;right:0}tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer{flex-direction:row;background:color-mix(in hsl,var(--tui-background-base) 80%,transparent);-webkit-backdrop-filter:blur(2rem);backdrop-filter:blur(2rem)}tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer:before,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer:before{display:none}tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer>button,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer>button,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>footer>a,tui-root:not(._mobile) tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer>a{inline-size:auto}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]{padding-block-end:max(1rem,env(safe-area-inset-bottom));--tui-from: translateY(4rem)}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen] .t-close{align-self:flex-start;block-size:3.5rem;margin-block-end:1rem}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>tui-app-bar,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>tui-app-bar{margin:calc(-1*env(safe-area-inset-top)) -1rem 1rem;padding-block-start:env(safe-area-inset-top);box-sizing:content-box}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>header,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>[tuiSlides]>*>header,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>header,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>[tuiSlides]>*>header{margin:-.25rem 0 1.5rem}tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>footer,tui-root._mobile tui-dialog[new][data-appearance~=fullscreen]>ng-component>footer{padding:0 1rem max(1rem,env(safe-area-inset-bottom));margin:1.5rem -1rem calc(-1*max(1rem,env(safe-area-inset-bottom)))}\n"] }]
        }] });
function getSize({ appearance, size }) {
    if (appearance.includes('fullscreen')) {
        return 'h3';
    }
    return size === 's' ? 'h5' : 'h4';
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2V4cGVyaW1lbnRhbC9jb21wb25lbnRzL2RpYWxvZy9kaWFsb2cuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZXhwZXJpbWVudGFsL2NvbXBvbmVudHMvZGlhbG9nL2RpYWxvZy50ZW1wbGF0ZS5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUNyQyxPQUFPLEVBQ0gsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxNQUFNLEVBQ04sV0FBVyxFQUNYLGlCQUFpQixHQUNwQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsa0JBQWtCLEVBQUUsUUFBUSxFQUFDLE1BQU0sNEJBQTRCLENBQUM7QUFDeEUsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDekQsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLG1DQUFtQyxDQUFDO0FBQzlELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxxQ0FBcUMsQ0FBQztBQUVqRSxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDM0QsT0FBTyxFQUFDLGlCQUFpQixFQUFFLHFCQUFxQixFQUFDLE1BQU0sa0NBQWtDLENBQUM7QUFDMUYsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlDQUFpQyxDQUFDO0FBQ3pELE9BQU8sRUFBQyxjQUFjLEVBQUUsZ0JBQWdCLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUN2RSxPQUFPLEVBQUMsa0JBQWtCLEVBQUUsU0FBUyxFQUFDLE1BQU0sb0NBQW9DLENBQUM7QUFDakYsT0FBTyxFQUNILGFBQWEsRUFDYixxQkFBcUIsRUFDckIsa0JBQWtCLEVBQ2xCLG9CQUFvQixHQUN2QixNQUFNLHdCQUF3QixDQUFDO0FB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Q0ksT0FBTyxFQUFFLGtCQUFrQjs0QkFDM0IsVUFBVSxFQUFFLEdBQW1CLEVBQUUsQ0FBQyxDQUFDLEVBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxFQUFDLENBQUM7eUJBQ3ZFO3FCQUNKLGtCQUNlLENBQUMsV0FBVyxDQUFDLFFBQ3ZCO3dCQUNGLEdBQUcsRUFBRSxFQUFFO3dCQUNQLHdCQUF3QixFQUFFLG9CQUFvQjt3QkFDOUMsa0JBQWtCLEVBQUUsY0FBYzt3QkFDbEMsbUJBQW1CLEVBQUUsa0JBQWtCO3FCQUMxQzs7QUE2QkwsU0FBUyxPQUFPLENBQUMsRUFBQyxVQUFVLEVBQUUsSUFBSSxFQUE0QjtJQUMxRCxJQUFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUU7UUFDbkMsT0FBTyxJQUFJLENBQUM7S0FDZjtJQUVELE9BQU8sSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDdEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7TmdJZn0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gICAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gICAgQ29tcG9uZW50LFxuICAgIGluamVjdCxcbiAgICBUZW1wbGF0ZVJlZixcbiAgICBWaWV3RW5jYXBzdWxhdGlvbixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge3Rha2VVbnRpbERlc3Ryb3llZCwgdG9TaWduYWx9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvcnhqcy1pbnRlcm9wJztcbmltcG9ydCB7VFVJX1RSVUVfSEFORExFUn0gZnJvbSAnQHRhaWdhLXVpL2Nkay9jb25zdGFudHMnO1xuaW1wb3J0IHtUdWlBbmltYXRlZH0gZnJvbSAnQHRhaWdhLXVpL2Nkay9kaXJlY3RpdmVzL2FuaW1hdGVkJztcbmltcG9ydCB7VHVpQXV0b0ZvY3VzfSBmcm9tICdAdGFpZ2EtdWkvY2RrL2RpcmVjdGl2ZXMvYXV0by1mb2N1cyc7XG5pbXBvcnQge3R5cGUgVHVpUG9wb3Zlcn0gZnJvbSAnQHRhaWdhLXVpL2Nkay9zZXJ2aWNlcyc7XG5pbXBvcnQge1R1aUJ1dHRvbn0gZnJvbSAnQHRhaWdhLXVpL2NvcmUvY29tcG9uZW50cy9idXR0b24nO1xuaW1wb3J0IHtUVUlfRElBTE9HU19DTE9TRSwgVHVpRGlhbG9nQ2xvc2VTZXJ2aWNlfSBmcm9tICdAdGFpZ2EtdWkvY29yZS9jb21wb25lbnRzL2RpYWxvZyc7XG5pbXBvcnQge1R1aVRpdGxlfSBmcm9tICdAdGFpZ2EtdWkvY29yZS9kaXJlY3RpdmVzL3RpdGxlJztcbmltcG9ydCB7VFVJX0NMT1NFX1dPUkQsIFRVSV9DT01NT05fSUNPTlN9IGZyb20gJ0B0YWlnYS11aS9jb3JlL3Rva2Vucyc7XG5pbXBvcnQge1RVSV9IRUFERVJfT1BUSU9OUywgVHVpSGVhZGVyfSBmcm9tICdAdGFpZ2EtdWkvbGF5b3V0L2NvbXBvbmVudHMvaGVhZGVyJztcbmltcG9ydCB7XG4gICAgaW5qZWN0Q29udGV4dCxcbiAgICBQb2x5bW9ycGhldXNDb21wb25lbnQsXG4gICAgUG9seW1vcnBoZXVzT3V0bGV0LFxuICAgIFBvbHltb3JwaGV1c1RlbXBsYXRlLFxufSBmcm9tICdAdGFpZ2EtdWkvcG9seW1vcnBoZXVzJztcbmltcG9ydCB7XG4gICAgZXhoYXVzdE1hcCxcbiAgICBmaWx0ZXIsXG4gICAgaXNPYnNlcnZhYmxlLFxuICAgIG1hcCxcbiAgICBtZXJnZSxcbiAgICB0eXBlIE9ic2VydmFibGUsXG4gICAgb2YsXG4gICAgU3ViamVjdCxcbiAgICBzd2l0Y2hNYXAsXG4gICAgdGFrZSxcbn0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7dHlwZSBUdWlEaWFsb2dPcHRpb25zfSBmcm9tICcuL2RpYWxvZy5vcHRpb25zJztcblxuY29uc3QgUkVRVUlSRURfRVJST1IgPSBuZXcgRXJyb3IoJ1JlcXVpcmVkIGRpYWxvZyB3YXMgZGlzbWlzc2VkJyk7XG5cbmZ1bmN0aW9uIHRvT2JzZXJ2YWJsZTxUPih2YWx1ZU9yU3RyZWFtOiBPYnNlcnZhYmxlPFQ+IHwgVCk6IE9ic2VydmFibGU8VD4ge1xuICAgIHJldHVybiBpc09ic2VydmFibGUodmFsdWVPclN0cmVhbSkgPyB2YWx1ZU9yU3RyZWFtIDogb2YodmFsdWVPclN0cmVhbSk7XG59XG5cbkBDb21wb25lbnQoe1xuICAgIHN0YW5kYWxvbmU6IHRydWUsXG4gICAgc2VsZWN0b3I6ICd0dWktZGlhbG9nJyxcbiAgICBpbXBvcnRzOiBbTmdJZiwgUG9seW1vcnBoZXVzT3V0bGV0LCBUdWlBdXRvRm9jdXMsIFR1aUJ1dHRvbiwgVHVpSGVhZGVyLCBUdWlUaXRsZV0sXG4gICAgdGVtcGxhdGVVcmw6ICcuL2RpYWxvZy50ZW1wbGF0ZS5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9kaWFsb2cuc3R5bGUubGVzcyddLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gICAgLy8gU28gd2UgZG9uJ3QgZm9yY2UgT25QdXNoIG9uIGRpYWxvZyBjb250ZW50XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9wcmVmZXItb24tcHVzaC1jb21wb25lbnQtY2hhbmdlLWRldGVjdGlvblxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuRGVmYXVsdCxcbiAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgVHVpRGlhbG9nQ2xvc2VTZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgICBwcm92aWRlOiBUVUlfSEVBREVSX09QVElPTlMsXG4gICAgICAgICAgICB1c2VGYWN0b3J5OiAoKToge3NpemU6IHN0cmluZ30gPT4gKHtzaXplOiBnZXRTaXplKGluamVjdENvbnRleHQoKSl9KSxcbiAgICAgICAgfSxcbiAgICBdLFxuICAgIGhvc3REaXJlY3RpdmVzOiBbVHVpQW5pbWF0ZWRdLFxuICAgIGhvc3Q6IHtcbiAgICAgICAgbmV3OiAnJyxcbiAgICAgICAgJ1thdHRyLmRhdGEtYXBwZWFyYW5jZV0nOiAnY29udGV4dC5hcHBlYXJhbmNlJyxcbiAgICAgICAgJ1thdHRyLmRhdGEtc2l6ZV0nOiAnY29udGV4dC5zaXplJyxcbiAgICAgICAgJ1tjbGFzcy5fY2xvc2FibGVdJzogJ2NvbnRleHQuY2xvc2FibGUnLFxuICAgIH0sXG59KVxuZXhwb3J0IGNsYXNzIFR1aURpYWxvZ0NvbXBvbmVudDxPLCBJPiB7XG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGNsb3NlJCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGNsb3NlID0gdG9TaWduYWwoaW5qZWN0KFRVSV9DTE9TRV9XT1JEKSk7XG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGljb25zID0gaW5qZWN0KFRVSV9DT01NT05fSUNPTlMpO1xuICAgIHByb3RlY3RlZCByZWFkb25seSBjb250ZXh0ID0gaW5qZWN0Q29udGV4dDxUdWlQb3BvdmVyPFR1aURpYWxvZ09wdGlvbnM8ST4sIE8+PigpO1xuICAgIHByb3RlY3RlZCByZWFkb25seSBwcmltaXRpdmUgPVxuICAgICAgICAhKHRoaXMuY29udGV4dC5jb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpICYmXG4gICAgICAgICEodGhpcy5jb250ZXh0LmNvbnRlbnQgaW5zdGFuY2VvZiBQb2x5bW9ycGhldXNUZW1wbGF0ZSkgJiZcbiAgICAgICAgISh0aGlzLmNvbnRleHQuY29udGVudCBpbnN0YW5jZW9mIFBvbHltb3JwaGV1c0NvbXBvbmVudCk7XG5cbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgc3ViID0gbWVyZ2UoXG4gICAgICAgIHRoaXMuY2xvc2UkLnBpcGUoc3dpdGNoTWFwKCgpID0+IHRvT2JzZXJ2YWJsZSh0aGlzLmNvbnRleHQuY2xvc2FibGUpKSksXG4gICAgICAgIGluamVjdChUdWlEaWFsb2dDbG9zZVNlcnZpY2UpLnBpcGUoXG4gICAgICAgICAgICBleGhhdXN0TWFwKCgpID0+IHRvT2JzZXJ2YWJsZSh0aGlzLmNvbnRleHQuZGlzbWlzc2libGUpLnBpcGUodGFrZSgxKSkpLFxuICAgICAgICApLFxuICAgICAgICBpbmplY3QoVFVJX0RJQUxPR1NfQ0xPU0UpLnBpcGUobWFwKFRVSV9UUlVFX0hBTkRMRVIpKSxcbiAgICApXG4gICAgICAgIC5waXBlKGZpbHRlcihCb29sZWFuKSwgdGFrZVVudGlsRGVzdHJveWVkKCkpXG4gICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29udGV4dC5yZXF1aXJlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC4kaW1wbGljaXQuZXJyb3IoUkVRVUlSRURfRVJST1IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQuJGltcGxpY2l0LmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRTaXplKHthcHBlYXJhbmNlLCBzaXplfTogVHVpRGlhbG9nT3B0aW9uczx1bmtub3duPik6ICdoMycgfCAnaDQnIHwgJ2g1JyB7XG4gICAgaWYgKGFwcGVhcmFuY2UuaW5jbHVkZXMoJ2Z1bGxzY3JlZW4nKSkge1xuICAgICAgICByZXR1cm4gJ2gzJztcbiAgICB9XG5cbiAgICByZXR1cm4gc2l6ZSA9PT0gJ3MnID8gJ2g1JyA6ICdoNCc7XG59XG4iLCI8YnV0dG9uXG4gICAgKm5nSWY9XCJjb250ZXh0LmNsb3NhYmxlXCJcbiAgICBzaXplPVwic1wiXG4gICAgdHVpSWNvbkJ1dHRvblxuICAgIHR5cGU9XCJidXR0b25cIlxuICAgIGNsYXNzPVwidC1jbG9zZVwiXG4gICAgW2FwcGVhcmFuY2VdPVwiY29udGV4dC5hcHBlYXJhbmNlID09PSAnZnVsbHNjcmVlbicgPyAnYWN0aW9uJyA6ICduZXV0cmFsJ1wiXG4gICAgW2ljb25TdGFydF09XCJpY29ucy5jbG9zZVwiXG4gICAgW3N0eWxlLmJvcmRlci1yYWRpdXMuJV09XCIxMDBcIlxuICAgIChjbGljayk9XCJjbG9zZSQubmV4dCgpXCJcbiAgICAobW91c2Vkb3duLnByZXZlbnQuem9uZWxlc3MpPVwiKDApXCJcbj5cbiAgICB7eyBjbG9zZSgpIH19XG48L2J1dHRvbj5cblxuPGhlYWRlclxuICAgICpuZ0lmPVwiIXByaW1pdGl2ZSAmJiBjb250ZXh0LmxhYmVsXCJcbiAgICB0dWlIZWFkZXJcbj5cbiAgICA8aGdyb3VwIHR1aVRpdGxlPlxuICAgICAgICA8aDJcbiAgICAgICAgICAgIFtpZF09XCJjb250ZXh0LmlkXCJcbiAgICAgICAgICAgIFtpbm5lckhUTUxdPVwiY29udGV4dC5sYWJlbFwiXG4gICAgICAgID48L2gyPlxuICAgIDwvaGdyb3VwPlxuPC9oZWFkZXI+XG5cbjxuZy1jb250YWluZXIgKnBvbHltb3JwaGV1c091dGxldD1cImNvbnRleHQuY29udGVudCBhcyB0ZXh0OyBjb250ZXh0OiBjb250ZXh0XCI+XG4gICAgPGhlYWRlciB0dWlIZWFkZXI+XG4gICAgICAgIDxoZ3JvdXAgdHVpVGl0bGU+XG4gICAgICAgICAgICA8aDJcbiAgICAgICAgICAgICAgICBbaWRdPVwiY29udGV4dC5pZFwiXG4gICAgICAgICAgICAgICAgW2lubmVySFRNTF09XCJjb250ZXh0LmxhYmVsXCJcbiAgICAgICAgICAgID48L2gyPlxuICAgICAgICAgICAgPHAgW2lubmVySFRNTF09XCJ0ZXh0XCI+PC9wPlxuICAgICAgICA8L2hncm91cD5cbiAgICA8L2hlYWRlcj5cbiAgICA8Zm9vdGVyICpuZ0lmPVwiY29udGV4dC5jbG9zYWJsZSB8fCBjb250ZXh0LmRpc21pc3NpYmxlXCI+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIHNpemU9XCJtXCJcbiAgICAgICAgICAgIHR1aUF1dG9Gb2N1c1xuICAgICAgICAgICAgdHVpQnV0dG9uXG4gICAgICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgIChjbGljayk9XCJjb250ZXh0LiRpbXBsaWNpdC5jb21wbGV0ZSgpXCJcbiAgICAgICAgPlxuICAgICAgICAgICAge3sgY29udGV4dC5kYXRhIHx8ICdPSycgfX1cbiAgICAgICAgPC9idXR0b24+XG4gICAgPC9mb290ZXI+XG48L25nLWNvbnRhaW5lcj5cbiJdfQ==