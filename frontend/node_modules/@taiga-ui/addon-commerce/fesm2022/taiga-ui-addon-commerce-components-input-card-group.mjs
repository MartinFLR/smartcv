import { __decorate } from 'tslib';
import { DOCUMENT, isPlatformServer, NgIf } from '@angular/common';
import * as i0 from '@angular/core';
import { inject, Directive, Input, InjectionToken, PLATFORM_ID, computed, EventEmitter, Component, ChangeDetectionStrategy, ViewChild, Output } from '@angular/core';
import { toSignal, takeUntilDestroyed } from '@angular/core/rxjs-interop';
import * as i4 from '@angular/forms';
import { FormsModule } from '@angular/forms';
import { MaskitoDirective } from '@maskito/angular';
import { WaResizeObserver } from '@ng-web-apis/resize-observer';
import { tuiDefaultCardValidator, TUI_MASK_CVC, TUI_MASK_CARD, TUI_MASK_EXPIRE } from '@taiga-ui/addon-commerce/constants';
import { TuiFormatCardPipe } from '@taiga-ui/addon-commerce/pipes';
import { TUI_CARD_NUMBER_TEXTS, TUI_CARD_EXPIRY_TEXTS, TUI_CARD_CVC_TEXTS, TUI_PAYMENT_SYSTEM_ICONS } from '@taiga-ui/addon-commerce/tokens';
import { TuiControl, tuiAsControl } from '@taiga-ui/cdk/classes';
import { TUI_NON_DIGIT_REGEXP, CHAR_NO_BREAK_SPACE } from '@taiga-ui/cdk/constants';
import { tuiHovered, TuiHoveredService } from '@taiga-ui/cdk/directives/hovered';
import { TuiLet } from '@taiga-ui/cdk/directives/let';
import { TuiMapperPipe } from '@taiga-ui/cdk/pipes/mapper';
import { tuiInjectId } from '@taiga-ui/cdk/services';
import { TUI_IS_MOBILE, TUI_IS_WEBKIT } from '@taiga-ui/cdk/tokens';
import { tuiInjectElement, tuiIsElement, tuiIsInput } from '@taiga-ui/cdk/utils/dom';
import { tuiFocusedIn, tuiIsNativeFocused } from '@taiga-ui/cdk/utils/focus';
import { tuiProvideOptions, tuiPure } from '@taiga-ui/cdk/utils/miscellaneous';
import { tuiAsDataListHost } from '@taiga-ui/core/components/data-list';
import { TuiIcon, TuiIconPipe } from '@taiga-ui/core/components/icon';
import { TUI_TEXTFIELD_OPTIONS } from '@taiga-ui/core/components/textfield';
import * as i1 from '@taiga-ui/core/directives/appearance';
import { tuiAppearanceMode, tuiAppearance, tuiAppearanceState, tuiAppearanceFocus, TuiAppearance } from '@taiga-ui/core/directives/appearance';
import * as i2 from '@taiga-ui/core/directives/dropdown';
import { TuiDropdownDirective, tuiDropdownOpen, tuiDropdownOptionsProvider, TuiWithDropdownOpen } from '@taiga-ui/core/directives/dropdown';
import { TUI_COMMON_ICONS } from '@taiga-ui/core/tokens';
import { TuiChevron } from '@taiga-ui/kit/directives/chevron';
import { PolymorpheusOutlet } from '@taiga-ui/polymorpheus';
import { BehaviorSubject, map, combineLatest, Subject, switchMap, timer, EMPTY } from 'rxjs';
import { TuiBreakpointService } from '@taiga-ui/core/services';
import { TUI_INPUT_CARD_DEFAULT_OPTIONS } from '@taiga-ui/addon-commerce/components/input-card';

class TuiInputCardGroupDirective {
    constructor() {
        this.c$ = new BehaviorSubject(false);
        this.m$ = inject(TuiBreakpointService).pipe(map((b) => b === 'mobile'));
        this.compact$ = combineLatest([this.c$, this.m$]).pipe(map((c) => c.some(Boolean)));
        this.compact = toSignal(this.compact$, { initialValue: false });
    }
    set compactSetter(compact) {
        this.c$.next(compact);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiInputCardGroupDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.2.12", type: TuiInputCardGroupDirective, isStandalone: true, inputs: { compactSetter: ["compact", "compactSetter"] }, host: { properties: { "class._compact": "compact()" } }, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiInputCardGroupDirective, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    host: { '[class._compact]': 'compact()' },
                }]
        }], propDecorators: { compactSetter: [{
                type: Input,
                args: ['compact']
            }] } });

const TUI_INPUT_CARD_GROUP_DEFAULT_OPTIONS = {
    ...TUI_INPUT_CARD_DEFAULT_OPTIONS,
    cardValidator: tuiDefaultCardValidator,
    exampleText: '0000 0000 0000 0000',
    exampleTextCVC: '000',
    cvcHidden: true,
    inputs: { cvc: true, expire: true },
};
const TUI_INPUT_CARD_GROUP_OPTIONS = new InjectionToken(ngDevMode ? 'TUI_INPUT_CARD_GROUP_OPTIONS' : '', {
    factory: () => TUI_INPUT_CARD_GROUP_DEFAULT_OPTIONS,
});
function tuiInputCardGroupOptionsProvider(options) {
    return tuiProvideOptions(TUI_INPUT_CARD_GROUP_OPTIONS, options, TUI_INPUT_CARD_GROUP_DEFAULT_OPTIONS);
}

const TUI_INPUT_CARD_GROUP_TEXTS = new InjectionToken(ngDevMode ? 'TUI_INPUT_CARD_GROUP_TEXTS' : '');
const TUI_INPUT_CARD_GROUP_TEXTS_PROVIDER = {
    provide: TUI_INPUT_CARD_GROUP_TEXTS,
    useFactory: () => inject(TUI_INPUT_CARD_GROUP_TEXTS, { skipSelf: true, optional: true }) ??
        combineLatest([
            inject(TuiInputCardGroupDirective).compact$,
            inject(TUI_CARD_NUMBER_TEXTS),
            inject(TUI_CARD_EXPIRY_TEXTS),
            inject(TUI_CARD_CVC_TEXTS),
        ]).pipe(map(([compact, cardNumber, expiry, cvcTexts]) => ({
            cardNumberText: cardNumber[Number(!compact)] ?? '',
            expiryText: expiry[Number(!compact)] ?? '',
            cvcText: cvcTexts[Number(!compact)] ?? '',
        }))),
};

class TuiInputCardGroup extends TuiControl {
    constructor() {
        super(...arguments);
        this.doc = inject(DOCUMENT);
        this.isServer = isPlatformServer(inject(PLATFORM_ID));
        this.focus$ = new Subject();
        this.expirePrefilled = false;
        this.paymentSystems = inject(TUI_PAYMENT_SYSTEM_ICONS);
        this.options = inject(TUI_INPUT_CARD_GROUP_OPTIONS);
        this.el = tuiInjectElement();
        this.hover = tuiHovered();
        this.focusedIn = tuiFocusedIn(this.el);
        this.exampleTextCVC = this.options.exampleTextCVC;
        this.cvcHidden = this.options.cvcHidden;
        this.maskCVC = TUI_MASK_CVC(3);
        this.isMobile = inject(TUI_IS_MOBILE);
        this.isWebkit = inject(TUI_IS_WEBKIT);
        this.dropdown = inject(TuiDropdownDirective);
        this.maskCard = TUI_MASK_CARD;
        this.maskExpire = TUI_MASK_EXPIRE;
        this.icons = inject(TUI_COMMON_ICONS);
        this.textfield = inject(TUI_TEXTFIELD_OPTIONS);
        this.texts = toSignal(inject(TUI_INPUT_CARD_GROUP_TEXTS));
        this.open = tuiDropdownOpen();
        this.$ = this.isWebkit
            ? this.focus$
                .pipe(switchMap(() => timer(100)), takeUntilDestroyed())
                .subscribe(() => (this.expire ? this.focusCVC() : this.focusExpire()))
            : EMPTY;
        this.m = tuiAppearanceMode(this.mode);
        this.appearance = tuiAppearance(inject(TUI_TEXTFIELD_OPTIONS).appearance);
        this.state = tuiAppearanceState(
        // eslint-disable-next-line no-nested-ternary
        computed(() => (this.disabled() ? 'disabled' : this.hover() ? 'hover' : null)));
        this.focus = tuiAppearanceFocus(computed(() => this.open() || this.focusedIn()));
        this.labelRaised = computed(() => (this.focus() && !this.readOnly()) || !!this.value()?.card);
        this.hasCleaner = computed(() => !!this.value()?.card && this.interactive());
        /**
         * @deprecated use 'placeholder' instead
         */
        this.exampleText = this.options.exampleText;
        this.placeholder = this.options.exampleText;
        this.inputs = this.options.inputs;
        this.cardValidator = this.options.cardValidator;
        this.icon = this.options.icon;
        this.id = tuiInjectId();
        /** @deprecated apparently "off" doesn't disable autocomplete */
        this.autocomplete = this.options.autocomplete;
        this.binChange = new EventEmitter();
    }
    set codeLength(length) {
        this.exampleTextCVC = '0'.repeat(length);
        this.maskCVC = TUI_MASK_CVC(length);
    }
    get bin() {
        return this.card.length < 6 ? null : this.card.slice(0, 6);
    }
    ngAfterViewInit() {
        // Enabling transitions
        setTimeout(() => this.el.style.removeProperty('--tui-duration'), 500);
    }
    writeValue(value) {
        const { bin } = this;
        const { activeElement } = this.doc;
        super.writeValue(value);
        this.updateBin(bin);
        this.expirePrefilled = !!this.expire && this.cardPrefilled;
        // Programmatic setting of expire input value breaks autofill in Chrome
        if (!this.inputExpire ||
            this.isMobile ||
            this.isWebkit ||
            this.isServer ||
            this.inputExpire.nativeElement.value === this.expire) {
            return;
        }
        this.inputExpire.nativeElement.focus({ preventScroll: true });
        this.inputExpire.nativeElement.select();
        this.doc.execCommand('insertText', false, this.expire);
        this.inputExpire.nativeElement.blur();
        activeElement?.focus({ preventScroll: true });
    }
    /** Public API for manual focus management */
    focusCard() {
        this.inputCard?.nativeElement.focus({ preventScroll: true });
    }
    focusExpire() {
        if (this.inputs.expire) {
            this.inputExpire?.nativeElement.focus({ preventScroll: true });
        }
        else {
            this.inputCVC?.nativeElement.focus({ preventScroll: true });
        }
    }
    focusCVC() {
        this.inputCVC?.nativeElement.focus({ preventScroll: true });
    }
    handleOption(option) {
        const { card = '', expire = '', cvc = '' } = option || {};
        const { bin } = this;
        const element = (!card && this.inputCard?.nativeElement) ||
            (!expire && this.inputExpire?.nativeElement) ||
            this.inputCVC?.nativeElement;
        this.onChange({ card, expire, cvc });
        this.updateBin(bin);
        this.open.set(false);
        this.expirePrefilled = !!expire;
        element?.focus();
    }
    clear() {
        this.expirePrefilled = false;
        [this.inputCVC, this.inputExpire, this.inputCard].forEach((e) => {
            e?.nativeElement.focus();
            e?.nativeElement.select();
            e?.nativeElement.ownerDocument.execCommand('delete');
        });
        this.onChange(null);
    }
    onResize() {
        this.cdr.detectChanges();
    }
    get content() {
        const system = this.getPaymentSystem(this.card);
        return this.icon || (system && this.paymentSystems[system]);
    }
    get card() {
        return this.value()?.card || '';
    }
    get expire() {
        return this.value()?.expire || '';
    }
    get cvc() {
        return this.value()?.cvc || '';
    }
    get cardCollapsed() {
        return (this.isFocusable(this.card) &&
            !tuiIsNativeFocused(this.inputCard?.nativeElement));
    }
    get tailLength() {
        return this.card.length % 4 > 0 ? 5 : 4;
    }
    get cardPrefilled() {
        return !!this.card.match(TUI_NON_DIGIT_REGEXP);
    }
    get cvcPrefilled() {
        return !this.inputs.cvc || !!this.cvc.match(TUI_NON_DIGIT_REGEXP);
    }
    get cardFocusable() {
        return !this.cardPrefilled;
    }
    get expireFocusable() {
        return this.isFocusable(this.card) && !this.expirePrefilled;
    }
    get cvcFocusable() {
        return this.isFocusable(this.card);
    }
    get masked() {
        return this.cardPrefilled ? `${this.card.slice(-4)}` : '';
    }
    onCardChange(card) {
        const { value, bin } = this;
        const parsed = card.split(CHAR_NO_BREAK_SPACE).join('');
        if (value()?.card === parsed) {
            return;
        }
        this.updateProperty(parsed, 'card');
        this.updateBin(bin);
        if (this.cardValidator(this.card) && !value()?.expire && this.inputExpire) {
            this.focusExpire();
            // Safari autofill focus jerk workaround
            this.focus$.next();
        }
    }
    onExpireChange(expire) {
        this.updateProperty(expire, 'expire');
        // MM/YY
        if (Number(this.inputExpire?.nativeElement.selectionStart) === 5) {
            this.focusCVC();
        }
    }
    onCVCChange(cvc) {
        this.updateProperty(cvc, 'cvc');
    }
    getStyle({ offsetWidth }) {
        return this.cardCollapsed
            ? `transform: translate3d(calc(${offsetWidth}px * var(--tui-inline)), 0, 0); clip-path: inset(0 0 0 calc(100% - ${offsetWidth}px));`
            : '';
    }
    onPointerDown(event) {
        if (tuiIsElement(event.target) && tuiIsInput(event.target)) {
            return;
        }
        event.preventDefault();
        this.focusInput();
    }
    toggle() {
        this.open.update((open) => !open);
    }
    isFocusable(card) {
        return this.cardValidator(card) || this.cardPrefilled;
    }
    getPaymentSystem(value) {
        return this.options.paymentSystemHandler(value);
    }
    updateBin(oldBin) {
        const { bin } = this;
        if (bin !== oldBin && !this.cardPrefilled) {
            this.binChange.emit(bin);
        }
    }
    updateProperty(value, propName) {
        const { card = '', expire = '', cvc = '' } = this.value() || {};
        const newValue = { card, expire, cvc };
        newValue[propName] = value;
        this.onChange(newValue.expire || newValue.cvc || newValue.card ? newValue : null);
    }
    focusInput() {
        const element = (this.cardFocusable && this.inputCard?.nativeElement) ||
            (this.expireFocusable && this.inputExpire?.nativeElement) ||
            this.inputCVC?.nativeElement;
        element?.focus();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiInputCardGroup, deps: null, target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.2.12", type: TuiInputCardGroup, isStandalone: true, selector: "tui-input-card-group", inputs: { exampleText: "exampleText", placeholder: "placeholder", inputs: "inputs", cardValidator: "cardValidator", icon: "icon", id: "id", autocomplete: "autocomplete", codeLength: "codeLength" }, outputs: { binChange: "binChange" }, host: { listeners: { "pointerdown": "onPointerDown($event)", "scroll.zoneless": "$event.target.scrollLeft = 0" }, properties: { "attr.data-size": "textfield.size()", "style.--tui-duration.s": "0" } }, providers: [
            tuiAsDataListHost(TuiInputCardGroup),
            tuiAsControl(TuiInputCardGroup),
            tuiDropdownOptionsProvider({ limitWidth: 'fixed' }),
            TuiHoveredService,
            TUI_INPUT_CARD_GROUP_TEXTS_PROVIDER,
        ], viewQueries: [{ propertyName: "inputCard", first: true, predicate: ["inputCard"], descendants: true, static: true }, { propertyName: "inputExpire", first: true, predicate: ["inputExpire"], descendants: true, static: true }, { propertyName: "inputCVC", first: true, predicate: ["inputCVC"], descendants: true, static: true }], usesInheritance: true, hostDirectives: [{ directive: i1.TuiAppearance }, { directive: i2.TuiDropdownDirective }, { directive: i2.TuiWithDropdownOpen }, { directive: TuiInputCardGroupDirective, inputs: ["compact", "compact"] }], ngImport: i0, template: "<div class=\"t-wrapper\">\n    <label\n        *tuiLet=\"value()?.card | tuiFormatCard: cardPrefilled as formattedCard\"\n        (click.zoneless.prevent)=\"(0)\"\n    >\n        <input\n            #inputCard\n            autocomplete=\"cc-number\"\n            automation-id=\"tui-input-card-group__card\"\n            inputmode=\"numeric\"\n            translate=\"no\"\n            type=\"text\"\n            class=\"t-input t-input_card\"\n            [attr.aria-invalid]=\"!cardPrefilled && !(this.card | tuiMapper: cardValidator)\"\n            [attr.id]=\"id + '_card'\"\n            [class.t-input_filled]=\"card.length\"\n            [class.t-input_inert]=\"cardPrefilled\"\n            [disabled]=\"disabled()\"\n            [maskito]=\"maskCard\"\n            [ngModel]=\"formattedCard\"\n            [ngModelOptions]=\"{standalone: true}\"\n            [placeholder]=\"cardPrefilled ? '' : placeholder || exampleText\"\n            [readOnly]=\"readOnly()\"\n            [tabIndex]=\"cardFocusable ? 0 : -1\"\n            (focus)=\"(0)\"\n            (ngModelChange)=\"onCardChange($event)\"\n        />\n        <span\n            aria-hidden=\"true\"\n            translate=\"no\"\n            class=\"t-collapsed\"\n            [attr.data-before]=\"masked\"\n            [class.t-collapsed_enable-mask]=\"cardCollapsed\"\n            (waResizeObserver)=\"onResize()\"\n        >\n            <span\n                #ghost\n                class=\"t-ghost\"\n                [textContent]=\"formattedCard.slice(-tailLength)\"\n            ></span>\n\n            <span class=\"t-collapsed-wrapper\">\n                <span\n                    class=\"t-value\"\n                    [style]=\"getStyle(ghost)\"\n                    [textContent]=\"formattedCard\"\n                ></span>\n            </span>\n        </span>\n        <div\n            class=\"t-label\"\n            [attr.data-label]=\"texts()?.cardNumberText\"\n            [class.t-label_raised]=\"labelRaised()\"\n        >\n            <ng-content />\n        </div>\n    </label>\n</div>\n<div\n    class=\"t-wrapper t-wrapper_expire\"\n    [class.t-wrapper_active]=\"cardCollapsed\"\n>\n    <label (click.zoneless.prevent)=\"(0)\">\n        <input\n            #inputExpire\n            autocomplete=\"cc-exp\"\n            automation-id=\"tui-input-card-group__expire\"\n            inputmode=\"numeric\"\n            maxlength=\"5\"\n            name=\"ccexpiryyear\"\n            translate=\"no\"\n            class=\"t-input\"\n            [attr.id]=\"id + '_expire'\"\n            [class.t-input_inert]=\"!expireFocusable\"\n            [class.t-input_prefilled]=\"!inputs.expire\"\n            [disabled]=\"disabled()\"\n            [maskito]=\"maskExpire\"\n            [ngModel]=\"expire\"\n            [ngModelOptions]=\"{standalone: true}\"\n            [placeholder]=\"inputs.expire ? '00/00' : '\u2022\u2022/\u2022\u2022'\"\n            [readOnly]=\"readOnly() || !inputs.expire\"\n            [tabIndex]=\"expireFocusable || (isMobile && isWebkit) ? 0 : -1\"\n            (focus)=\"(0)\"\n            (ngModelChange)=\"onExpireChange($event)\"\n        />\n        <div\n            class=\"t-label\"\n            [class.t-label_raised]=\"labelRaised()\"\n        >\n            {{ texts()?.expiryText }}\n        </div>\n    </label>\n</div>\n<div\n    class=\"t-wrapper t-wrapper_cvc\"\n    [class.t-wrapper_active]=\"cardCollapsed\"\n>\n    <label (click.zoneless.prevent)=\"(0)\">\n        <input\n            #inputCVC\n            autocomplete=\"cc-csc\"\n            automation-id=\"tui-input-card-group__cvc\"\n            inputmode=\"numeric\"\n            translate=\"no\"\n            type=\"text\"\n            class=\"t-input\"\n            [attr.id]=\"id + '_cvc'\"\n            [class.t-input_cvc_hidden]=\"cvcHidden\"\n            [class.t-input_prefilled]=\"cvcPrefilled\"\n            [disabled]=\"disabled()\"\n            [maskito]=\"maskCVC\"\n            [ngModel]=\"cvc\"\n            [ngModelOptions]=\"{standalone: true}\"\n            [placeholder]=\"cvcPrefilled ? '\u2022\u2022\u2022' : exampleTextCVC\"\n            [readOnly]=\"readOnly() || cvcPrefilled\"\n            [tabIndex]=\"cvcFocusable || (isMobile && isWebkit) ? 0 : -1\"\n            (focus)=\"(0)\"\n            (ngModelChange)=\"onCVCChange($event)\"\n        />\n        <div\n            class=\"t-label\"\n            [class.t-label_raised]=\"labelRaised()\"\n        >\n            {{ texts()?.cvcText }}\n        </div>\n    </label>\n</div>\n<div class=\"t-icons\">\n    <div\n        *ngIf=\"content\"\n        class=\"t-icon-outlet\"\n    >\n        <img\n            *polymorpheusOutlet=\"content as src\"\n            alt=\"\"\n            automation-id=\"tui-input-card-group__icon\"\n            class=\"t-card\"\n            [src]=\"src | tuiIcon\"\n        />\n    </div>\n    <tui-icon\n        *ngIf=\"hasCleaner()\"\n        automation-id=\"tui-input-card-group__cleaner\"\n        tuiAppearance=\"icon\"\n        class=\"t-icon\"\n        [icon]=\"icons.close\"\n        [style.border-width.rem]=\"0.25\"\n        (click)=\"clear()\"\n    />\n    <tui-icon\n        *ngIf=\"dropdown._content()\"\n        automation-id=\"tui-input-card-group__dropdown\"\n        tuiAppearance=\"icon\"\n        tuiChevron\n        class=\"t-icon\"\n        (click)=\"toggle()\"\n    />\n</div>\n", styles: ["@keyframes outside{0%{transform:translate3d(calc(var(--t-translate) * var(--tui-inline)),0,0)}to{transform:translate3d(calc(100% * var(--tui-inline)),0,0)}}@keyframes inside{0%{transform:translate3d(calc(100% * var(--tui-inline)),0,0)}to{transform:translate3d(calc(var(--t-translate) * var(--tui-inline)),0,0)}}:host{--t-height: var(--tui-height-l);--t-padding: var(--tui-padding-l);--t-label: -.7rem;--t-label-size: .83em;--t-translate: 6.5625rem;position:relative;display:block;block-size:var(--t-height);inline-size:29.5rem;border-radius:var(--tui-radius-l);overflow:hidden;font:var(--tui-font-text-ui-m);isolation:isolate}:host[data-size=m]{--t-label: -.7em;--t-height: var(--tui-height-m);--t-padding: var(--tui-padding-m);border-radius:var(--tui-radius-m);font:var(--tui-font-text-ui-s)}:host[data-size=m] .t-card{inline-size:1.5rem;block-size:1.5rem}:host[data-size=m] [tuiChevron]{margin-inline-end:-.875rem;margin-inline-start:.125rem}:host._compact{inline-size:18rem;--t-translate: 4.125rem}:host[tuiAppearance][data-appearance]:has(:-webkit-autofill){background:var(--tui-service-autofill-background)!important}:host [tuiChevron]{block-size:auto;align-self:stretch;border-inline-end:var(--t-padding) solid transparent;margin-inline-end:-.75rem;box-sizing:content-box;font-size:1rem;cursor:pointer}.t-wrapper{position:absolute;z-index:1;inline-size:100%;block-size:100%;transition:opacity 0s var(--tui-duration)}.t-wrapper_cvc,.t-wrapper_expire{opacity:0;pointer-events:none;animation:outside var(--tui-duration) ease-in-out}.t-wrapper_cvc{margin-inline-start:7.1875rem}:host._compact .t-wrapper_cvc{margin-inline-start:4.0625rem}.t-wrapper_active{transition:none;pointer-events:auto;opacity:1;animation:inside var(--tui-duration) ease-in-out forwards}.t-card{inline-size:2rem;block-size:2rem}.t-collapsed{position:absolute;top:0;left:0;inline-size:100%;block-size:100%;padding:calc(var(--t-height) / 3) var(--t-padding) 0;box-sizing:border-box;line-height:calc(2 * var(--t-height) / 3);color:var(--tui-text-primary);white-space:nowrap;pointer-events:none}.t-collapsed:after{content:\"*\";float:left;opacity:0}:host-context([dir=\"rtl\"]) .t-collapsed:after{float:none}.t-collapsed_enable-mask:before{content:attr(data-before)}.t-collapsed_enable-mask:after{opacity:1}:host-context([dir=\"rtl\"]) .t-collapsed_enable-mask:after{transition:opacity 0s var(--tui-duration)}.t-collapsed_enable-mask .t-collapsed-wrapper{left:1.375rem}:host-context([dir=\"rtl\"]) .t-collapsed_enable-mask .t-collapsed-wrapper{left:unset}.t-collapsed-wrapper{position:absolute;top:0;display:block;inline-size:100%;block-size:100%;overflow:hidden}.t-value{transition-property:transform,clip-path;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;position:absolute;bottom:0;right:100%;display:block;clip-path:inset(0);transform:translate3d(calc(100% * var(--tui-inline)),0,0)}:host-context([dir=\"rtl\"]) .t-value{right:unset;left:100%;transform:translate3d(calc(100% * var(--tui-inline)),0,0)!important}.t-input{position:absolute;top:0;left:0;inline-size:100%;block-size:100%;z-index:1;border:0;margin:0;padding:calc(var(--t-height) / 3) var(--t-padding) 0;outline:none;background:transparent;box-sizing:border-box;font:inherit;color:var(--tui-text-primary);direction:ltr}:host-context([dir=\"rtl\"]) .t-input{text-align:end}.t-input::placeholder{color:var(--tui-text-tertiary)}.t-input_prefilled::placeholder{color:var(--tui-text-primary)}.t-input[chrome-autofilled],.t-input:-webkit-autofill{-webkit-text-fill-color:var(--tui-text-primary)!important;caret-color:var(--tui-text-primary)!important;-webkit-transition:background-color 600000s 0s;transition:background-color 600000s 0s}.t-input.t-input.t-input_card:not(:-webkit-autofill):not(:focus:placeholder-shown),.t-input.t-input.t-input_card.t-input_filled{caret-color:var(--tui-text-primary);color:transparent!important;-webkit-text-fill-color:transparent!important}.t-input.t-input.t-input_card::-webkit-credit-card-auto-fill-button{content:none!important;position:absolute;left:-60rem;top:-60rem;z-index:-999;display:none!important;background:transparent!important;pointer-events:none!important}.t-input_inert{pointer-events:none}.t-input_cvc_hidden{-webkit-text-security:disc}.t-icons{position:absolute;right:1rem;z-index:1;display:flex;align-items:center;block-size:100%;gap:.25rem;pointer-events:none}@supports (inset-inline-end: 0){.t-icons{right:unset;inset-inline-end:1rem}}.t-icon-outlet{display:flex;margin-inline-end:.25rem}.t-icon{cursor:pointer;pointer-events:auto}.t-label{transition-property:all;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:relative;margin:0 var(--t-padding);line-height:var(--t-height);color:var(--tui-text-secondary)}.t-label:empty:before{content:attr(data-label)}input:-webkit-autofill~.t-label,.t-label_raised{font-size:var(--t-label-size);transform:translateY(var(--t-label))}:host([data-mode~=\"invalid\"]) input:-webkit-autofill~.t-label,:host([data-mode~=\"invalid\"]) .t-label_raised{color:var(--tui-text-negative)}:host([data-focus=\"true\"]) .t-label{color:var(--tui-text-primary)}.t-ghost{visibility:hidden}\n"], dependencies: [{ kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i4.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.MaxLengthValidator, selector: "[maxlength][formControlName],[maxlength][formControl],[maxlength][ngModel]", inputs: ["maxlength"] }, { kind: "directive", type: i4.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: MaskitoDirective, selector: "[maskito]", inputs: ["maskito", "maskitoElement"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: PolymorpheusOutlet, selector: "[polymorpheusOutlet]", inputs: ["polymorpheusOutlet", "polymorpheusOutletContext"] }, { kind: "directive", type: TuiAppearance, selector: "[tuiAppearance]", inputs: ["tuiAppearance", "tuiAppearanceState", "tuiAppearanceFocus", "tuiAppearanceMode"] }, { kind: "directive", type: TuiChevron, selector: "[tuiChevron]", inputs: ["tuiChevron"] }, { kind: "pipe", type: TuiFormatCardPipe, name: "tuiFormatCard" }, { kind: "component", type: TuiIcon, selector: "tui-icon", inputs: ["icon", "background"] }, { kind: "pipe", type: TuiIconPipe, name: "tuiIcon" }, { kind: "directive", type: TuiLet, selector: "[tuiLet]", inputs: ["tuiLet"] }, { kind: "pipe", type: TuiMapperPipe, name: "tuiMapper" }, { kind: "directive", type: WaResizeObserver, selector: "[waResizeObserver]", inputs: ["box"], outputs: ["waResizeObserver"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
__decorate([
    tuiPure
], TuiInputCardGroup.prototype, "isFocusable", null);
__decorate([
    tuiPure
], TuiInputCardGroup.prototype, "getPaymentSystem", null);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: TuiInputCardGroup, decorators: [{
            type: Component,
            args: [{ standalone: true, selector: 'tui-input-card-group', imports: [
                        FormsModule,
                        MaskitoDirective,
                        NgIf,
                        PolymorpheusOutlet,
                        TuiAppearance,
                        TuiChevron,
                        TuiFormatCardPipe,
                        TuiIcon,
                        TuiIconPipe,
                        TuiLet,
                        TuiMapperPipe,
                        WaResizeObserver,
                    ], changeDetection: ChangeDetectionStrategy.OnPush, providers: [
                        tuiAsDataListHost(TuiInputCardGroup),
                        tuiAsControl(TuiInputCardGroup),
                        tuiDropdownOptionsProvider({ limitWidth: 'fixed' }),
                        TuiHoveredService,
                        TUI_INPUT_CARD_GROUP_TEXTS_PROVIDER,
                    ], hostDirectives: [
                        TuiAppearance,
                        TuiDropdownDirective,
                        TuiWithDropdownOpen,
                        { directive: TuiInputCardGroupDirective, inputs: ['compact'] },
                    ], host: {
                        '[attr.data-size]': 'textfield.size()',
                        '[style.--tui-duration.s]': '0',
                        '(pointerdown)': 'onPointerDown($event)',
                        '(scroll.zoneless)': '$event.target.scrollLeft = 0',
                    }, template: "<div class=\"t-wrapper\">\n    <label\n        *tuiLet=\"value()?.card | tuiFormatCard: cardPrefilled as formattedCard\"\n        (click.zoneless.prevent)=\"(0)\"\n    >\n        <input\n            #inputCard\n            autocomplete=\"cc-number\"\n            automation-id=\"tui-input-card-group__card\"\n            inputmode=\"numeric\"\n            translate=\"no\"\n            type=\"text\"\n            class=\"t-input t-input_card\"\n            [attr.aria-invalid]=\"!cardPrefilled && !(this.card | tuiMapper: cardValidator)\"\n            [attr.id]=\"id + '_card'\"\n            [class.t-input_filled]=\"card.length\"\n            [class.t-input_inert]=\"cardPrefilled\"\n            [disabled]=\"disabled()\"\n            [maskito]=\"maskCard\"\n            [ngModel]=\"formattedCard\"\n            [ngModelOptions]=\"{standalone: true}\"\n            [placeholder]=\"cardPrefilled ? '' : placeholder || exampleText\"\n            [readOnly]=\"readOnly()\"\n            [tabIndex]=\"cardFocusable ? 0 : -1\"\n            (focus)=\"(0)\"\n            (ngModelChange)=\"onCardChange($event)\"\n        />\n        <span\n            aria-hidden=\"true\"\n            translate=\"no\"\n            class=\"t-collapsed\"\n            [attr.data-before]=\"masked\"\n            [class.t-collapsed_enable-mask]=\"cardCollapsed\"\n            (waResizeObserver)=\"onResize()\"\n        >\n            <span\n                #ghost\n                class=\"t-ghost\"\n                [textContent]=\"formattedCard.slice(-tailLength)\"\n            ></span>\n\n            <span class=\"t-collapsed-wrapper\">\n                <span\n                    class=\"t-value\"\n                    [style]=\"getStyle(ghost)\"\n                    [textContent]=\"formattedCard\"\n                ></span>\n            </span>\n        </span>\n        <div\n            class=\"t-label\"\n            [attr.data-label]=\"texts()?.cardNumberText\"\n            [class.t-label_raised]=\"labelRaised()\"\n        >\n            <ng-content />\n        </div>\n    </label>\n</div>\n<div\n    class=\"t-wrapper t-wrapper_expire\"\n    [class.t-wrapper_active]=\"cardCollapsed\"\n>\n    <label (click.zoneless.prevent)=\"(0)\">\n        <input\n            #inputExpire\n            autocomplete=\"cc-exp\"\n            automation-id=\"tui-input-card-group__expire\"\n            inputmode=\"numeric\"\n            maxlength=\"5\"\n            name=\"ccexpiryyear\"\n            translate=\"no\"\n            class=\"t-input\"\n            [attr.id]=\"id + '_expire'\"\n            [class.t-input_inert]=\"!expireFocusable\"\n            [class.t-input_prefilled]=\"!inputs.expire\"\n            [disabled]=\"disabled()\"\n            [maskito]=\"maskExpire\"\n            [ngModel]=\"expire\"\n            [ngModelOptions]=\"{standalone: true}\"\n            [placeholder]=\"inputs.expire ? '00/00' : '\u2022\u2022/\u2022\u2022'\"\n            [readOnly]=\"readOnly() || !inputs.expire\"\n            [tabIndex]=\"expireFocusable || (isMobile && isWebkit) ? 0 : -1\"\n            (focus)=\"(0)\"\n            (ngModelChange)=\"onExpireChange($event)\"\n        />\n        <div\n            class=\"t-label\"\n            [class.t-label_raised]=\"labelRaised()\"\n        >\n            {{ texts()?.expiryText }}\n        </div>\n    </label>\n</div>\n<div\n    class=\"t-wrapper t-wrapper_cvc\"\n    [class.t-wrapper_active]=\"cardCollapsed\"\n>\n    <label (click.zoneless.prevent)=\"(0)\">\n        <input\n            #inputCVC\n            autocomplete=\"cc-csc\"\n            automation-id=\"tui-input-card-group__cvc\"\n            inputmode=\"numeric\"\n            translate=\"no\"\n            type=\"text\"\n            class=\"t-input\"\n            [attr.id]=\"id + '_cvc'\"\n            [class.t-input_cvc_hidden]=\"cvcHidden\"\n            [class.t-input_prefilled]=\"cvcPrefilled\"\n            [disabled]=\"disabled()\"\n            [maskito]=\"maskCVC\"\n            [ngModel]=\"cvc\"\n            [ngModelOptions]=\"{standalone: true}\"\n            [placeholder]=\"cvcPrefilled ? '\u2022\u2022\u2022' : exampleTextCVC\"\n            [readOnly]=\"readOnly() || cvcPrefilled\"\n            [tabIndex]=\"cvcFocusable || (isMobile && isWebkit) ? 0 : -1\"\n            (focus)=\"(0)\"\n            (ngModelChange)=\"onCVCChange($event)\"\n        />\n        <div\n            class=\"t-label\"\n            [class.t-label_raised]=\"labelRaised()\"\n        >\n            {{ texts()?.cvcText }}\n        </div>\n    </label>\n</div>\n<div class=\"t-icons\">\n    <div\n        *ngIf=\"content\"\n        class=\"t-icon-outlet\"\n    >\n        <img\n            *polymorpheusOutlet=\"content as src\"\n            alt=\"\"\n            automation-id=\"tui-input-card-group__icon\"\n            class=\"t-card\"\n            [src]=\"src | tuiIcon\"\n        />\n    </div>\n    <tui-icon\n        *ngIf=\"hasCleaner()\"\n        automation-id=\"tui-input-card-group__cleaner\"\n        tuiAppearance=\"icon\"\n        class=\"t-icon\"\n        [icon]=\"icons.close\"\n        [style.border-width.rem]=\"0.25\"\n        (click)=\"clear()\"\n    />\n    <tui-icon\n        *ngIf=\"dropdown._content()\"\n        automation-id=\"tui-input-card-group__dropdown\"\n        tuiAppearance=\"icon\"\n        tuiChevron\n        class=\"t-icon\"\n        (click)=\"toggle()\"\n    />\n</div>\n", styles: ["@keyframes outside{0%{transform:translate3d(calc(var(--t-translate) * var(--tui-inline)),0,0)}to{transform:translate3d(calc(100% * var(--tui-inline)),0,0)}}@keyframes inside{0%{transform:translate3d(calc(100% * var(--tui-inline)),0,0)}to{transform:translate3d(calc(var(--t-translate) * var(--tui-inline)),0,0)}}:host{--t-height: var(--tui-height-l);--t-padding: var(--tui-padding-l);--t-label: -.7rem;--t-label-size: .83em;--t-translate: 6.5625rem;position:relative;display:block;block-size:var(--t-height);inline-size:29.5rem;border-radius:var(--tui-radius-l);overflow:hidden;font:var(--tui-font-text-ui-m);isolation:isolate}:host[data-size=m]{--t-label: -.7em;--t-height: var(--tui-height-m);--t-padding: var(--tui-padding-m);border-radius:var(--tui-radius-m);font:var(--tui-font-text-ui-s)}:host[data-size=m] .t-card{inline-size:1.5rem;block-size:1.5rem}:host[data-size=m] [tuiChevron]{margin-inline-end:-.875rem;margin-inline-start:.125rem}:host._compact{inline-size:18rem;--t-translate: 4.125rem}:host[tuiAppearance][data-appearance]:has(:-webkit-autofill){background:var(--tui-service-autofill-background)!important}:host [tuiChevron]{block-size:auto;align-self:stretch;border-inline-end:var(--t-padding) solid transparent;margin-inline-end:-.75rem;box-sizing:content-box;font-size:1rem;cursor:pointer}.t-wrapper{position:absolute;z-index:1;inline-size:100%;block-size:100%;transition:opacity 0s var(--tui-duration)}.t-wrapper_cvc,.t-wrapper_expire{opacity:0;pointer-events:none;animation:outside var(--tui-duration) ease-in-out}.t-wrapper_cvc{margin-inline-start:7.1875rem}:host._compact .t-wrapper_cvc{margin-inline-start:4.0625rem}.t-wrapper_active{transition:none;pointer-events:auto;opacity:1;animation:inside var(--tui-duration) ease-in-out forwards}.t-card{inline-size:2rem;block-size:2rem}.t-collapsed{position:absolute;top:0;left:0;inline-size:100%;block-size:100%;padding:calc(var(--t-height) / 3) var(--t-padding) 0;box-sizing:border-box;line-height:calc(2 * var(--t-height) / 3);color:var(--tui-text-primary);white-space:nowrap;pointer-events:none}.t-collapsed:after{content:\"*\";float:left;opacity:0}:host-context([dir=\"rtl\"]) .t-collapsed:after{float:none}.t-collapsed_enable-mask:before{content:attr(data-before)}.t-collapsed_enable-mask:after{opacity:1}:host-context([dir=\"rtl\"]) .t-collapsed_enable-mask:after{transition:opacity 0s var(--tui-duration)}.t-collapsed_enable-mask .t-collapsed-wrapper{left:1.375rem}:host-context([dir=\"rtl\"]) .t-collapsed_enable-mask .t-collapsed-wrapper{left:unset}.t-collapsed-wrapper{position:absolute;top:0;display:block;inline-size:100%;block-size:100%;overflow:hidden}.t-value{transition-property:transform,clip-path;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;position:absolute;bottom:0;right:100%;display:block;clip-path:inset(0);transform:translate3d(calc(100% * var(--tui-inline)),0,0)}:host-context([dir=\"rtl\"]) .t-value{right:unset;left:100%;transform:translate3d(calc(100% * var(--tui-inline)),0,0)!important}.t-input{position:absolute;top:0;left:0;inline-size:100%;block-size:100%;z-index:1;border:0;margin:0;padding:calc(var(--t-height) / 3) var(--t-padding) 0;outline:none;background:transparent;box-sizing:border-box;font:inherit;color:var(--tui-text-primary);direction:ltr}:host-context([dir=\"rtl\"]) .t-input{text-align:end}.t-input::placeholder{color:var(--tui-text-tertiary)}.t-input_prefilled::placeholder{color:var(--tui-text-primary)}.t-input[chrome-autofilled],.t-input:-webkit-autofill{-webkit-text-fill-color:var(--tui-text-primary)!important;caret-color:var(--tui-text-primary)!important;-webkit-transition:background-color 600000s 0s;transition:background-color 600000s 0s}.t-input.t-input.t-input_card:not(:-webkit-autofill):not(:focus:placeholder-shown),.t-input.t-input.t-input_card.t-input_filled{caret-color:var(--tui-text-primary);color:transparent!important;-webkit-text-fill-color:transparent!important}.t-input.t-input.t-input_card::-webkit-credit-card-auto-fill-button{content:none!important;position:absolute;left:-60rem;top:-60rem;z-index:-999;display:none!important;background:transparent!important;pointer-events:none!important}.t-input_inert{pointer-events:none}.t-input_cvc_hidden{-webkit-text-security:disc}.t-icons{position:absolute;right:1rem;z-index:1;display:flex;align-items:center;block-size:100%;gap:.25rem;pointer-events:none}@supports (inset-inline-end: 0){.t-icons{right:unset;inset-inline-end:1rem}}.t-icon-outlet{display:flex;margin-inline-end:.25rem}.t-icon{cursor:pointer;pointer-events:auto}.t-label{transition-property:all;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:relative;margin:0 var(--t-padding);line-height:var(--t-height);color:var(--tui-text-secondary)}.t-label:empty:before{content:attr(data-label)}input:-webkit-autofill~.t-label,.t-label_raised{font-size:var(--t-label-size);transform:translateY(var(--t-label))}:host([data-mode~=\"invalid\"]) input:-webkit-autofill~.t-label,:host([data-mode~=\"invalid\"]) .t-label_raised{color:var(--tui-text-negative)}:host([data-focus=\"true\"]) .t-label{color:var(--tui-text-primary)}.t-ghost{visibility:hidden}\n"] }]
        }], propDecorators: { inputCard: [{
                type: ViewChild,
                args: ['inputCard', { static: true }]
            }], inputExpire: [{
                type: ViewChild,
                args: ['inputExpire', { static: true }]
            }], inputCVC: [{
                type: ViewChild,
                args: ['inputCVC', { static: true }]
            }], exampleText: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], inputs: [{
                type: Input
            }], cardValidator: [{
                type: Input
            }], icon: [{
                type: Input
            }], id: [{
                type: Input
            }], autocomplete: [{
                type: Input
            }], binChange: [{
                type: Output
            }], codeLength: [{
                type: Input
            }], isFocusable: [], getPaymentSystem: [] } });

/**
 * Generated bundle index. Do not edit.
 */

export { TUI_INPUT_CARD_GROUP_DEFAULT_OPTIONS, TUI_INPUT_CARD_GROUP_OPTIONS, TUI_INPUT_CARD_GROUP_TEXTS, TUI_INPUT_CARD_GROUP_TEXTS_PROVIDER, TuiInputCardGroup, TuiInputCardGroupDirective, tuiInputCardGroupOptionsProvider };
//# sourceMappingURL=taiga-ui-addon-commerce-components-input-card-group.mjs.map
